---
title: Ajouter des robots personnalisés à Microsoft teams avec des webhooks sortants
author: laujan
description: ''
keywords: onglet teams webhook sortant *
ms.topic: conceptual
ms.author: laujan
ms.openlocfilehash: 4881dc8768c7c51947f6a80a55affe78c28874d3
ms.sourcegitcommit: 3ba5a5a7d9d9d906abc3ee1df9c2177de0cfd767
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2020
ms.locfileid: "45102997"
---
# <a name="add-custom-bots-to-microsoft-teams-with-outgoing-webhooks"></a><span data-ttu-id="99619-103">Ajouter des robots personnalisés à Microsoft teams avec des webhooks sortants</span><span class="sxs-lookup"><span data-stu-id="99619-103">Add custom bots to Microsoft Teams with outgoing webhooks</span></span>

## <a name="what-are-outgoing-webhooks-in-teams"></a><span data-ttu-id="99619-104">Qu’est-ce qu’un webhooks sortants dans teams ?</span><span class="sxs-lookup"><span data-stu-id="99619-104">What are outgoing webhooks in Teams?</span></span>

<span data-ttu-id="99619-105">Les webhooks sont un excellent moyen pour les équipes de s’intégrer aux applications externes.</span><span class="sxs-lookup"><span data-stu-id="99619-105">Webhooks are a great way for Teams to integrate with external apps.</span></span> <span data-ttu-id="99619-106">Un webhook est essentiellement une requête POST envoyée à une URL de rappel.</span><span class="sxs-lookup"><span data-stu-id="99619-106">A webhook is essentially a POST request sent to a callback URL.</span></span> <span data-ttu-id="99619-107">Dans Teams, les webhooks sortants offrent un moyen simple pour permettre aux utilisateurs d’envoyer des messages à votre service Web sans avoir à passer par le processus complet de création de robots via [Microsoft bot Framework](https://dev.botframework.com/).</span><span class="sxs-lookup"><span data-stu-id="99619-107">In Teams, outgoing webhooks provide a simple way to allow users to send messages to your web service without having to go through the full process of creating bots via the [Microsoft Bot Framework](https://dev.botframework.com/).</span></span> <span data-ttu-id="99619-108">Webhooks sortants publiez des données à partir de teams vers tout service choisi capable d’accepter une charge utile JSON.</span><span class="sxs-lookup"><span data-stu-id="99619-108">Outgoing webhooks post data from Teams to any chosen service capable of accepting a JSON payload.</span></span> <span data-ttu-id="99619-109">Une fois qu’un webhook sortant est ajouté à une équipe, il se comporte comme du robot, à l’écoute de canaux pour les messages utilisant une \*\* \@ mention\*\*, à l’envoi de notifications à des services Web externes et à la réponse avec des messages enrichis pouvant inclure des cartes et des images.</span><span class="sxs-lookup"><span data-stu-id="99619-109">Once an outgoing webhook is added to a team, it acts like bot, listening in channels for messages using **\@mention**, sending notifications to external web services, and responding with rich messages that can include cards and images.</span></span>

## <a name="outgoing-webhook-key-features"></a><span data-ttu-id="99619-110">Fonctionnalités clés de webhook sortantes</span><span class="sxs-lookup"><span data-stu-id="99619-110">Outgoing webhook key features</span></span>

| <span data-ttu-id="99619-111">Fonctionnalité</span><span class="sxs-lookup"><span data-stu-id="99619-111">Feature</span></span> | <span data-ttu-id="99619-112">Description</span><span class="sxs-lookup"><span data-stu-id="99619-112">Description</span></span> |
| ------- | ----------- |
| <span data-ttu-id="99619-113">Configuration étendue</span><span class="sxs-lookup"><span data-stu-id="99619-113">Scoped Configuration</span></span>| <span data-ttu-id="99619-114">Les webhooks sont étendus au niveau de l’équipe.</span><span class="sxs-lookup"><span data-stu-id="99619-114">Webhooks are scoped at the team level.</span></span> <span data-ttu-id="99619-115">Vous devez suivre le processus de configuration pour chaque équipe à laquelle vous souhaitez ajouter votre webhook sortant.</span><span class="sxs-lookup"><span data-stu-id="99619-115">You’ll need to go through the setup process for each team you want to add your outgoing webhook to.</span></span> |
| <span data-ttu-id="99619-116">Messagerie réactive</span><span class="sxs-lookup"><span data-stu-id="99619-116">Reactive Messaging</span></span>| <span data-ttu-id="99619-117">Les utilisateurs doivent utiliser @mention pour le webhook pour recevoir des messages.</span><span class="sxs-lookup"><span data-stu-id="99619-117">Users must use @mention for the webhook to receive messages.</span></span> <span data-ttu-id="99619-118">Actuellement, les utilisateurs peuvent uniquement envoyer un webhook sortant dans des canaux publics et non dans l’étendue personnelle ou privée.</span><span class="sxs-lookup"><span data-stu-id="99619-118">Currently users can only message an outgoing webhook in public channels and not within the personal or private scope</span></span> |
|<span data-ttu-id="99619-119">Échange de messages HTTP standard</span><span class="sxs-lookup"><span data-stu-id="99619-119">Standard HTTP message exchange</span></span>|<span data-ttu-id="99619-120">Les réponses apparaîtront dans la même chaîne que le message de requête d’origine et peuvent inclure tout contenu de message de la structure bot (texte enrichi, images, cartes et Emoji).</span><span class="sxs-lookup"><span data-stu-id="99619-120">Responses will appear in the same chain as the original request message and can include any Bot Framework message content (rich text, images, cards, and emojis).</span></span> <span data-ttu-id="99619-121">**Remarque**: bien que les webhooks sortants puissent utiliser les cartes, ils ne peuvent pas utiliser les actions de carte à l’exception de `openURL` .</span><span class="sxs-lookup"><span data-stu-id="99619-121">**Note**: Although outgoing webhooks can use cards, they cannot use any card actions except for `openURL`.</span></span>|
| <span data-ttu-id="99619-122">Prise en charge des méthodes de l’API teams</span><span class="sxs-lookup"><span data-stu-id="99619-122">Teams API method support</span></span>|<span data-ttu-id="99619-123">Dans Teams, les webhooks sortants envoient un billet HTTP à un service Web et traitent une réponse.</span><span class="sxs-lookup"><span data-stu-id="99619-123">In Teams, outgoing webhooks send an HTTP POST to a web service and process a response back.</span></span> <span data-ttu-id="99619-124">Ils ne peuvent pas accéder à d’autres API, par exemple, récupérer la liste ou la liste des canaux d’une équipe.</span><span class="sxs-lookup"><span data-stu-id="99619-124">They cannot access any other APIs like retrieve the roster or list of channels in a team.</span></span>|

## <a name="adding-outgoing-webhook-processing-to-your-app"></a><span data-ttu-id="99619-125">Ajout du traitement webhook sortant à votre application</span><span class="sxs-lookup"><span data-stu-id="99619-125">Adding outgoing webhook processing to your app</span></span>

<span data-ttu-id="99619-126">**Scénario**: notifications d’état de modification de transmission sur un serveur de base de données de canal teams vers votre application.</span><span class="sxs-lookup"><span data-stu-id="99619-126">**Scenario**: Push change status notifications on a Teams channel database server to your app.</span></span>  
<span data-ttu-id="99619-127">**Exemple**: vous disposez d’une application métier qui effectue le suivi de toutes les opérations CRUD effectuées pour les enregistrements d’employés par les utilisateurs de Channels teams dans le client Office 365.</span><span class="sxs-lookup"><span data-stu-id="99619-127">**Example**: You have a line-of-business app that tracks all CRUD operations made to employee records by Teams channel HR users across an Office 365 tenancy.</span></span>

### <a name="1-create-a-url-on-your-apps-server-to-accept-and-process-a-post-request-with-a-json-payload"></a><span data-ttu-id="99619-128">1. créer une URL sur le serveur de votre application pour accepter et traiter une requête POST avec une charge utile JSON</span><span class="sxs-lookup"><span data-stu-id="99619-128">1. Create a URL on your app's server to accept and process a POST request with a JSON payload</span></span>

<span data-ttu-id="99619-129">Votre service recevra les messages dans le schéma de messagerie du service Azure bot standard.</span><span class="sxs-lookup"><span data-stu-id="99619-129">Your service will receive messages in the standard Azure bot service messaging schema.</span></span> <span data-ttu-id="99619-130">Le connecteur de robot est un service RESTful qui permet à votre service de traiter l’échange de messages au format JSON via les protocoles HTTPs, comme indiqué dans l' [API du service Azure bot](/bot-framework/rest-api/bot-framework-rest-connector-api-reference).</span><span class="sxs-lookup"><span data-stu-id="99619-130">The Bot Framework connector is a RESTful service that enables your service to process the interchange of JSON formatted messages via HTTPS protocols as documented in the [Azure Bot Service API](/bot-framework/rest-api/bot-framework-rest-connector-api-reference).</span></span> <span data-ttu-id="99619-131">Vous pouvez également suivre le kit de développement logiciel (SDK) de Microsoft bot Framework pour traiter et analyser les messages.</span><span class="sxs-lookup"><span data-stu-id="99619-131">Alternatively, you can follow the [Microsoft Bot Framework SDK] to process and parse messages.</span></span> <span data-ttu-id="99619-132">*Voir aussi*  [à propos du service de robots Azure](/azure/bot-service/bot-service-overview-introduction?view=azure-bot-service-4.0).</span><span class="sxs-lookup"><span data-stu-id="99619-132">*See also*  [About Azure Bot Service](/azure/bot-service/bot-service-overview-introduction?view=azure-bot-service-4.0).</span></span>

<span data-ttu-id="99619-133">Les webhooks sortants sont inclus dans le `team` niveau et sont visibles par tous les membres de l’équipe.</span><span class="sxs-lookup"><span data-stu-id="99619-133">Outgoing webhooks are scoped to the `team` level and are visible to all members of the team.</span></span> <span data-ttu-id="99619-134">Tout comme un bot, les utilisateurs doivent \*\* \@ mentionner\*\* le nom du webhook sortant pour l’appeler dans le canal.</span><span class="sxs-lookup"><span data-stu-id="99619-134">Just like a bot, users are required to **\@mention** the name of the outgoing webhook to invoke it in the channel.</span></span>

### <a name="2-create-a-method-to-verify-the-outgoing-webhook-hmac-token"></a><span data-ttu-id="99619-135">2. créer une méthode pour vérifier le jeton HMAC de webhook sortant</span><span class="sxs-lookup"><span data-stu-id="99619-135">2. Create a method to verify the outgoing webhook HMAC token</span></span>

<span data-ttu-id="99619-136">Pour vous assurer que votre service reçoit des appels uniquement à partir de clients teams réels, teams fournit un code HMAC dans l' `hmac` en-tête HTTP qui doit toujours être inclus dans votre protocole d’authentification.</span><span class="sxs-lookup"><span data-stu-id="99619-136">To ensure that your service is receiving calls only from actual Teams clients, Teams provides an HMAC Code in the HTTP `hmac` header that should always be  included in your authentication protocol.</span></span>

<span data-ttu-id="99619-137">Votre code doit toujours valider la signature HMAC incluse dans la demande :</span><span class="sxs-lookup"><span data-stu-id="99619-137">Your code should always validate the HMAC signature included in the request:</span></span>

* <span data-ttu-id="99619-138">*Générez* le jeton HMAC à partir du corps de la demande du message.</span><span class="sxs-lookup"><span data-stu-id="99619-138">*Generate* the HMAC token from the request body of the message.</span></span> <span data-ttu-id="99619-139">Il existe des bibliothèques standard pour effectuer cette opération sur la plupart des plateformes (*reportez-vous* à [crypto](https://nodejs.org/api/crypto.html#crypto_crypto) for Node.js ou *voir* [Team webhook Sample](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook/blob/23eb61da5a18634d51c5247944843da9abed01b6/WebhookSampleBot/Models/AuthProvider.cs) for C \# ).</span><span class="sxs-lookup"><span data-stu-id="99619-139">There are standard libraries to do this on most platforms (*see* [Crypto](https://nodejs.org/api/crypto.html#crypto_crypto) for Node.js or  *see* [Teams Webhook Sample](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook/blob/23eb61da5a18634d51c5247944843da9abed01b6/WebhookSampleBot/Models/AuthProvider.cs) for C\#).</span></span> <span data-ttu-id="99619-140">Microsoft teams utilise le chiffrement HMAC standard SHA256.</span><span class="sxs-lookup"><span data-stu-id="99619-140">Microsoft Teams uses standard SHA256 HMAC cryptography .</span></span> <span data-ttu-id="99619-141">Vous devrez convertir le corps en un tableau d’octets en UTF8.</span><span class="sxs-lookup"><span data-stu-id="99619-141">You will need to convert the body to a byte array in UTF8.</span></span>
* <span data-ttu-id="99619-142">*Calculer* le hachage à partir du tableau d’octets du jeton de sécurité **fourni par teams** lorsque vous avez enregistré le webhook sortant dans le client teams].</span><span class="sxs-lookup"><span data-stu-id="99619-142">*Compute* the hash from the byte array of the security token **provided by Teams** when you registered the outgoing webhook in the Teams client].</span></span> <span data-ttu-id="99619-143">*Voir* [créer un webhook sortant](#create-an-outgoing-webhook), ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="99619-143">*See* [Create an outgoing webhook](#create-an-outgoing-webhook), below.</span></span>
* <span data-ttu-id="99619-144">*Convertissez* le hachage en une chaîne à l’aide de l’encodage UTF-8.</span><span class="sxs-lookup"><span data-stu-id="99619-144">*Convert* the hash to a string using UTF-8 encoding.</span></span>
* <span data-ttu-id="99619-145">*Comparez* la valeur de chaîne du hachage généré à la valeur fournie dans la demande http.</span><span class="sxs-lookup"><span data-stu-id="99619-145">*Compare* the string value of the generated hash with the value provided in the HTTP request.</span></span>

### <a name="3-create-a-method-to-send-a-success-or-failure-response"></a><span data-ttu-id="99619-146">3. créer une méthode pour envoyer une réponse de réussite ou d’échec</span><span class="sxs-lookup"><span data-stu-id="99619-146">3. Create a method to send a success or failure response</span></span>

<span data-ttu-id="99619-147">Les réponses de votre webhook sortant apparaîtront dans la même chaîne de réponse que le message d’origine.</span><span class="sxs-lookup"><span data-stu-id="99619-147">Responses from your outgoing webhook will appear in the same reply chain as the original message.</span></span> <span data-ttu-id="99619-148">Lorsque l’utilisateur effectue une requête, Microsoft teams émet une demande HTTP synchrone à votre service et votre code disposera de 5 secondes pour répondre au message avant que la connexion expire et ne se termine.</span><span class="sxs-lookup"><span data-stu-id="99619-148">When the user performs a query, Microsoft Teams issues a synchronous HTTP request to your service and your code will have 5 seconds to respond to the message before the connection times out and terminates.</span></span>

### <a name="example-response"></a><span data-ttu-id="99619-149">Exemple de réponse</span><span class="sxs-lookup"><span data-stu-id="99619-149">Example response</span></span>

```json
{
    "type": "message",
    "text": "This is a reply!"
}
```

## <a name="create-an-outgoing-webhook"></a><span data-ttu-id="99619-150">Créer un webhook sortant</span><span class="sxs-lookup"><span data-stu-id="99619-150">Create an outgoing webhook</span></span>

1. <span data-ttu-id="99619-151">Sélectionnez l’équipe appropriée et sélectionnez **gérer une équipe** dans le menu déroulant (&#8226;&#8226;&#8226;).</span><span class="sxs-lookup"><span data-stu-id="99619-151">Select the appropriate team and select **Manage team** from the (&#8226;&#8226;&#8226;) drop-down menu.</span></span>
1. <span data-ttu-id="99619-152">Sélectionnez l’onglet **applications** dans la barre de navigation.</span><span class="sxs-lookup"><span data-stu-id="99619-152">Choose the **Apps** tab from the navigation bar.</span></span>
1. <span data-ttu-id="99619-153">Dans le coin inférieur droit de la fenêtre, sélectionnez **créer un webhook sortant**.</span><span class="sxs-lookup"><span data-stu-id="99619-153">From the window's lower right corner select **Create an outgoing webhook**.</span></span>
1. <span data-ttu-id="99619-154">Dans la fenêtre contextuelle résultante, renseignez les champs obligatoires :</span><span class="sxs-lookup"><span data-stu-id="99619-154">In the resulting popup window complete the required fields:</span></span>

>* <span data-ttu-id="99619-155">**Nom** : le titre du webhook et le @mention TAP.</span><span class="sxs-lookup"><span data-stu-id="99619-155">**Name** - The webhook title and @mention tap.</span></span>
>* <span data-ttu-id="99619-156">**URL de rappel** : le point de terminaison HTTPS qui accepte les charges utiles JSON et reçoit les requêtes post de teams.</span><span class="sxs-lookup"><span data-stu-id="99619-156">**Callback URL** - The HTTPS endpoint that accepts JSON payloads and will receive POST requests from Teams.</span></span>
>* <span data-ttu-id="99619-157">**Description** : une chaîne détaillée qui apparaîtra sur la carte de visite et le tableau de bord de l’application au niveau de l’équipe.</span><span class="sxs-lookup"><span data-stu-id="99619-157">**Description** - A detailed string that will appear in the profile card and the team-level App dashboard.</span></span>
>* <span data-ttu-id="99619-158">**Image de profil** (facultatif) icône de l’application pour votre webhook.</span><span class="sxs-lookup"><span data-stu-id="99619-158">**Profile Picture** (optional) an app icon for your webhook.</span></span>
>* <span data-ttu-id="99619-159">Sélectionnez le bouton **créer** dans le coin inférieur droit de la fenêtre contextuelle et le webhook sortant sera ajouté aux canaux de l’équipe active.</span><span class="sxs-lookup"><span data-stu-id="99619-159">Select the **Create** button from lower right corner of the pop-up window and the outgoing webhook will be added to the current team's channels.</span></span>
>* <span data-ttu-id="99619-160">La fenêtre de boîte de dialogue suivante affiche un jeton de sécurité [HMAC (Hash-based Message Authentication Code)](https://security.stackexchange.com/questions/20129/how-and-when-do-i-use-hmac/20301) qui sera utilisé pour authentifier les appels entre teams et le service externe désigné.</span><span class="sxs-lookup"><span data-stu-id="99619-160">The next dialog window will display an [Hash-based Message Authentication Code (HMAC)](https://security.stackexchange.com/questions/20129/how-and-when-do-i-use-hmac/20301) security token that will be used to authenticate calls between Teams and the designated outside service.</span></span>
>* <span data-ttu-id="99619-161">Si l’URL est valide et si les jetons d’authentification du serveur et du client sont égaux (par exemple, une négociation HMAC), le webhook sortant sera disponible pour les utilisateurs de l’équipe.</span><span class="sxs-lookup"><span data-stu-id="99619-161">If the URL is valid and the server and client authentication tokens are equal (i.e., an HMAC handshake), the outgoing webhook will be available to the team's users.</span></span>

## <a name="code-samples"></a><span data-ttu-id="99619-162">Exemples de code</span><span class="sxs-lookup"><span data-stu-id="99619-162">Code samples</span></span>

<span data-ttu-id="99619-163">Vous pouvez afficher les exemples de code webhook sortants sur GitHub :</span><span class="sxs-lookup"><span data-stu-id="99619-163">You can view outgoing webhook code samples on GitHub:</span></span>

### <a name="nodejs"></a><span data-ttu-id="99619-164">Node.js</span><span class="sxs-lookup"><span data-stu-id="99619-164">Node.js</span></span>

[<span data-ttu-id="99619-165">OfficeDev/msteams-Samples-sortante-webhook-NodeJS</span><span class="sxs-lookup"><span data-stu-id="99619-165">OfficeDev/msteams-samples-outgoing-webhook-nodejs</span></span>](https://github.com/OfficeDev/msteams-samples-outgoing-webhook-nodejs)

### <a name="c"></a><span data-ttu-id="99619-166">C\#</span><span class="sxs-lookup"><span data-stu-id="99619-166">C\#</span></span>

[<span data-ttu-id="99619-167">OfficeDev/Microsoft-teams-Sample-sortante-webhook</span><span class="sxs-lookup"><span data-stu-id="99619-167">OfficeDev/microsoft-teams-sample-outgoing-webhook</span></span>](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook)
