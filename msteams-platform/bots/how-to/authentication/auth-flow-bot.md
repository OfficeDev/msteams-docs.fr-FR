---
title: Microsoft Teams Flux d’authentification pour les bots
description: Décrit le flux Microsoft Teams’authentification dans les bots
keywords: bots de flux d’authentification Teams
localization_priority: Normal
ms.topic: overview
ms.openlocfilehash: 68ba2024d0e0f2f92a52e93614e4576dcde8dcbc
ms.sourcegitcommit: 14409950307b135265c8582408be5277b35131dd
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/17/2021
ms.locfileid: "52994223"
---
# <a name="authentication-flow-for-bots-in-microsoft-teams"></a><span data-ttu-id="ee80a-104">Flux d’authentification pour les bots dans Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="ee80a-104">Authentication flow for bots in Microsoft Teams</span></span>

<span data-ttu-id="ee80a-105">OAuth 2.0 est une norme ouverte pour l’authentification et l’autorisation utilisée par Azure Active Directory (Azure AD) et de nombreux autres fournisseurs d’identité.</span><span class="sxs-lookup"><span data-stu-id="ee80a-105">OAuth 2.0 is an open standard for authentication and authorization used by Azure Active Directory (Azure AD) and many other identity providers.</span></span> <span data-ttu-id="ee80a-106">Une compréhension de base d’OAuth 2.0 est une condition préalable à l’utilisation de l’authentification dans Teams; [Voici une bonne vue d’ensemble](https://aaronparecki.com/oauth-2-simplified/) plus facile à suivre que la [spécification formelle.](https://oauth.net/2/)</span><span class="sxs-lookup"><span data-stu-id="ee80a-106">A basic understanding of OAuth 2.0 is a prerequisite for working with authentication in Teams; [here's a good overview](https://aaronparecki.com/oauth-2-simplified/) that's easier to follow than the [formal specification](https://oauth.net/2/).</span></span> <span data-ttu-id="ee80a-107">Le flux d’authentification pour les onglets et les bots est légèrement différent : les onglets sont très similaires aux sites web afin qu’ils peuvent utiliser OAuth 2.0 directement, tandis que les bots ne le sont pas et doivent faire quelques choses différemment, mais les concepts de base sont identiques.</span><span class="sxs-lookup"><span data-stu-id="ee80a-107">Authentication flow for tabs and bots is a little different — tabs are very similar to websites so they can use OAuth 2.0 directly, while bots aren't and must do a few things differently — but the core concepts are identical.</span></span>

<span data-ttu-id="ee80a-108">Consultez l’exemple GitHub [](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-auth/nodejs) d’authentification de Microsoft Teams pour obtenir un exemple de flux d’authentification pour les bots utilisant Node.js et le type d’octroi de code d’autorisation [OAuth 2.0.](https://oauth.net/2/grant-types/authorization-code/)</span><span class="sxs-lookup"><span data-stu-id="ee80a-108">See the GitHub repo [Microsoft Teams Authentication Sample](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-auth/nodejs) for an example that demonstrates authentication flow for bots using Node.js and the [OAuth 2.0 authorization code grant type](https://oauth.net/2/grant-types/authorization-code/).</span></span>

![Diagramme de séquence d’authentification de bot](../../../assets/images/authentication/bot_auth_sequence_diagram.png)

1. <span data-ttu-id="ee80a-110">L’utilisateur envoie un message au bot.</span><span class="sxs-lookup"><span data-stu-id="ee80a-110">The user sends a message to the bot.</span></span>
2. <span data-ttu-id="ee80a-111">Le bot détermine si l’utilisateur doit se connecter.</span><span class="sxs-lookup"><span data-stu-id="ee80a-111">The bot determines if the user needs to sign in.</span></span>
   <span data-ttu-id="ee80a-112">Dans cet exemple, le bot stocke le jeton d’accès dans son magasin de données utilisateur.</span><span class="sxs-lookup"><span data-stu-id="ee80a-112">In this example, the bot stores the access token in its user data store.</span></span> <span data-ttu-id="ee80a-113">Il demande à l’utilisateur de se connecter s’il n’a pas de jeton validé pour le fournisseur d’identité sélectionné.</span><span class="sxs-lookup"><span data-stu-id="ee80a-113">It asks the user to sign in if it doesn't have a validated token for the selected identity provider.</span></span> <span data-ttu-id="ee80a-114">([Afficher le code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/utils/AuthenticationUtils.ts#L58-L76))</span><span class="sxs-lookup"><span data-stu-id="ee80a-114">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/utils/AuthenticationUtils.ts#L58-L76))</span></span>
3. <span data-ttu-id="ee80a-115">Le bot construit l’URL vers la page de démarrage du flux d’authentification et envoie une carte à l’utilisateur avec une `signin` action.</span><span class="sxs-lookup"><span data-stu-id="ee80a-115">The bot constructs the URL to the start page of the authentication flow, and sends a card to the user with a `signin` action.</span></span> <span data-ttu-id="ee80a-116">([Afficher le code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/dialogs/BaseIdentityDialog.ts#L160-L190))</span><span class="sxs-lookup"><span data-stu-id="ee80a-116">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/dialogs/BaseIdentityDialog.ts#L160-L190))</span></span></br>
    <span data-ttu-id="ee80a-117">Comme les autres flux d’authentification d’application dans Teams, la page de démarrage doit se trouver dans un domaine de votre liste et dans le même domaine que la page de `validDomains` redirection post-connexion.</span><span class="sxs-lookup"><span data-stu-id="ee80a-117">Like other application auth flows in Teams, the start page must be in a domain that's on your `validDomains` list, and in the same domain as the post-login redirect page.</span></span>
    > [!IMPORTANT] 
    > <span data-ttu-id="ee80a-118">Le flux d’octroi de code d’autorisation OAuth 2.0 appelle un paramètre dans la demande d’authentification qui contient un jeton de session unique pour empêcher une attaque de contrefaçon de demande entre `state` [sites.](https://en.wikipedia.org/wiki/Cross-site_request_forgery)</span><span class="sxs-lookup"><span data-stu-id="ee80a-118">The OAuth 2.0 authorization code grant flow calls for a `state` parameter in the authentication request which contains a unique session token to prevent a [cross-site request forgery attack](https://en.wikipedia.org/wiki/Cross-site_request_forgery).</span></span> <span data-ttu-id="ee80a-119">L’exemple utilise un GUID généré de manière aléatoire.</span><span class="sxs-lookup"><span data-stu-id="ee80a-119">The example uses a randomly-generated GUID.</span></span>
4. <span data-ttu-id="ee80a-120">Lorsque l’utilisateur sélectionne *le* bouton de Teams, il ouvre une fenêtre popup et navigue vers la page de démarrage.</span><span class="sxs-lookup"><span data-stu-id="ee80a-120">When the user selects the *signin* button, Teams opens a popup window and navigates to the start page.</span></span>
   > [!NOTE]
   > <span data-ttu-id="ee80a-121">La taille de la fenêtre pop-up peut être contrôlée par les paramètres de chaîne de requête largeur et hauteur dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="ee80a-121">The size of the pop-up window can be controlled through width and height query string parameters in the URL.</span></span> <span data-ttu-id="ee80a-122">Par exemple, si vous ajoutez width=600 et height=600, la taille de la fenêtre pop-up est de 600 x 600 pixels.</span><span class="sxs-lookup"><span data-stu-id="ee80a-122">For example, if you add width=600 and height=600, the size of the pop-up window is 600x600 pixels.</span></span> <span data-ttu-id="ee80a-123">La taille réelle de la fenêtre pop-up est limitée en pourcentage de la taille Teams fenêtre principale.</span><span class="sxs-lookup"><span data-stu-id="ee80a-123">The actual size of the pop-up window is capped as a percentage of the Teams main window size.</span></span> <span data-ttu-id="ee80a-124">Si la Teams fenêtre est petite, elle est plus petite que les dimensions spécifiées.</span><span class="sxs-lookup"><span data-stu-id="ee80a-124">If the Teams window is small, the pop-up window is smaller than the specified dimensions.</span></span>

5. <span data-ttu-id="ee80a-125">La page de démarrage redirige l’utilisateur vers le point de terminaison du fournisseur `authorize` d’identité.</span><span class="sxs-lookup"><span data-stu-id="ee80a-125">The start page redirects the user to the identity provider's `authorize` endpoint.</span></span> <span data-ttu-id="ee80a-126">([Afficher le code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/public/html/auth-start.html#L51-L56))</span><span class="sxs-lookup"><span data-stu-id="ee80a-126">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/public/html/auth-start.html#L51-L56))</span></span>
6. <span data-ttu-id="ee80a-127">Sur le site du fournisseur, l’utilisateur se signe et accorde l’accès au bot.</span><span class="sxs-lookup"><span data-stu-id="ee80a-127">On the provider's site, the user signs in and grants access to the bot.</span></span>
7. <span data-ttu-id="ee80a-128">Le fournisseur redirige l’utilisateur vers la page de redirection OAuth du bot avec un code d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="ee80a-128">The provider takes the user to the bot's OAuth redirect page with an authorization code.</span></span>
8. <span data-ttu-id="ee80a-129">Le bot échange le code d’autorisation  contre un jeton d’accès et associe provisoirement le jeton à l’utilisateur qui a initié le flux de la signature.</span><span class="sxs-lookup"><span data-stu-id="ee80a-129">The bot redeems the authorization code for an access token, and **provisionally** associates the token with the user that initiated the sign-in flow.</span></span> <span data-ttu-id="ee80a-130">Ci-dessous, nous appelons cela *un jeton provisoire*.</span><span class="sxs-lookup"><span data-stu-id="ee80a-130">Below, we call this a *provisional token*.</span></span>
    * <span data-ttu-id="ee80a-131">Dans l’exemple, le bot associe la valeur du paramètre à l’ID de l’utilisateur qui a initié le processus de signature afin qu’il puisse ultérieurement la faire correspondre à la valeur renvoyée par le fournisseur `state` `state` d’identité.</span><span class="sxs-lookup"><span data-stu-id="ee80a-131">In the example, the bot associates the value of the `state` parameter with the ID of the user that initiated the sign-in process so it can later match it with the `state` value returned by the identity provider.</span></span> <span data-ttu-id="ee80a-132">([Afficher le code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/AuthBot.ts#L70-L99))</span><span class="sxs-lookup"><span data-stu-id="ee80a-132">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/AuthBot.ts#L70-L99))</span></span>
      > [!IMPORTANT] 
      > <span data-ttu-id="ee80a-133">Le bot stocke le jeton qu’il reçoit du fournisseur d’identité et l’associe à un utilisateur spécifique, mais il est marqué comme « validation en attente ».</span><span class="sxs-lookup"><span data-stu-id="ee80a-133">The bot stores the token it receives from the identity provider and associates it with a specific user, but it is marked as "pending validation".</span></span> 
    * <span data-ttu-id="ee80a-134">Le jeton provisoire ne peut pas être utilisé sans validation supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="ee80a-134">The provisional token can't be used without further validation.</span></span>
      1. <span data-ttu-id="ee80a-135">**Valider les informations reçues du fournisseur d’identité.**</span><span class="sxs-lookup"><span data-stu-id="ee80a-135">**Validate what's received from the identity provider.**</span></span> <span data-ttu-id="ee80a-136">La valeur du paramètre doit être confirmée par rapport à ce `state` qui a été enregistré précédemment.</span><span class="sxs-lookup"><span data-stu-id="ee80a-136">The value of the `state` parameter must be confirmed against what was saved earlier.</span></span> 
      1. <span data-ttu-id="ee80a-137">**Validez ce qui est reçu de Teams.**</span><span class="sxs-lookup"><span data-stu-id="ee80a-137">**Validate what's received from Teams.**</span></span> <span data-ttu-id="ee80a-138">Une [validation](https://en.wikipedia.org/wiki/Man-in-the-middle_attack) d’authentification en deux étapes est effectuée pour s’assurer que l’utilisateur qui a autorisé le bot auprès du fournisseur d’identité est le même utilisateur qui discute avec le bot.</span><span class="sxs-lookup"><span data-stu-id="ee80a-138">A [two-step authentication](https://en.wikipedia.org/wiki/Man-in-the-middle_attack) validation is performed to ensure that the user who authorized the bot with the identity provider is the same user who is chatting with the bot.</span></span> <span data-ttu-id="ee80a-139">Cela protège contre [les attaques de l’homme au](https://en.wikipedia.org/wiki/Man-in-the-middle_attack) milieu et les [attaques par hameçonnage.](https://en.wikipedia.org/wiki/Phishing)</span><span class="sxs-lookup"><span data-stu-id="ee80a-139">This guards against [man-in-the-middle](https://en.wikipedia.org/wiki/Man-in-the-middle_attack) and [phishing](https://en.wikipedia.org/wiki/Phishing) attacks.</span></span> <span data-ttu-id="ee80a-140">Le bot génère un code de vérification et le stocke, associé à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="ee80a-140">The bot generates a verification code and stores it, associated with the user.</span></span> <span data-ttu-id="ee80a-141">Le code de vérification est envoyé automatiquement par Teams comme décrit ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="ee80a-141">The verification code is sent automatically by Teams as described below.</span></span> <span data-ttu-id="ee80a-142">([Afficher le code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/AuthBot.ts#L100-L113))</span><span class="sxs-lookup"><span data-stu-id="ee80a-142">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/AuthBot.ts#L100-L113))</span></span>
9. <span data-ttu-id="ee80a-143">Le rappel OAuth rend une page qui appelle `notifySuccess("<verification code>")` .</span><span class="sxs-lookup"><span data-stu-id="ee80a-143">The OAuth callback renders a page that calls `notifySuccess("<verification code>")`.</span></span> <span data-ttu-id="ee80a-144">([Afficher le code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/master/src/views/oauth-callback-success.hbs))</span><span class="sxs-lookup"><span data-stu-id="ee80a-144">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/master/src/views/oauth-callback-success.hbs))</span></span>
10. <span data-ttu-id="ee80a-145">Teams ferme la fenêtre pop-up et renvoie le message envoyé `<verification code>` `notifySuccess()` au bot.</span><span class="sxs-lookup"><span data-stu-id="ee80a-145">Teams closes the pop-up window and sends the `<verification code>` sent to `notifySuccess()` back to the bot.</span></span> <span data-ttu-id="ee80a-146">Le bot reçoit un message [d’appel](/bot-framework/dotnet/bot-builder-dotnet-activities#invoke) avec `name = signin/verifyState` .</span><span class="sxs-lookup"><span data-stu-id="ee80a-146">The bot receives an [invoke](/bot-framework/dotnet/bot-builder-dotnet-activities#invoke) message with `name = signin/verifyState`.</span></span>
11. <span data-ttu-id="ee80a-147">Le bot vérifie le code de vérification entrant par rapport au code de vérification stocké avec le jeton provisoire de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="ee80a-147">The bot checks the incoming verification code against the verification code stored with the user's provisional token.</span></span> <span data-ttu-id="ee80a-148">([Afficher le code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/dialogs/BaseIdentityDialog.ts#L127-L140))</span><span class="sxs-lookup"><span data-stu-id="ee80a-148">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/dialogs/BaseIdentityDialog.ts#L127-L140))</span></span>
12. <span data-ttu-id="ee80a-149">S’ils correspondent, le bot marque le jeton comme validé et prêt à être utilisé.</span><span class="sxs-lookup"><span data-stu-id="ee80a-149">If they match, the bot marks the token as validated and ready for use.</span></span> <span data-ttu-id="ee80a-150">Sinon, le flux d’th échoue et le bot supprime le jeton provisoire.</span><span class="sxs-lookup"><span data-stu-id="ee80a-150">Otherwise, the auth flow fails, and the bot deletes the provisional token.</span></span>

    > [!NOTE]
    > <span data-ttu-id="ee80a-151">Si vous avez des problèmes avec l’authentification sur mobile, assurez-vous que votre SDK JavaScript est mis à jour vers la version 1.4.1 ou ultérieure.</span><span class="sxs-lookup"><span data-stu-id="ee80a-151">If you experience issues with authentication on mobile, ensure your JavaScript SDK is updated to version 1.4.1 or later.</span></span>

## <a name="code-sample"></a><span data-ttu-id="ee80a-152">Exemple de code</span><span class="sxs-lookup"><span data-stu-id="ee80a-152">Code sample</span></span>

<span data-ttu-id="ee80a-153">Exemple de code montrant le processus d’authentification du bot :</span><span class="sxs-lookup"><span data-stu-id="ee80a-153">Sample code showing the bot authentication process:</span></span>

| <span data-ttu-id="ee80a-154">**Exemple de nom**</span><span class="sxs-lookup"><span data-stu-id="ee80a-154">**Sample name**</span></span> | <span data-ttu-id="ee80a-155">**Description**</span><span class="sxs-lookup"><span data-stu-id="ee80a-155">**Description**</span></span> | <span data-ttu-id="ee80a-156">**Node.js**</span><span class="sxs-lookup"><span data-stu-id="ee80a-156">**Node.js**</span></span> | <span data-ttu-id="ee80a-157">**.NET**</span><span class="sxs-lookup"><span data-stu-id="ee80a-157">**.NET**</span></span> | <span data-ttu-id="ee80a-158">**Python**</span><span class="sxs-lookup"><span data-stu-id="ee80a-158">**Python**</span></span> |
|-----------------|----------------|--------------|----------|-----------|
| <span data-ttu-id="ee80a-159">Teams’authentification</span><span class="sxs-lookup"><span data-stu-id="ee80a-159">Teams authentication</span></span> | <span data-ttu-id="ee80a-160">Cet exemple illustre l’authentification dans Microsoft Teams applications.</span><span class="sxs-lookup"><span data-stu-id="ee80a-160">This sample demonstrates authentication in Microsoft Teams apps.</span></span> | [<span data-ttu-id="ee80a-161">View</span><span class="sxs-lookup"><span data-stu-id="ee80a-161">View</span></span>](https://github.com/OfficeDev/microsoft-teams-sample-auth-node) | | |
| <span data-ttu-id="ee80a-162">Authentification bot</span><span class="sxs-lookup"><span data-stu-id="ee80a-162">Bot authentication</span></span> | <span data-ttu-id="ee80a-163">Cet exemple vous apprendre à utiliser l’authentification pour un runnning de bot dans Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="ee80a-163">This sample demonstartes how to use authentication for a bot runnning in Microsoft Teams</span></span> | [<span data-ttu-id="ee80a-164">View</span><span class="sxs-lookup"><span data-stu-id="ee80a-164">View</span></span>](https://github.com/microsoft/BotBuilder-Samples/tree/main/samples/javascript_nodejs/46.teams-auth) | [<span data-ttu-id="ee80a-165">View</span><span class="sxs-lookup"><span data-stu-id="ee80a-165">View</span></span>](https://github.com/microsoft/BotBuilder-Samples/tree/main/samples/csharp_dotnetcore/46.teams-auth) | [<span data-ttu-id="ee80a-166">View</span><span class="sxs-lookup"><span data-stu-id="ee80a-166">View</span></span>](https://github.com/microsoft/BotBuilder-Samples/tree/main/samples/python/46.teams-auth)

## <a name="see-also"></a><span data-ttu-id="ee80a-167">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="ee80a-167">See also</span></span>

[<span data-ttu-id="ee80a-168">Ajouter l’authentification à Teams bot</span><span class="sxs-lookup"><span data-stu-id="ee80a-168">Add authentication to your Teams bot</span></span>](add-authentication.md)
