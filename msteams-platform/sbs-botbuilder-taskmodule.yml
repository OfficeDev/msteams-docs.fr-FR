### YamlMime:Tutorial
title: Appeler des modules de tâches à partir de Microsoft Teams
metadata:
  title: Appeler des modules de tâches à partir de Microsoft Teams
  description: Avec ce module d’apprentissage, découvrez comment configurer le module de tâches Teams à l’aide de cartes adaptatives ou de cartes Bot Framework.
  audience: Developer
  level: Beginner
  ms.date: 23/02/2022
  ms.topic: interactive-tutorial
  nextTutorialHref: task-modules-and-cards/task-modules/task-modules-bots.md
  nextTutorialTitle: En savoir plus sur les modules de tâches à partir de bots
  ms.custom: mvc
  ms.localizationpriority: High
  ms.openlocfilehash: d4f223146660c75fcd6ee7165d1f898390fbb603
  ms.sourcegitcommit: 42602e8ec917f5033c0b6a95cf65b428db3c5b0a
  ms.translationtype: MT
  ms.contentlocale: fr-FR
  ms.lasthandoff: 08/09/2022
  ms.locfileid: "67286006"
items:
- durationInMinutes: 1
  content: >
    Vous pouvez appeler des modules de tâches à partir de bots Teams à l’aide de cartes adaptatives ou de cartes Bot Framework.


    **Principales fonctionnalités des modules de tâches**


    * Améliorez l’expérience utilisateur en évitant plusieurs étapes.

    * Aider les utilisateurs à suivre l’état du bot.

    * Récupérez l’entrée à partir de l’utilisateur et affichez le contenu de la page web personnalisée.


    Ce guide pas à pas vous aide à créer un exemple de bot Azure pour appeler le module de tâche Teams. La sortie suivante s’affiche :

     ![Module de tâche](~/assets/images/Teams-task-module/final_image.png)
- title: Conditions préalables
  durationInMinutes: 1
  content: "Veillez à installer les outils suivants et à configurer votre environnement de développement : \n\n* [Microsoft Teams](https://teams.microsoft.com/) avec un compte valide\n* [Kit de développement logiciel (SDK) .NET Core](https://dotnet.microsoft.com/download) version 3.1\n* [Dernière version de Microsoft Visual Studio](https://visualstudio.microsoft.com/downloads/)\n* [ngrok](https://ngrok.com/download) version la plus récente ou toute solution de tunneling équivalente\n\n  > [!NOTE]\n  > Après avoir téléchargé ngrok, inscrivez-vous et installez [authtoken](https://ngrok.com/download).\n"
- title: Configurer un environnement local
  durationInMinutes: 1
  content: "Clonez `BotBuilder-Samples` le référentiel sur votre GitHub local :  \n\n 1. Ouvrez les [exemples BotBuilder](https://github.com/microsoft/BotBuilder-Samples).\n 1. Sélectionnez **Code**.\n 1. Dans le menu déroulant, sélectionnez **Ouvrir avec GitHub Desktop**.\n\n    ![Cloner le référentiel](~/assets/images/Teams-task-module/clonerepository.png)\n\n 1. Sélectionnez **Cloner**. \n"
- title: Créer et inscrire votre bot dans le portail Azure AD
  durationInMinutes: 5
  content: "Pour créer et inscrire votre bot dans Microsoft Azure Active Directory (Azure AD), créer un tunnel à l’aide de ngrok et ajouter un point de terminaison de messagerie, procédez comme suit :\n\n* Créez une ressource Azure Bot pour inscrire un bot auprès d’Azure Bot Service.\n* Créez une clé secrète client pour activer l’authentification unique du bot.\n* Ajoutez un canal Teams pour déployer le bot sur un canal Teams.\n* Utilisez ngrok pour créer un tunnel vers les points de terminaison de votre serveur web.\n* Ajoutez un point de terminaison de messagerie au tunnel ngrok que vous avez créé.\n\n**Pour créer une ressource Azure Bot**\n\n1. Accédez au [Portail Azure Microsoft](https://portal.azure.com/).\n1. Sélectionnez **Créer une ressource**.\n1. Dans la zone de recherche, entrez **Azure Bot**.\n1. Ensuite, sélectionnez **Entrée**.\n1. Sélectionnez **Azure Bot**.\n\n     :::image type=\"content\" source=\"./assets/images/azure-bot.png\" alt-text=\"Bot Azure.\":::\n\n1. Sélectionnez **Créer**.\n1. Entrez le nom de handle de bot requis dans le **handle bot**.\n1. Sélectionnez votre **abonnement** dans la liste déroulante.\n1. Sélectionnez votre **groupe de ressources** dans la liste déroulante. \n\n    ![Sélectionner un bot Azure de ressource](~/assets/images/Teams-task-module/review-plus-create.png) \n\n   Vous pouvez également créer un groupe de ressources (sélectionnez **Créer** > entrez le nom de la ressource > sélectionnez **OK**).\n\n1. Si vous avez créé un groupe de ressources, sélectionnez l’emplacement requis dans la liste déroulante **Nouvel emplacement du groupe de ressources** .\n\n    ![Nouvel emplacement du groupe de ressources](~/assets/images/bots/newresource.png)\n\n1. Dans la section **ID d’application Microsoft** , par défaut, **créer un ID d’application Microsoft** est sélectionné. \n\n   Vous pouvez sélectionner **Utiliser l’inscription d’application existante** et entrer l’ID **d’application existant** et le **mot de passe d’application existant**, ou sélectionner **Créer un nouvel ID d’application Microsoft**.\n\n   > [!NOTE]\n   > Vous ne pouvez pas créer plusieurs bots avec le même **ID d’application Microsoft**.\n\n1. Sélectionnez **MultiTenant** sous Type de bot.\n\n    ![ID d’application Microsoft](~/assets/images/Teams-task-module/config.png)\n\n1. Sélectionnez **Examiner et créer**.\n\n    ![Créer un ID d’application Microsoft](~/assets/images/meeting-token-generator/meeting-token-generator-appidcreate.png)\n\n1. Si la validation réussit, sélectionnez **Créer**. \n\n    L’approvisionnement de votre service de bot prend quelques instants. \n\n1. Sélectionnez **Accéder à la ressource**. \n\n    ![Déployer l’application](~/assets/images/Teams-task-module/botdeployment.png)\n\n    Votre bot Azure est créé.\n\n    ![Ressource de bot Azure créée](~/assets/images/Teams-task-module/bot-page.png)\n\n**Pour créer une clé secrète client**\n\n  Effectuez les étapes suivantes si vous avez créé un **nouvel ID d’application Microsoft** :\n\n1. Dans le volet gauche, sélectionnez **Configuration**. \n\n   > [!TIP]\n   > Enregistrez **l’ID d’application Microsoft** ou **l’ID client** pour référence ultérieure.\n\n1. En regard de **l’ID d’application Microsoft**, **sélectionnez Gérer**.\n\n1. Dans la section **Secrets client** , sélectionnez **Nouvelle clé secrète client**. \n\n    ![Nouvelle clé secrète client](~/assets/images/meetings-side-panel/newclientsecret.png)\n\n   La fenêtre **Ajouter une clé secrète client** s’affiche.  \n\n1. Entrez **la description**.\n\n1. Sélectionnez **Ajouter**.\n\n    ![Ajouter une clé secrète client à l’application](~/assets/images/Teams-task-module/clientsecret.png)\n\n1. Dans la colonne **Valeur** , sélectionnez **Copier dans le Presse-papiers**.\n\n     ![Valeur de la clé secrète client](~/assets/images/Teams-task-module/clientvalue.png)\n   \n   > [!TIP]\n   > Enregistrez la valeur **des secrets client** ou le mot de passe d’application pour référence ultérieure.\n\n**Pour ajouter le canal Teams**\n\n1. Sélectionnez **Accueil**.\n\n    ![Page d’accueil](~/assets/images/Teams-task-module/gotohome.png)\n\n1. Sélectionnez votre bot dans **les ressources récentes**.\n\n1. Sélectionnez **Canaux** dans le volet gauche, puis **Microsoft Teams** <img src=\"~/assets/images/bots/teamsicon.png\" alt=\"Teams icon\" width=\"20\"/>.\n\n     :::image type=\"content\" source=\"~/assets/images/adaptive-cards/channel-teams.png\" alt-text=\"Sélectionner Teams dans les canaux\":::\n     \n1. Cochez la case pour accepter les **conditions d’utilisation**.\n\n1. Sélectionnez **Accepter**.\n\n      ![Conditions d’utilisation](~/assets/images/meetings-side-panel/terms.png)\n\n1. Sélectionnez **Enregistrer**.\n\n      ![Sélectionner Teams](~/assets/images/Teams-task-module/configteams.png)   \n\n**Pour créer un tunnel pour un serveur web local**\n\nUtilisez ngrok pour créer un tunnel vers les points de terminaison HTTPS disponibles publiquement de votre serveur web local. Exécutez la commande suivante dans ngrok :\n\n ```bash\n ngrok http --host-header=rewrite 3978\n ```\n\n> [!TIP]\n> Si vous rencontrez **ERR_NGROK_4018**, suivez les étapes fournies dans l’invite de commandes pour vous inscrire et authentifier ngrok. Exécutez ensuite la commande `ngrok http --host-header=localhost 3978`.\n\n**Pour ajouter un point de terminaison de messagerie**\n\n1. À partir de ngrok, copiez l’URL HTTPS (https vers io).\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/ngrok-url.png\" alt-text=\"URL HTTPS ngrok\":::\n\n    > [!NOTE]\n    > L’URL HTTPS dans votre ngrok est votre nom de domaine complet.\n    > Il `WebAppDomain` s’agit d’un nom de domaine complet qui ne l’inclut `https://` pas.\n\n1. Dans **Paramètres** du bot Azure que vous avez créé, sélectionnez **Configuration**.\n\n1. Dans **le point de terminaison de messagerie**, utilisez l’URL HTTPS disponible à partir de ngrok et, à la fin de l’URL, ajoutez **/api/messages**.\n\n    ![Point de terminaison de messagerie](~/assets/images/Teams-task-module/messaging-endpoint.png)\n\n1. Sélectionnez **Appliquer**.\n\n    Vous avez correctement configuré un bot dans Azure Bot Service.\n"
- title: Mettre à jour l’inscription d’application Azure AD
  durationInMinutes: 1
  content: "1. Accédez au [Portail Azure](https://portal.azure.com/).\n\n1. Sélectionnez **Azure Active Directory**.\n\n1. Dans le volet de navigation gauche, sélectionnez **Inscriptions d’applications**.\n\n1. Sélectionnez votre bot.\n\n   ![Inscription d’application](~/assets/images/Teams-task-module/appregister.png)\n\n1. Sélectionnez **Gérer**.\n\n1. Dans le volet gauche, sélectionnez **Exposer** **une API**.\n\n1. Sélectionnez **Définir**.\n\n   ![Exposer une API](~/assets/images/Teams-task-module/exposeanapi.png)\n\n1. Définissez **l’URI d’ID d’application** sous la forme de `api://{AppID}`.\n\n   ![Définir le lien](~/assets/images/Teams-task-module/setlink.png)\n\n1. Insérer la `WebAppDomain` valeur entre `api://` et `/{AppID}`.</br>\n    `api://d4b8****.ngrok.io/{AppID}`</br>\n    \n   L’image suivante montre le nom de domaine :\n    \n    ![URI ID d'application](~/assets/images/Teams-task-module/appIDuri.png)\n\n    > [!NOTE]\n    > Si vous utilisez un service de tunneling tel que ngrok, veillez à mettre à jour la valeur chaque fois que votre sous-domaine ngrok change.\n    > `For example: api://f631****.ngrok.io/92c11075-c629-4a1e-ab58-02b4fd4204c2`, où `f631****.ngrok.io` se trouve le nouveau nom du sous-domaine ngrok.\n\n1. Sélectionnez **Ajouter une étendue**. \n\n   ![Sélectionnez l’étendue](~/assets/images/meetings-side-panel/selectscope.png)\n\n1. Dans le panneau qui s’affiche, entrez `access_as_user` le **nom de l’étendue**.\n\n1. Définir **qui peut donner son consentement ?** sur `Admins and users`.\n\n1. Pour configurer les invites de consentement de l’administrateur et de l’utilisateur avec les valeurs appropriées pour `access_as_user` l’étendue, fournissez les informations suivantes dans les champs :</br>\n\n     * Entrez `Teams can access the user’s profile` **Administration nom d’affichage du consentement**.\n\n     * Entrez `Allows Teams to call the app’s web APIs as the current user` **Administration description du consentement**.\n\n     * Entrez `Teams can access the user profile and make requests on the user’s behalf` en tant que **nom d’affichage du consentement de l’utilisateur**.\n\n     * Entrez `Enable Teams to call this app’s APIs with the same rights as the user` comme **description du consentement de l’utilisateur**.\n\n1. Vérifiez que **State** est défini comme **Enabled**.\n\n1. Sélectionnez **Ajouter une étendue** à enregistrer.\n\n    ![Ajouter une étendue](~/assets/images/Teams-task-module/addascope.png)\n\n    > [!NOTE]\n    > Le **nom de l’étendue** doit correspondre à l’URI **d’ID d’application** avec `/access_as_user` ajouté à la fin.</br>\n       `api://d4b8****.ngrok.io/00000000-0000-0000-0000-000000000000/access_as_user`\n\n    ![Étendues](~/assets/images/Teams-task-module/scopes.png) \n\n1. Dans la section **Applications clientes autorisées**, identifiez les applications que vous souhaitez autoriser pour l'application Web de votre application. \n\n1. Sélectionnez **Ajouter une application cliente**. \n\n    ![Sélectionner une application cliente](~/assets/images/meetings-side-panel/selectclientapp.png) \n\n1. Entrez **l’ID client** : `1fec8e78-bce4-4aaf-ab1b-5451cc387264` pour l’application mobile ou de bureau Teams. \n\n    ![Ajouter une application cliente 1](~/assets/images/meetings-side-panel/addclientapplication1.png) \n\n   Entrez **l’ID client** : `5e3ce6c0-2b1f-4285-8d4b-75ee78787346` pour l’application web Teams.\n\n    ![Ajouter une application cliente 2](~/assets/images/meetings-side-panel/addclientapplication2.png) \n\n1. Sélectionnez **Étendues autorisées**.\n\n    ![Ajouter une application cliente 2](~/assets/images/Teams-task-module/authorizedscope.png) \n\n   L’image suivante affiche les ID clients :\n\n    ![Applications clientes](~/assets/images/meetings-side-panel/clientapps.png) \n\n1. Dans le volet gauche, sélectionnez **Autorisations d’API**. \n\n   > [!NOTE]\n   > Les utilisateurs doivent donner leur consentement aux autorisations d’API uniquement si l’application Azure AD est inscrite dans un autre locataire.\n\n1. Sélectionnez **Ajouter une autorisation**.\n\n    ![Ajouter une autorisation](~/assets/images/meetings-side-panel/addpermission.png)\n\n1. Sélectionnez **Microsoft Graph**.\n\n1. Sélectionnez **Autorisations déléguées**.\n\n1. Sélectionnez les autorisations suivantes :</br>\n     * **email**\n     * **offline_access**\n     * **Openid**\n     * **profil**\n      * **User.Read**\n\n1. Sélectionnez **Ajouter des autorisations**.\n\n     ![Autres autorisations](~/assets/images/meetings-side-panel/other-permissions.png)\n\n1. Dans le volet gauche, sélectionnez **Authentification** pour définir un URI de redirection. \n\n   > [!NOTE]\n   > Si aucune application n’a reçu le consentement de l’administrateur informatique, les utilisateurs doivent donner leur consentement la première fois qu’ils utilisent une application.\n           \n     1. Sélectionnez **Ajouter une plateforme**.\n     1. Sélectionnez **Web**.\n\n        ![Web](~/assets/images/Teams-task-module/webauth.png)\n\n     1. Entrez l’URI de redirection de votre application en ajoutant `auth-end` le nom de domaine complet :</br> \n       `https://d4b8****.ngrok.io/auth-end`. </br>\n\n     1. Activez **l’octroi implicite et les flux hybrides** en cochant les cases suivantes :\n         * **Jetons d’ID**\n         * **Jetons d’accès**\n\n     1. Sélectionnez **Configurer**.\n\n        ![Fin de l’authentification](~/assets/images/Teams-task-module/authend.png)\n"
- title: Configurer les paramètres d’application et les fichiers manifeste
  durationInMinutes: 1
  content: "1. Accédez à **appsettings.json** dans le référentiel cloné.\n\n    ![Emplacement des paramètres de l’application](~/assets/images/Teams-task-module/appsettingslocation.png)\n\n1. Ouvrez **appsettings.json** dans la dernière version de Visual Studio et mettez à jour les informations suivantes :  \n\n     * Défini sur `\"MicrosoftAppType\"` **MultiTenant**.\n     * Définissez l’ID `\"MicrosoftAppId\"` **d’application Microsoft** de votre bot.\n     * Définissez la `\"MicrosoftAppPassword\"` **valeur** de la **clé secrète client**.\n     * Définissez `\"MicrosoftAppTenantId\"` l’ID de locataire du locataire où l’application est utilisée.\n     * Définissez `\"BaseUrl\"` le nom de domaine complet (https sur io).\n\n    ![Paramètres de l’application](~/assets/images/Teams-task-module/appsettings.png)\n\n1. Accédez à « manifest.json » dans le référentiel cloné.\n\n    ![Emplacement du fichier manifeste](~/assets/images/Teams-task-module/manifestlocation.png)\n\n1. Ouvrez « manifest.json » dans la dernière version de Visual Studio et apportez les modifications suivantes :\n\n     * Remplacez toutes les occurrences par `YourDeployedBotUrl.com` votre `WebAppDomain` nom.\n     * Remplacez toutes les occurrences par **l’ID d’application**`<<YOUR-MICROSOFT-APP-ID>>` Microsoft de votre bot.\n\n    ![Image de manifeste2](~/assets/images/Teams-task-module/manifest.png)\n"
- title: Générer et exécuter le service
  durationInMinutes: 1
  content: "**Pour générer et exécuter le service à l’aide de la dernière version de Visual Studio ou de la ligne de commande**\n\n# <a name=\"latest-version-of-visual-studio\"></a>[Dernière version de Visual Studio](#tab/latestversionofvisualstudio)\n\n   1. Lancez la dernière version de Visual Studio.\n   1. Accédez à **File** > **Open** > **Project/Solution**.\n\n      ![Ouvrir le fichier](~/assets/images/meeting-token-generator/meeting-token-generator-VSopenfile.png)\n\n   1. Sélectionnez le fichier **TeamsTaskModule.csproj** dans **le dossier 54.teams-task-module** .\n\n      ![Fichier proj CS](~/assets/images/Teams-task-module/csprojfileopen.png)\n\n   1. Ouvrez **Explorateur de solutions** à partir de **View**.\n\n      ![Explorateur de solutions](~/assets/images/Teams-task-module/solutionexplorer.png)\n\n   1. Cliquez avec le bouton droit pour sélectionner **TeamsTaskModule**.\n\n   1. Sélectionnez **Définir comme projet de démarrage**.\n\n      ![Explorateur de solutions](~/assets/images/Teams-task-module/startup.png)\n\n   1. Appuyez sur **F5** pour exécuter le projet.\n\n   1. Sélectionnez **Oui** si la boîte de dialogue suivante s’affiche :\n\n      ![Certificat d’approbation](~/assets/images/sbs-messagingextension-action/certificate.png)\n\n      Une page web s’ouvre avec un message **indiquant que votre bot est prêt!**.\n\n      ![Application prête](~/assets/images/Teams-task-module/appisready.png) \n\n    \n# <a name=\"command-line\"></a>[Ligne de commande](#tab/cli)\n\nAccédez à **BotBuilder-Samples > exemples > csharp_dotnetcore > 54.teams-task-module** dans la fenêtre Invite de commandes et entrez la commande suivante :\n\n```bash\ndotnet run\n```\n\n![Dotnet](~/assets/images/Teams-task-module/dotnetruncmd.png)\n"
- title: Charger l’application module de tâches
  durationInMinutes: 1
  content: "1. Dans votre référentiel cloné, accédez à **csharp_dotnetcore > 54.teams-task-module > TeamsAppManifest**.\n\n1. Créez un .zip avec les fichiers suivants présents dans le dossier **TeamsAppManifest** : \n   * manifest.json\n   * icon-outline.png\n   * icon-color.png\n\n   ![Fichier zip](~/assets/images/Teams-task-module/zip-file.png) \n\n1. Accédez à **Microsoft Teams**.\n\n1. Sélectionner **les applications**.\n\n   ![Fichier zip](~/assets/images/Teams-Messaging-Extensions-Search/AppStore.png)\n\n1. Dans le coin inférieur gauche, sélectionnez **Gérer vos applications**.\n\n   ![Gérer les applications](~/assets/images/Teams-task-module/manage-apps.png)\n\n1. Sélectionnez **Charger une application dans le catalogue d’applications de votre organisation**. \n\n   ![Charger une application personnalisée](~/assets/images/Teams-task-module/upload-app.png)\n\n1. Sélectionnez **Ouvrir** pour charger le fichier .zip que vous avez créé dans le dossier **TeamsAppManifest** .\n\n   ![Sélectionner un fichier zip](~/assets/images/Teams-task-module/select-zip.png)\n\n1. Sélectionnez **Ajouter**.\n\n   ![Ajouter l’application](~/assets/images/Teams-task-module/add-app.png)\n\n   L’application s’ouvre dans une conversation.\n\n1. Entrez du texte, puis sélectionnez Entrée. \n\n   ![Conversation](~/assets/images/Teams-task-module/chat_ready.png)\n\n   L’application affiche **l’appel de module de tâche à partir de la carte hero** et l’appel **du module de tâche à partir de la carte adaptative**.         \n"
- title: Interagir avec l’application dans Teams
  durationInMinutes: 1
  content: >
    1. Sélectionnez **la carte adaptative** à **partir de l’appel de module de tâche à partir d’une carte hero** ou **d’un appel de module de tâche à partir d’une carte adaptative**.

       ![Carte adaptative](~/assets/images/Teams-task-module/adaptive-card.png)

    1. Entrez du texte.


    1. Sélectionnez **Envoyer**.

       ![Texte de la carte adaptative](~/assets/images/Teams-task-module/adaptive-card-text.png)

       **La carte adaptative** envoie un message d’accusé de réception.

       ![Envoi de carte adaptative](~/assets/images/Teams-task-module/adaptive-card-submit.png)

    1. Sélectionnez **le formulaire personnalisé** dans **l’appel de module de tâche à partir d’une carte hero** ou **d’un appel de module de tâche à partir d’une carte adaptative**.

       ![Formulaire personnalisé](~/assets/images/Teams-task-module/custom-form.png)

    1. Entrez les informations requises :

       * **Name**
       * **Courrier électronique**
       * **Livre favori**
       * **Password**
       * **Confirmer le mot de passe**

    1. Sélectionnez **S’inscrire**.

       ![Texte du formulaire personnalisé](~/assets/images/Teams-task-module/custom-text.png)

       **Le formulaire personnalisé** envoie un message d’accusé de réception.

       ![S’inscrire](~/assets/images/Teams-task-module/custom-on-sign-up.png)

       Les informations suivantes s’affichent dans la conversation :

       ![Conversation](~/assets/images/Teams-task-module/adaptive-custom-chat.png)

    1. Sélectionnez **You Tube** from **Task Module Invocation from Hero Card** ou **Task Module Invocation from Adaptive Card**.

       ![YouTube](~/assets/images/Teams-task-module/youtube.png)

    1. Sélectionnez **Lire**.

       ![YouTube select](~/assets/images/Teams-task-module/youtube-select.png)

       La vidéo est lue.
- title: Relever le défi
  durationInMinutes: 1
  content: >
    Tu as trouvé quelque chose comme ça ?

       ![Module de tâche](~/assets/images/Teams-task-module/final_image.png)
- content: Vous avez terminé le didacticiel pour commencer à utiliser l’application de module de tâches Teams !
