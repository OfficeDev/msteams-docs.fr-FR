---
title: Modifications de l’API bot pour les membres Team/Chat (mise à jour 2020)
author: ojasvichoudhary
description: Décrit les modifications à venir et en cours pour les API bot utilisées pour extraire des membres de teams et des conversations
keywords: Liste des membres de l’équipe des API de l’infrastructure bot
ms.topic: reference
ms.author: ojchoudh
ms.openlocfilehash: 243969796d9d1dc427ab7736cf5e0f0d320731c7
ms.sourcegitcommit: 3fc7ad33e2693f07170c3cb1a0d396261fc5c619
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/29/2020
ms.locfileid: "48796142"
---
# <a name="changes-to-teams-bot-apis-for-fetching-teamchat-members"></a><span data-ttu-id="fed43-104">Modifications apportées aux API de robots teams pour la récupération des membres de l’équipe/conversation</span><span class="sxs-lookup"><span data-stu-id="fed43-104">Changes to Teams Bot APIs for Fetching Team/Chat Members</span></span>

<span data-ttu-id="fed43-105">Actuellement, les développeurs de robots qui souhaitent récupérer des informations pour un ou plusieurs membres d’une conversation ou d’une équipe utilisent les API Microsoft teams bot `TeamsInfo.GetMembersAsync` (pour C#) ou `TeamsInfo.getMembers` (pour la machine à écrire/Node.js) [(documentée ici)](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetching-the-roster-or-user-profile).</span><span class="sxs-lookup"><span data-stu-id="fed43-105">Currently, bot developers who want to retrieve information for one or more members of a chat or team use the Microsoft Teams bot APIs `TeamsInfo.GetMembersAsync` (for C#) or `TeamsInfo.getMembers` (for TypeScript/Node.js) APIs [(documented here)](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetching-the-roster-or-user-profile).</span></span> <span data-ttu-id="fed43-106">Ces API présentent aujourd’hui plusieurs lacunes :</span><span class="sxs-lookup"><span data-stu-id="fed43-106">These APIs have several shortcomings today:</span></span>

* <span data-ttu-id="fed43-107">**Pour les grandes équipes, les performances sont médiocres et les délais d’attente sont plus probables.**</span><span class="sxs-lookup"><span data-stu-id="fed43-107">**For large teams, performance is poor and timeouts are more likely.**</span></span> <span data-ttu-id="fed43-108">La taille maximale de l’équipe a augmenté considérablement depuis la publication de Microsoft teams en début de 2017.</span><span class="sxs-lookup"><span data-stu-id="fed43-108">The maximum team size has grown considerably since Microsoft Teams was released in early 2017.</span></span> <span data-ttu-id="fed43-109">Étant donné que `GetMembersAsync` / `getMembers` renvoie la liste des membres dans son intégralité, l’appel de l’API prend beaucoup de temps pour être renvoyé pour les grandes équipes et n’est pas rare pour l’appel au délai d’expiration et vous devez recommencer.</span><span class="sxs-lookup"><span data-stu-id="fed43-109">Since `GetMembersAsync`/`getMembers` returns the entire member list, it takes a long time for the API call to return for large teams, and it’s not uncommon for the call to time out and you have to try again.</span></span>
* <span data-ttu-id="fed43-110">**L’obtention des détails du profil pour un seul utilisateur est lourde.**</span><span class="sxs-lookup"><span data-stu-id="fed43-110">**Getting profile details for a single user is cumbersome.**</span></span> <span data-ttu-id="fed43-111">Pour obtenir les informations de profil d’un utilisateur, vous devez récupérer toute la liste de membres, puis Rechercher celle de votre choix.</span><span class="sxs-lookup"><span data-stu-id="fed43-111">To get the profile information for a single user, you have to retrieve the entire member list and then search for the one you want.</span></span> <span data-ttu-id="fed43-112">True, il y a une fonction d’assistance dans le kit de développement logiciel (SDK) de l’infrastructure pour faciliter sa création, mais sous les couvertures, elle n’est pas efficace.</span><span class="sxs-lookup"><span data-stu-id="fed43-112">True, there’s a helper function in the Bot Framework SDK to make it simpler, but under the covers it’s not efficient.</span></span>

<span data-ttu-id="fed43-113">Séparément, avec l’introduction de teams à l’échelle de l’organisation, nous avons réalisé qu’il était temps de mieux aligner ces API avec les contrôles de confidentialité Office 365 : les robots utilisés dans les grandes équipes sont en mesure de récupérer des informations de profil de base, qui sont semblables à l' `User.ReadBasic.All` autorisation Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="fed43-113">Separately, with the introduction of org-wide teams, we realized it was time to better align these APIs with Office 365 privacy controls: bots used in large teams are able to retrieve basic profile information, which is similar to the `User.ReadBasic.All` Microsoft Graph permission.</span></span> <span data-ttu-id="fed43-114">Les administrateurs clients ont beaucoup de contrôle sur les applications et les robots pouvant être utilisés dans leur client, mais ces paramètres diffèrent de ceux qui régissent Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="fed43-114">Tenant administrators have a great deal of control over which apps and bots can be used in their tenant, but these settings are different than the ones governing Microsoft Graph.</span></span>

<span data-ttu-id="fed43-115">Voici un exemple de représentation JSON de ce qui est renvoyé par ces API dès aujourd’hui.</span><span class="sxs-lookup"><span data-stu-id="fed43-115">Here’s a sample JSON representation of what’s returned by these APIs today.</span></span> <span data-ttu-id="fed43-116">Voici quelques-uns des champs ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="fed43-116">I’ll refer to some of the fields below.</span></span>

```json
[{
    "id": "29:1GcS4EyB_oSI8A88XmWBN7NJFyMqe3QGnJdgLfFGkJnVelzRGos0bPbpsfJjcbAD22bmKc4GMbrY2g4JDrrA8vM06X1-cHHle4zOE6U4ttcc",
    "name": "Anon1 (Guest)",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "anonymous"
}, {
    "id": "29:1bSnHZ7Js2STWrgk6ScEErLk1Lp2zQuD5H2qQ960rtvstKp8tKLl-3r8b6DoW0QxZimuTxk_kupZ1DBMpvIQQUAZL-PNj0EORDvRZXy8kvWk",
    "objectId": "76b0b09f-d410-48fd-993e-84da521a597b",
    "givenName": "John",
    "surname": "Patterson",
    "email": "johnp@fabrikam.com",
    "userPrincipalName": "johnp@fabrikam.com",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "user"
}, {
    "id": "29:1URzNQM1x1PNMr1D7L5_lFe6qF6gEfAbkdG8_BUxOW2mTKryQqEZtBTqDt10-MghkzjYDuUj4KG6nvg5lFAyjOLiGJ4jzhb99WrnI7XKriCs",
    "objectId": "6b7b3b2a-2c4b-4175-8582-41c9e685c1b5",
    "givenName": "Rick",
    "surname": "Stevens",
    "email": "Rick.Stevens@fabrikam.com",
    "userPrincipalName": "rstevens@fabrikam.com",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "user"
}]
```

## <a name="api-changes"></a><span data-ttu-id="fed43-117">Modifications de l’API</span><span class="sxs-lookup"><span data-stu-id="fed43-117">API Changes</span></span>
<span data-ttu-id="fed43-118">Voici les modifications d’API à venir :</span><span class="sxs-lookup"><span data-stu-id="fed43-118">Here are the upcoming API changes:</span></span>

* <span data-ttu-id="fed43-119">Nous avons créé une nouvelle API [`TeamsInfo.GetPagedMembersAsync`](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetching-the-roster-or-user-profile) pour récupérer des informations de profil pour les membres d’une conversation/équipe.</span><span class="sxs-lookup"><span data-stu-id="fed43-119">We've created a new API [`TeamsInfo.GetPagedMembersAsync`](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetching-the-roster-or-user-profile) for retrieving profile information for members of a chat/team.</span></span> <span data-ttu-id="fed43-120">Cette API est désormais disponible avec le kit de développement logiciel (SDK) de robot Framework 4,8.</span><span class="sxs-lookup"><span data-stu-id="fed43-120">This API is now available with the Bot Framework 4.8 SDK.</span></span> <span data-ttu-id="fed43-121">Pour le développement dans toutes les autres versions, utilisez la [`GetConversationPagedMembers`](https://docs.microsoft.com/dotnet/api/microsoft.bot.connector.conversationsextensions.getconversationpagedmembersasync?view=botbuilder-dotnet-stable) méthode.</span><span class="sxs-lookup"><span data-stu-id="fed43-121">For development in all other versions use the [`GetConversationPagedMembers`](https://docs.microsoft.com/dotnet/api/microsoft.bot.connector.conversationsextensions.getconversationpagedmembersasync?view=botbuilder-dotnet-stable) method.</span></span> <span data-ttu-id="fed43-122">**Remarque** : dans la version 3 ou v4, la meilleure mesure consiste à effectuer une mise à niveau vers la version la plus récente (3.30.2 ou 4,8, respectivement).</span><span class="sxs-lookup"><span data-stu-id="fed43-122">**Note** : In either v3 or v4, the best action is to upgrade to the latest point release (3.30.2 or 4.8 respectively).</span></span> 
* <span data-ttu-id="fed43-123">Nous avons créé une nouvelle API [`TeamsInfo.GetMemberAsync`](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#get-single-member-details) pour extraire les informations de profil pour un utilisateur unique.</span><span class="sxs-lookup"><span data-stu-id="fed43-123">We've created a new API [`TeamsInfo.GetMemberAsync`](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#get-single-member-details) for retrieving the profile information for a single user.</span></span> <span data-ttu-id="fed43-124">Il prend l’ID de l’équipe/conversation et un [UPN](https://docs.microsoft.com/windows/win32/ad/naming-properties#userprincipalname) ( `userPrincipalName` , *voir ci-dessus* ), Azure Active Directory Object ID ( `objectId` , *voir ci-dessus* ) ou l’ID utilisateur Teams ( `id` *voir ci-dessus* ) comme paramètres et renvoie les informations de profil de cet utilisateur.</span><span class="sxs-lookup"><span data-stu-id="fed43-124">It takes the ID of the team/chat and a [UPN](https://docs.microsoft.com/windows/win32/ad/naming-properties#userprincipalname) (`userPrincipalName`, *see above* ), Azure Active Directory Object ID (`objectId`, *see above* ), or the Teams user ID (`id`, *see above* ) as parameters and returns the profile information for that user.</span></span> <span data-ttu-id="fed43-125">**Remarque** : nous modifions `objectId` pour qu' `aadObjectId` il corresponde à ce qu’il est appelé dans l' `Activity` objet d’un message de l’infrastructure bot.</span><span class="sxs-lookup"><span data-stu-id="fed43-125">**Note** : We're changing `objectId` to `aadObjectId` to match what it's called in the `Activity` object of a Bot Framework message.</span></span> <span data-ttu-id="fed43-126">La nouvelle API est disponible avec la version 4,8 du kit de développement logiciel (SDK) de l’infrastructure bot.</span><span class="sxs-lookup"><span data-stu-id="fed43-126">The new API is available with version 4.8 of the Bot Framework SDK.</span></span> <span data-ttu-id="fed43-127">Il sera bientôt disponible dans l’infrastructure de l’extension du kit de développement logiciel (SDK) teams 3. x. en attendant, vous pouvez utiliser le point de terminaison [Rest](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#get-single-member-details) .</span><span class="sxs-lookup"><span data-stu-id="fed43-127">It will soon be available in the Teams SDK extension Bot Framework 3.x as well; meanwhile you can use the [REST](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#get-single-member-details) endpoint.</span></span>
* <span data-ttu-id="fed43-128">`TeamsInfo.GetMembersAsync` (C#) et `TeamsInfo.getMembers` (machine à écrire/Node.js) est explicitement déconseillée et cessera de fonctionner en fin de 2021.</span><span class="sxs-lookup"><span data-stu-id="fed43-128">`TeamsInfo.GetMembersAsync` (C#) and `TeamsInfo.getMembers` (TypeScript/Node.js) is formally deprecated and will stop working in late 2021.</span></span> <span data-ttu-id="fed43-129">Nous annoncerons un calendrier spécifique en mai 2020 en fonction des commentaires des développeurs.</span><span class="sxs-lookup"><span data-stu-id="fed43-129">We'll announce a specific timetable in May 2020, based on feedback from developers.</span></span> <span data-ttu-id="fed43-130">Une fois la nouvelle API paginée disponible, les développeurs doivent mettre à jour leurs robots pour l’utiliser.</span><span class="sxs-lookup"><span data-stu-id="fed43-130">Once the new paged API is available, developers should update their bots to use it.</span></span> <span data-ttu-id="fed43-131">(Ceci s’applique également à l' [API REST sous-jacente utilisée par ces API](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#tabpanel_CeZOj-G++Q_json).)</span><span class="sxs-lookup"><span data-stu-id="fed43-131">(This also applies to the [underlying REST API these APIs use](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#tabpanel_CeZOj-G++Q_json).)</span></span>
* <span data-ttu-id="fed43-132">En fin de 2021, les robots ne pourront pas récupérer de façon proactive les `userPrincipalName` `email` Propriétés ou pour les membres d’une équipe de conversation et devront utiliser Microsoft Graph pour les récupérer.</span><span class="sxs-lookup"><span data-stu-id="fed43-132">By late 2021, bots will not be able to proactively retrieve the `userPrincipalName` or `email` properties for members of a chat/team and will need to use Microsoft Graph to retrieve them.</span></span> <span data-ttu-id="fed43-133">Plus précisément `userPrincipalName` , `email` les propriétés ne seront pas renvoyées à partir de la nouvelle API à partir du `GetConversationPagedMembers` 2021.</span><span class="sxs-lookup"><span data-stu-id="fed43-133">Specifically, `userPrincipalName` and `email` properties won't be returned from the new `GetConversationPagedMembers` API starting in late 2021.</span></span> <span data-ttu-id="fed43-134">Les robots doivent utiliser Microsoft Graph avec un jeton d’accès pour récupérer ces informations.</span><span class="sxs-lookup"><span data-stu-id="fed43-134">Bots will have to use Microsoft Graph with an access token to retrieve this information.</span></span> <span data-ttu-id="fed43-135">Il s’agit évidemment d’une modification majeure : nous devons permettre aux robots d’obtenir un jeton d’accès plus facilement, et nous devons rationaliser et simplifier le processus de consentement de l’utilisateur final.</span><span class="sxs-lookup"><span data-stu-id="fed43-135">This is obviously a major change: We must make it easier for bots to get an access token, and we must streamline and simplify the end-user consent process.</span></span>

## <a name="feedback-and-more-information"></a><span data-ttu-id="fed43-136">Commentaires et informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="fed43-136">Feedback and More Information</span></span>
<span data-ttu-id="fed43-137">Nous allons utiliser cette page pour fournir des informations à jour sur ces modifications.</span><span class="sxs-lookup"><span data-stu-id="fed43-137">We'll use this page for providing up to date information on these changes.</span></span> <span data-ttu-id="fed43-138">Si vous avez des questions, utilisez le commentaire « envoyer des commentaires > sur cette page » dans la section **Commentaires** ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="fed43-138">If you have questions, use the "Send feedback > on this page" in the **Feedback** section below.</span></span> 
