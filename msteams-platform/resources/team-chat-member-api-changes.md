---
title: Modifications de l’API du bot pour les membres de l’équipe et de la conversation
author: ojasvichoudhary
description: Décrit les modifications à venir et en cours apportées aux API bot utilisées pour récupérer les membres des équipes et des conversations
keywords: liste des membres de l’équipe d’api bot Framework
localization_priority: Normal
ms.topic: reference
ms.author: ojchoudh
ms.openlocfilehash: 333a29664f0d60e89039f906fce77e71054d486f
ms.sourcegitcommit: 9ef3b415cbba484c2201abe9c6927e08d974388e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/19/2021
ms.locfileid: "52555436"
---
# <a name="teams-bot-api-changes-to-fetch-team-or-chat-members"></a><span data-ttu-id="7b319-104">Teams’API du bot pour récupérer des membres d’équipe ou de conversation</span><span class="sxs-lookup"><span data-stu-id="7b319-104">Teams bot API changes to fetch team or chat members</span></span>

>[!NOTE]
> <span data-ttu-id="7b319-105">Le processus d’annulation et `TeamsInfo.getMembers` les `TeamsInfo.GetMembersAsync` API ont démarré.</span><span class="sxs-lookup"><span data-stu-id="7b319-105">The deprecation process for `TeamsInfo.getMembers` and `TeamsInfo.GetMembersAsync` APIs have started.</span></span> <span data-ttu-id="7b319-106">Initialement, ils sont fortement limitées à cinq demandes par minute et retournent un maximum de 10 000 membres par équipe.</span><span class="sxs-lookup"><span data-stu-id="7b319-106">Initially, they are heavily throttled to five requests per minute and return a maximum of 10K members per team.</span></span> <span data-ttu-id="7b319-107">Ainsi, la liste complète n’est pas renvoyée à mesure que la taille de l’équipe augmente.</span><span class="sxs-lookup"><span data-stu-id="7b319-107">This results in the full roster not being returned as team size increases.</span></span>
> <span data-ttu-id="7b319-108">Vous devez mettre à jour la version 4.10 ou une version supérieure du SDK Bot Framework et basculer vers les points de terminaison de l’API paginée ou l’API utilisateur `TeamsInfo.GetMemberAsync` unique.</span><span class="sxs-lookup"><span data-stu-id="7b319-108">You must update to version 4.10 or higher of the Bot Framework SDK and switch to the paginated API endpoints, or the `TeamsInfo.GetMemberAsync` single user API.</span></span> <span data-ttu-id="7b319-109">Cela s’applique également à votre bot même si vous n’utilisez pas directement ces API, car les anciens SDK appellent ces API pendant les événements [MembersAdded.](../bots/how-to/conversations/subscribe-to-conversation-events.md#team-members-added)</span><span class="sxs-lookup"><span data-stu-id="7b319-109">This also applies to your bot even if you are not directly using these APIs, as older SDKs call these APIs during [membersAdded](../bots/how-to/conversations/subscribe-to-conversation-events.md#team-members-added) events.</span></span> <span data-ttu-id="7b319-110">Pour afficher la liste des modifications à venir, consultez [les modifications apportées aux API.](team-chat-member-api-changes.md#api-changes)</span><span class="sxs-lookup"><span data-stu-id="7b319-110">To view the list of upcoming changes, see [API changes](team-chat-member-api-changes.md#api-changes).</span></span> 

<span data-ttu-id="7b319-111">Actuellement, les développeurs de bots qui souhaitent récupérer des informations pour un ou plusieurs membres d’une conversation ou d’une équipe utilisent les API de bot Microsoft Teams pour C# ou pour les API TypeScript ou `TeamsInfo.GetMembersAsync` `TeamsInfo.getMembers` Node.js.</span><span class="sxs-lookup"><span data-stu-id="7b319-111">Currently, bot developers who want to retrieve information for one or more members of a chat or team use the Microsoft Teams bot APIs `TeamsInfo.GetMembersAsync` for C# or `TeamsInfo.getMembers` for TypeScript or Node.js APIs.</span></span> <span data-ttu-id="7b319-112">Pour plus d’informations, voir [récupérer la liste ou le profil utilisateur.](../bots/how-to/get-teams-context.md#fetch-the-roster-or-user-profile)</span><span class="sxs-lookup"><span data-stu-id="7b319-112">For more information, see [fetch roster or user profile](../bots/how-to/get-teams-context.md#fetch-the-roster-or-user-profile).</span></span> <span data-ttu-id="7b319-113">Ces API ont plusieurs défauts.</span><span class="sxs-lookup"><span data-stu-id="7b319-113">These APIs have several shortcomings.</span></span>

<span data-ttu-id="7b319-114">Actuellement, si vous souhaitez récupérer des informations pour un ou plusieurs membres d’une conversation ou d’une équipe, vous pouvez utiliser les API de [bot Microsoft Teams](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetch-the-roster-or-user-profile) pour C# ou pour les API TypeScript ou `TeamsInfo.GetMembersAsync` `TeamsInfo.getMembers` Node.js.</span><span class="sxs-lookup"><span data-stu-id="7b319-114">Currently, if you want to retrieve information for one or more members of a chat or team, you can use the [Microsoft Teams bot APIs](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetch-the-roster-or-user-profile) `TeamsInfo.GetMembersAsync` for C# or `TeamsInfo.getMembers` for TypeScript or Node.js APIs.</span></span> <span data-ttu-id="7b319-115">Ces API ont les défauts suivants :</span><span class="sxs-lookup"><span data-stu-id="7b319-115">These APIs have the following shortcomings:</span></span>

* <span data-ttu-id="7b319-116">Pour les grandes équipes, les performances sont médiocres et les délai d’avance sont plus probables : la taille maximale de l’équipe a considérablement augmenté depuis la publication de Teams début 2017.</span><span class="sxs-lookup"><span data-stu-id="7b319-116">For large teams, performance is poor and timeouts are more likely: The maximum team size has grown considerably since Teams was released in early 2017.</span></span> <span data-ttu-id="7b319-117">À mesure que vous renvoyez l’intégralité de la liste des membres, le retour de l’appel d’API pour les grandes équipes prend beaucoup de temps, et il est courant pour l’appel d’avoir un délai d’attente et vous devez essayer à `GetMembersAsync` `getMembers` nouveau.</span><span class="sxs-lookup"><span data-stu-id="7b319-117">As `GetMembersAsync` or `getMembers` returns the entire member list, it takes a long time for the API call to return for large teams, and it is common for the call to time out and you have to try again.</span></span>
* <span data-ttu-id="7b319-118">Il est difficile d’obtenir les détails du profil d’un seul utilisateur : pour obtenir les informations de profil d’un seul utilisateur, vous devez récupérer l’intégralité de la liste des membres, puis rechercher celle que vous souhaitez.</span><span class="sxs-lookup"><span data-stu-id="7b319-118">Getting profile details for a single user is difficult: To get the profile information for a single user, you have to retrieve the entire member list and then search for the one you want.</span></span> <span data-ttu-id="7b319-119">Il existe une fonction d’aide dans le SDK Bot Framework pour simplifier, mais elle n’est pas efficace.</span><span class="sxs-lookup"><span data-stu-id="7b319-119">There is a helper function in the Bot Framework SDK to make it simpler, but it is not efficient.</span></span>

<span data-ttu-id="7b319-120">Avec l’introduction des équipes à l’échelle de l’organisation, il est nécessaire de mieux aligner ces API Office 365 contrôles de confidentialité.</span><span class="sxs-lookup"><span data-stu-id="7b319-120">With the introduction of organization wide teams, there is a requirement to better align these APIs with Office 365 privacy controls.</span></span> <span data-ttu-id="7b319-121">Les bots utilisés dans les grandes équipes peuvent récupérer des informations de profil de base similaires à l’autorisation `User.ReadBasic.All` Graph Microsoft.</span><span class="sxs-lookup"><span data-stu-id="7b319-121">Bots used in large teams are able to retrieve basic profile information similar to the `User.ReadBasic.All` Microsoft Graph permission.</span></span> <span data-ttu-id="7b319-122">Les administrateurs clients contrôlent de manière très grande les applications et les bots qui peuvent être utilisés dans leur client, mais ces paramètres sont différents de ceux de Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="7b319-122">Tenant administrators have a great deal of control over which apps and bots can be used in their tenant, but these settings are different from Microsoft Graph.</span></span>

<span data-ttu-id="7b319-123">Le code suivant fournit un exemple de représentation JSON de ce qui est renvoyé par les API Teams bot :</span><span class="sxs-lookup"><span data-stu-id="7b319-123">The following code provides a sample JSON representation of what is returned by Teams bot APIs:</span></span>

```json
[{
    "id": "29:1GcS4EyB_oSI8A88XmWBN7NJFyMqe3QGnJdgLfFGkJnVelzRGos0bPbpsfJjcbAD22bmKc4GMbrY2g4JDrrA8vM06X1-cHHle4zOE6U4ttcc",
    "name": "Anon1 (Guest)",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "anonymous"
}, {
    "id": "29:1bSnHZ7Js2STWrgk6ScEErLk1Lp2zQuD5H2qQ960rtvstKp8tKLl-3r8b6DoW0QxZimuTxk_kupZ1DBMpvIQQUAZL-PNj0EORDvRZXy8kvWk",
    "objectId": "76b0b09f-d410-48fd-993e-84da521a597b",
    "givenName": "John",
    "surname": "Patterson",
    "email": "johnp@fabrikam.com",
    "userPrincipalName": "johnp@fabrikam.com",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "user"
}, {
    "id": "29:1URzNQM1x1PNMr1D7L5_lFe6qF6gEfAbkdG8_BUxOW2mTKryQqEZtBTqDt10-MghkzjYDuUj4KG6nvg5lFAyjOLiGJ4jzhb99WrnI7XKriCs",
    "objectId": "6b7b3b2a-2c4b-4175-8582-41c9e685c1b5",
    "givenName": "Rick",
    "surname": "Stevens",
    "email": "Rick.Stevens@fabrikam.com",
    "userPrincipalName": "rstevens@fabrikam.com",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "user"
}]
```

## <a name="api-changes"></a><span data-ttu-id="7b319-124">Modifications apportées aux API</span><span class="sxs-lookup"><span data-stu-id="7b319-124">API Changes</span></span>

<span data-ttu-id="7b319-125">Voici les modifications à venir apportées aux API :</span><span class="sxs-lookup"><span data-stu-id="7b319-125">Following are the upcoming API changes:</span></span>

* <span data-ttu-id="7b319-126">Une nouvelle API est créée pour récupérer les informations de profil pour les [`TeamsInfo.GetPagedMembersAsync`](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetch-the-roster-or-user-profile) membres d’une conversation ou d’une équipe.</span><span class="sxs-lookup"><span data-stu-id="7b319-126">A new API is created [`TeamsInfo.GetPagedMembersAsync`](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetch-the-roster-or-user-profile) for retrieving profile information for members of a chat or team.</span></span> <span data-ttu-id="7b319-127">Cette API est désormais disponible avec le SDK Bot Framework version 4.8 ou ultérieure.</span><span class="sxs-lookup"><span data-stu-id="7b319-127">This API is now available with the Bot Framework version 4.8 or later SDK.</span></span> <span data-ttu-id="7b319-128">Pour le développement dans toutes les autres versions, utilisez la [`GetConversationPagedMembers`](/dotnet/api/microsoft.bot.connector.conversationsextensions.getconversationpagedmembersasync?view=botbuilder-dotnet-stable&preserve-view=true) méthode.</span><span class="sxs-lookup"><span data-stu-id="7b319-128">For development in all other versions, use the [`GetConversationPagedMembers`](/dotnet/api/microsoft.bot.connector.conversationsextensions.getconversationpagedmembersasync?view=botbuilder-dotnet-stable&preserve-view=true) method.</span></span>

    > [!NOTE]
    > <span data-ttu-id="7b319-129">Dans la version v3 ou v4, la meilleure action consiste à mettre à niveau vers la dernière version de point 3.30.2 ou 4.8 ou version ultérieure, respectivement.</span><span class="sxs-lookup"><span data-stu-id="7b319-129">In either v3 or v4, the best action is to upgrade to the latest point release that is 3.30.2 or 4.8 or later respectively.</span></span>

* <span data-ttu-id="7b319-130">Une nouvelle API est créée pour récupérer les informations de [`TeamsInfo.GetMemberAsync`](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#get-single-member-details) profil d’un seul utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7b319-130">A new API is created [`TeamsInfo.GetMemberAsync`](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#get-single-member-details) for retrieving the profile information for a single user.</span></span> <span data-ttu-id="7b319-131">Il prend l’ID de l’équipe ou de la conversation, ainsi qu’un [UPN](/windows/win32/ad/naming-properties#userprincipalname) , l’ID d’objet Azure Active Directory ou l’ID d’utilisateur Teams comme paramètres et renvoie les informations de profil pour cet `userPrincipalName` `objectId` `id` utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7b319-131">It takes the ID of the team or chat and a [UPN](/windows/win32/ad/naming-properties#userprincipalname) that is `userPrincipalName`, Azure Active Directory Object ID `objectId`, or the Teams user ID `id` as parameters and returns the profile information for that user.</span></span>

    > [!NOTE]
    > <span data-ttu-id="7b319-132">`objectId` est modifié pour `aadObjectId` correspondre à ce qui est appelé dans `Activity` l’objet d’un message Bot Framework.</span><span class="sxs-lookup"><span data-stu-id="7b319-132">`objectId` is changed to `aadObjectId` to match what is called in the `Activity` object of a Bot Framework message.</span></span> <span data-ttu-id="7b319-133">La nouvelle API est disponible avec la version 4.8 ou ultérieure du SDK Bot Framework.</span><span class="sxs-lookup"><span data-stu-id="7b319-133">The new API is available with version 4.8 or later of the Bot Framework SDK.</span></span> <span data-ttu-id="7b319-134">Il est également disponible dans l’extension Teams SDK Bot Framework 3.x.</span><span class="sxs-lookup"><span data-stu-id="7b319-134">It is also available in the Teams SDK extension Bot Framework 3.x.</span></span> <span data-ttu-id="7b319-135">En attendant, vous pouvez utiliser le point de terminaison [REST.](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#get-single-member-details)</span><span class="sxs-lookup"><span data-stu-id="7b319-135">Meanwhile, you can use the [REST](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#get-single-member-details) endpoint.</span></span>

* <span data-ttu-id="7b319-136">`TeamsInfo.GetMembersAsync` dans C# et `TeamsInfo.getMembers` dans TypeScript ou Node.js est officiellement supprimé.</span><span class="sxs-lookup"><span data-stu-id="7b319-136">`TeamsInfo.GetMembersAsync` in C# and `TeamsInfo.getMembers` in TypeScript or Node.js is formally deprecated.</span></span> <span data-ttu-id="7b319-137">Une fois la nouvelle API disponible, vous devez mettre à jour vos bots pour l’utiliser.</span><span class="sxs-lookup"><span data-stu-id="7b319-137">Once the new API is available, you must update your bots to use it.</span></span> <span data-ttu-id="7b319-138">Cela s’applique également à [l’API REST sous-jacente que ces API utilisent.](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#tabpanel_CeZOj-G++Q_json)</span><span class="sxs-lookup"><span data-stu-id="7b319-138">This also applies to the [underlying REST API that these APIs use](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#tabpanel_CeZOj-G++Q_json).</span></span>
* <span data-ttu-id="7b319-139">Fin 2021, les bots ne peuvent pas récupérer de manière proactive les propriétés des membres `userPrincipalName` `email` d’une conversation ou d’une équipe.</span><span class="sxs-lookup"><span data-stu-id="7b319-139">By late 2021, bots cannot proactively retrieve the `userPrincipalName` or `email` properties for members of a chat or team.</span></span> <span data-ttu-id="7b319-140">Les bots doivent utiliser Graph pour les récupérer.</span><span class="sxs-lookup"><span data-stu-id="7b319-140">Bots must use Graph to retrieve them.</span></span> <span data-ttu-id="7b319-141">Les `userPrincipalName` `email` propriétés et les propriétés ne sont pas renvoyées à partir de la nouvelle `GetConversationPagedMembers` API à partir de la fin 2021.</span><span class="sxs-lookup"><span data-stu-id="7b319-141">The `userPrincipalName` and `email` properties are not returned from the new `GetConversationPagedMembers` API starting in late 2021.</span></span> <span data-ttu-id="7b319-142">Les bots doivent utiliser Graph un jeton d’accès pour récupérer des informations.</span><span class="sxs-lookup"><span data-stu-id="7b319-142">Bots have to use Graph with an access token to retrieve information.</span></span> <span data-ttu-id="7b319-143">Il doit être plus facile pour les bots d’obtenir un jeton d’accès et de rationaliser et simplifier le processus de consentement de l’utilisateur final.</span><span class="sxs-lookup"><span data-stu-id="7b319-143">It must be made easier for bots to get an access token and streamline and simplify the end-user consent process.</span></span>
