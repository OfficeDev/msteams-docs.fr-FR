---
title: Authentification unique
description: Décrit l’authentification unique (SSO)
keywords: API SSO d’authentification unique AAD pour l’authentification de teams
ms.openlocfilehash: 011be3fe7fe614bd42f0ee6b88289cf97740a4d3
ms.sourcegitcommit: 3fc7ad33e2693f07170c3cb1a0d396261fc5c619
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/29/2020
ms.locfileid: "48796378"
---
# <a name="single-sign-on-sso"></a><span data-ttu-id="df8d8-104">Sign-On unique (SSO)</span><span class="sxs-lookup"><span data-stu-id="df8d8-104">Single Sign-On (SSO)</span></span>

<span data-ttu-id="df8d8-105">Les utilisateurs se connectent à Microsoft teams par le biais de leurs comptes professionnels, scolaires ou Microsoft (Office 365, Outlook, etc.).</span><span class="sxs-lookup"><span data-stu-id="df8d8-105">Users sign in to Microsoft Teams via their work, school, or Microsoft accounts (Office 365, Outlook, etc).</span></span> <span data-ttu-id="df8d8-106">Vous pouvez en tirer parti en autorisant une authentification unique pour autoriser l’utilisation de votre onglet Microsoft Teams (ou module tâches) sur des clients de bureau ou mobiles.</span><span class="sxs-lookup"><span data-stu-id="df8d8-106">You can take advantage of this by allowing a single sign-on to authorize your Microsoft Teams tab (or task module) on desktop or mobile clients.</span></span> <span data-ttu-id="df8d8-107">Par conséquent, si un utilisateur consent à utiliser votre application, il n’aura pas à s’accorder à nouveau un consentement sur un autre appareil, il sera automatiquement connecté.</span><span class="sxs-lookup"><span data-stu-id="df8d8-107">Thus, if a user consents to use your app, they won’t have to consent again on another device — they will be signed in automatically.</span></span> <span data-ttu-id="df8d8-108">De plus, nous récupérons votre jeton d’accès pour améliorer les performances et les temps de chargement.</span><span class="sxs-lookup"><span data-stu-id="df8d8-108">In addition, we prefetch your access token to improve performance and load times.</span></span>

>[!NOTE]
> <span data-ttu-id="df8d8-109">**Versions du client mobile teams prenant en charge SSO**</span><span class="sxs-lookup"><span data-stu-id="df8d8-109">**Teams mobile client versions supporting SSO**</span></span>  
>
> <span data-ttu-id="df8d8-110">✔ Teams pour Android (1416/1.0.0.2020073101 et versions ultérieures)</span><span class="sxs-lookup"><span data-stu-id="df8d8-110">✔Teams for Android (1416/1.0.0.2020073101 and later)</span></span>
>
> <span data-ttu-id="df8d8-111">✔ Teams pour iOS ( _version_ : 2.0.18 et versions ultérieures)</span><span class="sxs-lookup"><span data-stu-id="df8d8-111">✔Teams for iOS ( _Version_ : 2.0.18 and later)</span></span>  
>
> <span data-ttu-id="df8d8-112">Pour une expérience optimale avec Teams, utilisez la dernière version d’iOS et Android.</span><span class="sxs-lookup"><span data-stu-id="df8d8-112">For the best experience with Teams, please use the latest version of iOS and Android.</span></span>

## <a name="how-sso-works-at-runtime"></a><span data-ttu-id="df8d8-113">Mode de fonctionnement de l’authentification unique SSO en cours d’exécution</span><span class="sxs-lookup"><span data-stu-id="df8d8-113">How SSO works at runtime</span></span>

<span data-ttu-id="df8d8-114">Le diagramme suivant illustre le fonctionnement du processus d’authentification unique :</span><span class="sxs-lookup"><span data-stu-id="df8d8-114">The following diagram shows how the SSO process works:</span></span>

<!-- markdownlint-disable MD033 -->
<img src="~/assets/images/tabs/tabs-sso-diagram.png" alt="Tab single sign-on SSO diagram" width="75%"/>

1. <span data-ttu-id="df8d8-115">Dans l’onglet, un appel JavaScript est effectué vers `getAuthToken()` .</span><span class="sxs-lookup"><span data-stu-id="df8d8-115">In the tab, a JavaScript call is made to `getAuthToken()`.</span></span> <span data-ttu-id="df8d8-116">Cette option indique à teams d’obtenir un jeton d’authentification pour l’application d’onglets.</span><span class="sxs-lookup"><span data-stu-id="df8d8-116">This tells Teams to obtain an authentication token for the tab application.</span></span>
2. <span data-ttu-id="df8d8-117">S’il s’agit de la première fois que l’utilisateur actuel a utilisé votre application d’onglets, une invite de demande est adressée au consentement (si le consentement est requis) ou à la gestion de l’authentification par étape (par exemple, authentification à deux facteurs).</span><span class="sxs-lookup"><span data-stu-id="df8d8-117">If this is the first time the current user has used your tab application, there will be a request prompt to consent (if consent is required) or to handle step-up authentication (such as two-factor authentication).</span></span>
3. <span data-ttu-id="df8d8-118">Teams demande le jeton d’application d’onglets du point de terminaison Azure AD pour l’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="df8d8-118">Teams requests the tab application token from the Azure AD endpoint for the current user.</span></span>
4. <span data-ttu-id="df8d8-119">Azure AD envoie le jeton d’application d’onglet à l’application Teams.</span><span class="sxs-lookup"><span data-stu-id="df8d8-119">Azure AD sends the tab application token to the Teams application.</span></span>
5. <span data-ttu-id="df8d8-120">Teams envoie le jeton de l’application d’onglet à l’onglet dans le cadre de l’objet de résultat renvoyé par l' `getAuthToken()` appel.</span><span class="sxs-lookup"><span data-stu-id="df8d8-120">Teams sends the tab application token to the tab as part of the result object returned by the `getAuthToken()` call.</span></span>
6. <span data-ttu-id="df8d8-121">Le jeton sera analysé dans l’application d’onglets, via JavaScript, pour extraire les informations nécessaires, telles que l’adresse de messagerie de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="df8d8-121">The token will be parsed in the tab application, via JavaScript, to extract the needed information, such as the user's email address.</span></span>

> [!NOTE]
> <span data-ttu-id="df8d8-122">Le `getAuthToken()` n’est valide que pour l’envoi à un ensemble limité d’API de niveau utilisateur (e-mail, Profile, offline_access et OpenID), et non pour d’autres étendues Microsoft Graph telles que `User.Read` ou `Mail.Read` .</span><span class="sxs-lookup"><span data-stu-id="df8d8-122">The `getAuthToken()` is only valid for consenting to a limited set of user-level APIs — email, profile, offline_access and OpenId — and not for further Microsoft Graph scopes such as `User.Read` or `Mail.Read`.</span></span> <span data-ttu-id="df8d8-123">Consultez notre section à la fin de ce document pour obtenir des solutions de contournement si vous avez besoin d' [autres étendues Graph](#apps-that-require-additional-microsoft-graph-scopes).</span><span class="sxs-lookup"><span data-stu-id="df8d8-123">See our section at the end of this document for suggested workarounds if you require [additional Graph scopes](#apps-that-require-additional-microsoft-graph-scopes).</span></span>

<span data-ttu-id="df8d8-124">L’API SSO fonctionne également dans les [modules de tâches](../../../task-modules-and-cards/what-are-task-modules.md) qui incorporent le contenu Web.</span><span class="sxs-lookup"><span data-stu-id="df8d8-124">The SSO API will also work in [Task Modules](../../../task-modules-and-cards/what-are-task-modules.md) that embed web content.</span></span>

## <a name="develop-an-sso-microsoft-teams-tab"></a><span data-ttu-id="df8d8-125">Développer un onglet Microsoft teams SSO</span><span class="sxs-lookup"><span data-stu-id="df8d8-125">Develop an SSO Microsoft Teams tab</span></span>

<span data-ttu-id="df8d8-126">Cette section décrit les tâches impliquées dans la création d’un onglet teams qui utilise l’authentification unique.</span><span class="sxs-lookup"><span data-stu-id="df8d8-126">This section describes the tasks involved in creating a Teams tab that uses SSO.</span></span> <span data-ttu-id="df8d8-127">Ces tâches sont décrites ici sont indépendantes de la langue et de l’infrastructure.</span><span class="sxs-lookup"><span data-stu-id="df8d8-127">These tasks are described here are language- and framework-agnostic.</span></span>

### <a name="1-create-your-azure-active-directory-azure-ad-application"></a><span data-ttu-id="df8d8-128">1. créer votre application Azure Active Directory (Azure AD)</span><span class="sxs-lookup"><span data-stu-id="df8d8-128">1. Create your Azure Active Directory (Azure AD) application</span></span>

#### <a name="registering-your-application-in-theazure-ad-portal-overview"></a><span data-ttu-id="df8d8-129">Inscription de votre application dans le[portail Azure ad Portal](https://azure.microsoft.com/features/azure-portal/) :</span><span class="sxs-lookup"><span data-stu-id="df8d8-129">Registering your application in the[Azure AD portal](https://azure.microsoft.com/features/azure-portal/) overview:</span></span>

1. <span data-ttu-id="df8d8-130">Obtenir l' [ID de votre application Azure ad](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in).</span><span class="sxs-lookup"><span data-stu-id="df8d8-130">Get your [Azure AD Application ID](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in).</span></span>
2. <span data-ttu-id="df8d8-131">Spécifiez les autorisations dont votre application a besoin pour le point de terminaison Azure AD et, éventuellement, Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="df8d8-131">Specify the permissions that your application needs for the Azure AD endpoint and, optionally, Microsoft Graph.</span></span>
3. <span data-ttu-id="df8d8-132">[Accorder des autorisations](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) pour les applications de bureau, Web et mobiles Teams.</span><span class="sxs-lookup"><span data-stu-id="df8d8-132">[Grant permissions](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) for Teams desktop, web, and mobile applications.</span></span>
4. <span data-ttu-id="df8d8-133">Pré-autoriser teams en sélectionnant le bouton **Ajouter une étendue** et dans le panneau qui s’ouvre, entrez `access_as_user` comme **nom d’étendue** .</span><span class="sxs-lookup"><span data-stu-id="df8d8-133">Pre-authorize Teams by selecting the **Add a scope** button and in the panel that opens, enter `access_as_user` as the **Scope name** .</span></span>

> [!NOTE]
> <span data-ttu-id="df8d8-134">Vous devez tenir compte de certaines restrictions importantes :</span><span class="sxs-lookup"><span data-stu-id="df8d8-134">There are some important restrictions you should be aware of:</span></span>
>
> * <span data-ttu-id="df8d8-135">Nous ne prenons en charge que les autorisations d’API Microsoft Graph de niveau utilisateur, c’est-à-dire la messagerie, le profil, le offline_access OpenId.</span><span class="sxs-lookup"><span data-stu-id="df8d8-135">We only support user-level Microsoft Graph API permissions, i.e., email, profile, offline_access, OpenId.</span></span> <span data-ttu-id="df8d8-136">Si vous avez besoin d’accéder à d’autres étendues Microsoft Graph (telles que `User.Read` ou `Mail.Read` ), consultez notre [solution de contournement recommandée](#apps-that-require-additional-microsoft-graph-scopes) à la fin de cette documentation.</span><span class="sxs-lookup"><span data-stu-id="df8d8-136">If you need access to other Microsoft Graph scopes (such as `User.Read` or `Mail.Read`), see our [recommended workaround](#apps-that-require-additional-microsoft-graph-scopes) at the end of this documentation.</span></span>
> * <span data-ttu-id="df8d8-137">Il est important que le nom de domaine de votre application soit le même que le nom de domaine que vous avez enregistré pour votre application Azure AD.</span><span class="sxs-lookup"><span data-stu-id="df8d8-137">It's important that your application's domain name is the same as the domain name you've registering for your Azure AD application.</span></span>
> * <span data-ttu-id="df8d8-138">Nous ne prenons actuellement pas en charge plusieurs domaines par application.</span><span class="sxs-lookup"><span data-stu-id="df8d8-138">We don't currently support multiple domains per app.</span></span>
> * <span data-ttu-id="df8d8-139">Nous ne prenons pas en charge les applications qui utilisent le `azurewebsites.net` domaine car elles sont trop courantes et peuvent présenter un risque de sécurité.</span><span class="sxs-lookup"><span data-stu-id="df8d8-139">We don't support applications that use the `azurewebsites.net` domain because it is too common and may be a security risk.</span></span> <span data-ttu-id="df8d8-140">Toutefois, nous cherchons activement à supprimer cette restriction.</span><span class="sxs-lookup"><span data-stu-id="df8d8-140">However, we're actively seeking to remove this restriction.</span></span>

#### <a name="registering-your-app-through-the-azure-active-directory-portal-in-depth"></a><span data-ttu-id="df8d8-141">Enregistrement approfondi de votre application via le portail Azure Active Directory :</span><span class="sxs-lookup"><span data-stu-id="df8d8-141">Registering your app through the Azure Active Directory portal in-depth:</span></span>

1. <span data-ttu-id="df8d8-142">Enregistrez une nouvelle application dans le portail [Azure Active Directory-inscriptions des applications](https://go.microsoft.com/fwlink/?linkid=2083908) .</span><span class="sxs-lookup"><span data-stu-id="df8d8-142">Register a new application in the [Azure Active Directory – App Registrations](https://go.microsoft.com/fwlink/?linkid=2083908) portal.</span></span>
2. <span data-ttu-id="df8d8-143">Sélectionnez **nouvelle inscription** et, dans la *page inscrire une application* , définissez les valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="df8d8-143">Select **New Registration** and on the *register an application page* , set following values:</span></span>
    * <span data-ttu-id="df8d8-144">Définissez **Name** sur le nom de votre application.</span><span class="sxs-lookup"><span data-stu-id="df8d8-144">Set **name** to your app name.</span></span>
    * <span data-ttu-id="df8d8-145">Choisissez les **types de comptes pris en charge** (tout type de compte fonctionne) ¹</span><span class="sxs-lookup"><span data-stu-id="df8d8-145">Choose the **supported account types** (any account type will work) ¹</span></span>
    * <span data-ttu-id="df8d8-146">Laissez **Redirect URI** vide.</span><span class="sxs-lookup"><span data-stu-id="df8d8-146">Leave **Redirect URI** empty.</span></span>
    * <span data-ttu-id="df8d8-147">Choisissez **Inscrire** .</span><span class="sxs-lookup"><span data-stu-id="df8d8-147">Choose **Register** .</span></span>
3. <span data-ttu-id="df8d8-148">Sur la page vue d’ensemble, copiez et enregistrez l’ID de l' **application (client)** .</span><span class="sxs-lookup"><span data-stu-id="df8d8-148">On the overview page, copy and save the **Application (client) ID** .</span></span> <span data-ttu-id="df8d8-149">Vous en aurez besoin plus tard lors de la mise à jour de votre manifeste d’application Teams.</span><span class="sxs-lookup"><span data-stu-id="df8d8-149">You’ll need it later when updating your Teams application manifest.</span></span>
4. <span data-ttu-id="df8d8-150">Sélectionnez **Exposer une API** sous **Gérer** .</span><span class="sxs-lookup"><span data-stu-id="df8d8-150">Under **Manage** , select **Expose an API** .</span></span> 
5. <span data-ttu-id="df8d8-151">Sélectionnez le lien **définir** pour générer l’URI de l’ID de l’application sous la forme `api://{AppID}` .</span><span class="sxs-lookup"><span data-stu-id="df8d8-151">Select the **Set** link to generate the Application ID URI in the form of `api://{AppID}`.</span></span> <span data-ttu-id="df8d8-152">Insérez votre nom de domaine complet (avec une barre oblique « / » ajoutée à la fin) entre les deux barres obliques et le GUID.</span><span class="sxs-lookup"><span data-stu-id="df8d8-152">Insert your fully qualified domain name (with a forward slash "/" appended to the end) between the double forward slashes and the GUID.</span></span> <span data-ttu-id="df8d8-153">L’ID entier doit avoir la forme suivante : `api://fully-qualified-domain-name.com/{AppID}` ²</span><span class="sxs-lookup"><span data-stu-id="df8d8-153">The entire ID should have the form of: `api://fully-qualified-domain-name.com/{AppID}` ²</span></span>
    * <span data-ttu-id="df8d8-154">ex : `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` .</span><span class="sxs-lookup"><span data-stu-id="df8d8-154">ex: `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`.</span></span>
    
    <span data-ttu-id="df8d8-155">Le nom de domaine complet est le nom de domaine lisible par l’utilisateur à partir duquel votre application est fournie.</span><span class="sxs-lookup"><span data-stu-id="df8d8-155">The fully qualified domain name is the human readable domain name from which your app is served.</span></span> <span data-ttu-id="df8d8-156">Si vous utilisez un service de tunneling tel que ngrok, vous devez mettre à jour cette valeur chaque fois que votre sous-domaine ngrok est modifié.</span><span class="sxs-lookup"><span data-stu-id="df8d8-156">If you are using a tunneling service such as ngrok, you will need to update     this value whenever your ngrok subdomain changes.</span></span> 
6. <span data-ttu-id="df8d8-157">Sélectionnez le bouton **Ajouter une étendue** .</span><span class="sxs-lookup"><span data-stu-id="df8d8-157">Select the **Add a scope** button.</span></span> <span data-ttu-id="df8d8-158">Dans le volet qui s’ouvre, entrez `access_as_user` en tant que **nom de l’étendue** .</span><span class="sxs-lookup"><span data-stu-id="df8d8-158">In the panel that opens, enter `access_as_user` as the **Scope name** .</span></span>
7. <span data-ttu-id="df8d8-159">Définir **qui peut consentir ?**`Admins and users`</span><span class="sxs-lookup"><span data-stu-id="df8d8-159">Set **Who can consent?** to `Admins and users`</span></span>
8. <span data-ttu-id="df8d8-160">Renseignez les champs de configuration des invites d’administrateur et de consentement de l’utilisateur avec des valeurs appropriées pour l' `access_as_user` étendue :</span><span class="sxs-lookup"><span data-stu-id="df8d8-160">Fill in the fields for configuring the admin and user consent prompts with values that are appropriate for the `access_as_user` scope:</span></span>
    * <span data-ttu-id="df8d8-161">**Titre du consentement administratif :** Les équipes peuvent accéder au profil de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="df8d8-161">**Admin consent title:** Teams can access the user’s profile.</span></span>
    * <span data-ttu-id="df8d8-162">**Description du consentement administratif** : permet à teams d’appeler les API Web de l’application en tant qu’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="df8d8-162">**Admin consent description** : Allows Teams to call the app’s web APIs as the current user.</span></span>
    * <span data-ttu-id="df8d8-163">**Titre du consentement** de l’utilisateur : teams peut accéder au profil utilisateur et faire des demandes au nom de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="df8d8-163">**User consent title** : Teams can access the user profile and make requests on the user's behalf.</span></span>
    * <span data-ttu-id="df8d8-164">**Description du consentement de l’utilisateur :** Permettre aux équipes d’appeler les API de cette application avec les mêmes droits que l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="df8d8-164">**User consent description:** Enable Teams to call this app’s APIs with the same rights as the user.</span></span>
9. <span data-ttu-id="df8d8-165">Vérifiez que l' **État** est défini sur **activé** .</span><span class="sxs-lookup"><span data-stu-id="df8d8-165">Ensure that **State** is set to **Enabled**</span></span>
10. <span data-ttu-id="df8d8-166">Sélectionnez le bouton **Ajouter une étendue** à enregistrer.</span><span class="sxs-lookup"><span data-stu-id="df8d8-166">Select the **Add scope** button to save</span></span> 
    * <span data-ttu-id="df8d8-167">La partie domaine du **nom d’étendue** affiché juste en dessous du champ de texte doit correspondre automatiquement à l’URI d' **ID d’application** défini à l’étape précédente, avec `/access_as_user` ajouté à la fin :</span><span class="sxs-lookup"><span data-stu-id="df8d8-167">The domain part of the **Scope name** displayed just below the text field should automatically match the **Application ID** URI set in the previous step, with `/access_as_user` appended to the end:</span></span>
        * `api://subdomain.example.com/00000000-0000-0000-0000-000000000000/access_as_user`
11. <span data-ttu-id="df8d8-168">Dans la section **applications clientes autorisées** , identifiez les applications que vous souhaitez autoriser pour l’application Web de votre application.</span><span class="sxs-lookup"><span data-stu-id="df8d8-168">In the **Authorized client applications** section, identify the applications that you want to authorize for your app’s web application.</span></span> <span data-ttu-id="df8d8-169">Sélectionnez *Ajouter une application cliente* .</span><span class="sxs-lookup"><span data-stu-id="df8d8-169">Select *Add a client application* .</span></span> <span data-ttu-id="df8d8-170">Entrez chacun des ID client suivants et sélectionnez l’étendue autorisée que vous avez créée à l’étape précédente :</span><span class="sxs-lookup"><span data-stu-id="df8d8-170">Enter each of the following client IDs and select the authorized scope you created in the previous step:</span></span>
    * <span data-ttu-id="df8d8-171">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` (Team mobile/application de bureau)</span><span class="sxs-lookup"><span data-stu-id="df8d8-171">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` (Teams mobile/desktop application)</span></span>
    * <span data-ttu-id="df8d8-172">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` (Application Web Teams)</span><span class="sxs-lookup"><span data-stu-id="df8d8-172">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` (Teams web application)</span></span>
12. <span data-ttu-id="df8d8-173">Accédez à **autorisations d’API** .</span><span class="sxs-lookup"><span data-stu-id="df8d8-173">Navigate to **API Permissions** .</span></span> <span data-ttu-id="df8d8-174">Sélectionnez *Ajouter une autorisation délégation de*  >  *Microsoft Graph*  >  *autorisations* , puis ajoutez les autorisations suivantes :</span><span class="sxs-lookup"><span data-stu-id="df8d8-174">Select *Add a permission* > *Microsoft Graph* > *Delegated permissions* , then add the following permissions:</span></span>
    * <span data-ttu-id="df8d8-175">User. Read (activé par défaut)</span><span class="sxs-lookup"><span data-stu-id="df8d8-175">User.Read (enabled by default)</span></span>
    * <span data-ttu-id="df8d8-176">email</span><span class="sxs-lookup"><span data-stu-id="df8d8-176">email</span></span>
    * <span data-ttu-id="df8d8-177">offline_access</span><span class="sxs-lookup"><span data-stu-id="df8d8-177">offline_access</span></span>
    * <span data-ttu-id="df8d8-178">OpenId</span><span class="sxs-lookup"><span data-stu-id="df8d8-178">OpenId</span></span>
    * <span data-ttu-id="df8d8-179">profil</span><span class="sxs-lookup"><span data-stu-id="df8d8-179">profile</span></span>

13. <span data-ttu-id="df8d8-180">Accéder à **l’authentification**</span><span class="sxs-lookup"><span data-stu-id="df8d8-180">Navigate to **Authentication**</span></span>

    <span data-ttu-id="df8d8-181">Si une application n’a pas reçu le consentement de l’administrateur informatique, les utilisateurs devront fournir un consentement lors de la première utilisation d’une application.</span><span class="sxs-lookup"><span data-stu-id="df8d8-181">If an app hasn't been granted IT admin consent, users will have to provide consent the first time they use an app.</span></span>

    <span data-ttu-id="df8d8-182">Définissez un URI de redirection :</span><span class="sxs-lookup"><span data-stu-id="df8d8-182">Set a redirect URI:</span></span>
    * <span data-ttu-id="df8d8-183">Sélectionnez **Ajouter une plateforme** .</span><span class="sxs-lookup"><span data-stu-id="df8d8-183">Select **Add a platform** .</span></span>
    * <span data-ttu-id="df8d8-184">Sélectionnez **Web** .</span><span class="sxs-lookup"><span data-stu-id="df8d8-184">Select **web** .</span></span>
    * <span data-ttu-id="df8d8-185">Entrez l' **URI de redirection** pour votre application.</span><span class="sxs-lookup"><span data-stu-id="df8d8-185">Enter the **redirect URI** for your app.</span></span> <span data-ttu-id="df8d8-186">Il s’agit de la page dans laquelle un flux d’octroi implicite réussit la redirection de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="df8d8-186">This will be the page where a successful implicit grant flow will redirect the user.</span></span> <span data-ttu-id="df8d8-187">Il s’agit du même nom de domaine complet que celui que vous avez entré à l’étape 5, suivi de l’itinéraire de l’API à partir duquel une réponse d’authentification doit être envoyée.</span><span class="sxs-lookup"><span data-stu-id="df8d8-187">This will be same fully qualified domain name that you entered in step 5 followed by the API route where a authentication response should be sent.</span></span> <span data-ttu-id="df8d8-188">Si vous configurez l’un des exemples de teams, voici ce qui suit : `https://subdomain.example.com/auth-end`</span><span class="sxs-lookup"><span data-stu-id="df8d8-188">If you are following any of the Teams samples, this will be: `https://subdomain.example.com/auth-end`</span></span>

    <span data-ttu-id="df8d8-189">Ensuite, activez l’octroi implicite en cochant les cases suivantes :</span><span class="sxs-lookup"><span data-stu-id="df8d8-189">Next, enable implicit grant by checking the following boxes:</span></span>  
    <span data-ttu-id="df8d8-190">Jeton d’ID ✔</span><span class="sxs-lookup"><span data-stu-id="df8d8-190">✔ ID Token</span></span>  
    <span data-ttu-id="df8d8-191">Jeton d’accès ✔</span><span class="sxs-lookup"><span data-stu-id="df8d8-191">✔ Access Token</span></span>  
    
<span data-ttu-id="df8d8-192">Félicitations !</span><span class="sxs-lookup"><span data-stu-id="df8d8-192">Congratulations!</span></span> <span data-ttu-id="df8d8-193">Vous avez terminé les conditions préalables à l’inscription de l’application pour poursuivre votre application d’authentification unique de tabulation.</span><span class="sxs-lookup"><span data-stu-id="df8d8-193">You have completed the app registration prerequisites to proceed with your tab SSO app.</span></span>     

> [!NOTE]
>
> * <span data-ttu-id="df8d8-194">¹ si votre application Azure AD est inscrite dans le _même_ client que celui où vous effectuez une demande d’authentification dans Teams, l’utilisateur ne sera pas invité à accorder son consentement et recevra immédiatement un jeton d’accès.</span><span class="sxs-lookup"><span data-stu-id="df8d8-194">¹ If your Azure AD app is registered in the _same_ tenant where you're making an authentication request in Teams, the user won't be asked to consent and will be granted an access token right away.</span></span> <span data-ttu-id="df8d8-195">Les utilisateurs doivent uniquement accepter ces autorisations si l’application Azure AD est inscrite dans un autre client.</span><span class="sxs-lookup"><span data-stu-id="df8d8-195">Users only need to consent to these permissions if the Azure AD app is registered in a different tenant.</span></span>
> * <span data-ttu-id="df8d8-196">² si vous obtenez une erreur indiquant que le domaine est déjà détenu et que vous êtes le propriétaire, suivez la procédure lors du [démarrage rapide : ajoutez un nom de domaine personnalisé à Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) pour inscrire le domaine, puis répétez l’étape 5, ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="df8d8-196">² If you get an error stating that the domain is already owned and you are the owner, follow the procedure at [Quickstart: Add a custom domain name to Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) to register the domain, and then repeat step 5, above.</span></span> <span data-ttu-id="df8d8-197">(Cette erreur peut également se produire si vous n’êtes pas connecté avec des informations d’identification d’administrateur dans le client Office 365 location).</span><span class="sxs-lookup"><span data-stu-id="df8d8-197">(This error can also occur if you aren't signed in with Admin credentials in the Office 365 tenancy).</span></span>
> * <span data-ttu-id="df8d8-198">Si vous ne recevez pas l’UPN (nom d’utilisateur principal) dans le jeton d’accès renvoyé, vous pouvez l’ajouter en tant que [revendication facultative](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) dans Azure ad.</span><span class="sxs-lookup"><span data-stu-id="df8d8-198">If you are not receiving the UPN (User Principal Name) in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in Azure AD.</span></span>

### <a name="2-update-your-microsoft-teams-application-manifest"></a><span data-ttu-id="df8d8-199">2. mettre à jour le manifeste de votre application Microsoft teams</span><span class="sxs-lookup"><span data-stu-id="df8d8-199">2. Update your Microsoft Teams application manifest</span></span>

<span data-ttu-id="df8d8-200">Ajoutez de nouvelles propriétés à votre manifeste Microsoft teams :</span><span class="sxs-lookup"><span data-stu-id="df8d8-200">Add new properties to your Microsoft Teams manifest:</span></span>

* <span data-ttu-id="df8d8-201">**WebApplicationInfo** -parent des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="df8d8-201">**WebApplicationInfo** - The parent of the following elements:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="df8d8-202">**ID** : ID client de l’application.</span><span class="sxs-lookup"><span data-stu-id="df8d8-202">**id** - The client ID of the application.</span></span> <span data-ttu-id="df8d8-203">Il s’agit de l’ID d’application que vous avez obtenu dans le cadre de l’inscription de l’application auprès d’Azure AD.</span><span class="sxs-lookup"><span data-stu-id="df8d8-203">This is the application ID that you obtained as part of registering the application with Azure AD.</span></span>
>* <span data-ttu-id="df8d8-204">**ressource** -le domaine et le sous-domaine de votre application.</span><span class="sxs-lookup"><span data-stu-id="df8d8-204">**resource** - The domain and subdomain of your application.</span></span> <span data-ttu-id="df8d8-205">Il s’agit du même URI (y compris le `api://` protocole) que vous avez enregistré lors de la création `scope` de votre étape ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="df8d8-205">This is the same URI (including the `api://` protocol) that you registered when creating your `scope` in step 6 above.</span></span> <span data-ttu-id="df8d8-206">Vous ne devez pas inclure le `access_as_user` chemin d’accès dans votre ressource.</span><span class="sxs-lookup"><span data-stu-id="df8d8-206">You shouldn't include the `access_as_user` path in your resource.</span></span> <span data-ttu-id="df8d8-207">La partie domaine de cet URI doit correspondre au domaine, y compris à tous les sous-domaines, utilisés dans les URL de votre manifeste d’application Teams.</span><span class="sxs-lookup"><span data-stu-id="df8d8-207">The domain part of this URI should match the domain, including any subdomains, used in the URLs of your Teams application manifest.</span></span>

```json
"webApplicationInfo": {
  "id": "00000000-0000-0000-0000-000000000000",
  "resource": "api://subdomain.example.com/00000000-0000-0000-0000-000000000000"
}
```

> [!NOTE]
>
>* <span data-ttu-id="df8d8-208">La ressource d’une application AAD correspond généralement à la racine de son URL de site et de l’appID (par exemple `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` ,).</span><span class="sxs-lookup"><span data-stu-id="df8d8-208">The resource for an AAD app will usually be the root of its site URL and the appID (e.g. `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`).</span></span> <span data-ttu-id="df8d8-209">Nous utilisons également cette valeur pour vous assurer que votre demande provient du même domaine.</span><span class="sxs-lookup"><span data-stu-id="df8d8-209">We also use this value to ensure your request is coming from the same domain.</span></span> <span data-ttu-id="df8d8-210">Par conséquent, assurez-vous que l' `contentURL` pour votre onglet utilise les mêmes domaines que votre propriété de ressource.</span><span class="sxs-lookup"><span data-stu-id="df8d8-210">Therefore, make sure that the `contentURL` for your tab uses the same domains as your resource property.</span></span>
>* <span data-ttu-id="df8d8-211">Vous devez utiliser le manifeste version 1,5 ou une version ultérieure pour implémenter le `webApplicationInfo` champ.</span><span class="sxs-lookup"><span data-stu-id="df8d8-211">You need to use manifest version 1.5 or higher to implement the `webApplicationInfo` field.</span></span>

### <a name="3-get-an-authentication-token-from-your-client-side-code"></a><span data-ttu-id="df8d8-212">3. obtenir un jeton d’authentification à partir de votre code côté client</span><span class="sxs-lookup"><span data-stu-id="df8d8-212">3. Get an authentication token from your client-side code</span></span>

<span data-ttu-id="df8d8-213">Voici à quoi ressemble l’API d’authentification :</span><span class="sxs-lookup"><span data-stu-id="df8d8-213">Here's what the authentication API looks like:</span></span>

```javascript
var authTokenRequest = {
  successCallback: function(result) { console.log("Success: " + result); },
  failureCallback: function(error) { console.log("Failure: " + error); },
};
microsoftTeams.authentication.getAuthToken(authTokenRequest);
```

<span data-ttu-id="df8d8-214">Lorsque vous appelez, `getAuthToken` un consentement d’utilisateur supplémentaire est requis (pour les autorisations au niveau de l’utilisateur)-une boîte de dialogue s’affichera pour que l’utilisateur les encourage à accorder un consentement supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="df8d8-214">When you call `getAuthToken` - and additional user consent is required (for user-level permissions) - we will show a dialog to the user encouraging them to grant additional consent.</span></span> 

<span data-ttu-id="df8d8-215">Une fois que vous avez reçu le jeton d’accès dans le rappel de réussite, vous pouvez décoder le jeton d’accès pour afficher les revendications associées à ce jeton.</span><span class="sxs-lookup"><span data-stu-id="df8d8-215">Once you've received the access token in the success callback you can decode the access token to view the claims associated with that token.</span></span> <span data-ttu-id="df8d8-216">(Si vous le souhaitez, vous pouvez copier/coller manuellement le jeton d’accès dans un outil tel que [JWT.IO](https://jwt.io/) pour inspecter son contenu).</span><span class="sxs-lookup"><span data-stu-id="df8d8-216">(Optionally, you can manually copy/paste the access token into a tool such as [JWT.io](https://jwt.io/) to inspect its contents).</span></span> <span data-ttu-id="df8d8-217">Si vous ne recevez pas l’UPN (nom d’utilisateur principal) dans le jeton d’accès renvoyé, vous pouvez l’ajouter en tant que [revendication facultative](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) dans Azure ad.</span><span class="sxs-lookup"><span data-stu-id="df8d8-217">If you are not receiving the UPN (User Principal Name) in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in Azure AD.</span></span>

<p>
    <img src="~/assets/images/tabs/tabs-sso-prompt.png" alt="Tab single sign-on SSO dialog prompt" width="75%"/>
</p>

## <a name="sample-code"></a><span data-ttu-id="df8d8-218">Exemple de code</span><span class="sxs-lookup"><span data-stu-id="df8d8-218">Sample code</span></span>

<span data-ttu-id="df8d8-219">Consultez notre exemple d’application : [MSTeams Tabs SSO Sample-NodeJS](https://github.com/OfficeDev/msteams-tabs-sso-sample-nodejs)</span><span class="sxs-lookup"><span data-stu-id="df8d8-219">Visit our sample application: [MSTeams Tabs SSO Sample - Nodejs](https://github.com/OfficeDev/msteams-tabs-sso-sample-nodejs)</span></span>

<span data-ttu-id="df8d8-220">Le fichier Lisez-moi décrit la configuration de votre environnement de développement et la configuration de votre application dans Azure AD.</span><span class="sxs-lookup"><span data-stu-id="df8d8-220">The README explains how to set up your development environment and how to configure your application in Azure AD.</span></span> <span data-ttu-id="df8d8-221">Vous pouvez également trouver des informations supplémentaires sur la façon dont l’exemple est structuré dans la [section structure](https://github.com/OfficeDev/msteams-tabs-sso-sample-nodejs#app-structure) de l’application pour vous aider à vous familiariser avec le code base.</span><span class="sxs-lookup"><span data-stu-id="df8d8-221">You can also find further information on how the sample is structured in the [app structure section](https://github.com/OfficeDev/msteams-tabs-sso-sample-nodejs#app-structure) to help familiarize yourself with the codebase.</span></span>

## <a name="known-limitations"></a><span data-ttu-id="df8d8-222">Limitations connues</span><span class="sxs-lookup"><span data-stu-id="df8d8-222">Known Limitations</span></span>

### <a name="apps-that-require-additional-microsoft-graph-scopes"></a><span data-ttu-id="df8d8-223">Applications qui requièrent des étendues Microsoft Graph supplémentaires</span><span class="sxs-lookup"><span data-stu-id="df8d8-223">Apps that require additional Microsoft Graph Scopes</span></span>

<span data-ttu-id="df8d8-224">Notre implémentation actuelle de SSO accorde uniquement le consentement pour les autorisations au niveau de l’utilisateur : e-mail, Profile, offline_access, OpenId, et non pour d’autres API (telles que User. Read ou mail. Read).</span><span class="sxs-lookup"><span data-stu-id="df8d8-224">Our current implementation for SSO only grants consent for user-level permissions — email, profile, offline_access, OpenId — not for other APIs (such as User.Read or Mail.Read).</span></span> <span data-ttu-id="df8d8-225">Si votre application a besoin d’autres étendues Microsoft Graph, voici quelques solutions d’activation :</span><span class="sxs-lookup"><span data-stu-id="df8d8-225">If your app needs further Microsoft Graph scopes, here are some enabling workarounds:</span></span>

#### <a name="tenant-admin-consent"></a><span data-ttu-id="df8d8-226">Consentement de l’administrateur client</span><span class="sxs-lookup"><span data-stu-id="df8d8-226">Tenant Admin Consent</span></span>

<span data-ttu-id="df8d8-227">L’approche la plus simple consiste à obtenir de l’administrateur client le consentement préalable au nom de l’organisation.</span><span class="sxs-lookup"><span data-stu-id="df8d8-227">The simplest approach is to get a tenant admin to pre-consent on behalf of the organization.</span></span> <span data-ttu-id="df8d8-228">Cela signifie que les utilisateurs n’ont pas à consentir à ces étendues et vous pouvez alors être libre d’échanger le côté serveur de jetons à l’aide du flux de la [part de](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow)Azure ad.</span><span class="sxs-lookup"><span data-stu-id="df8d8-228">This means users won’t have to consent to these scopes and you can then be free to exchange the token server side using Azure AD’s [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow).</span></span> <span data-ttu-id="df8d8-229">Cette solution de contournement est acceptable pour les applications métiers internes, mais peut ne pas suffire pour les développeurs tiers qui ne pourront pas compter sur l’approbation de l’administrateur client.</span><span class="sxs-lookup"><span data-stu-id="df8d8-229">This workaround is acceptable for internal line-of-business applications but may not be enough for third-party developers who may not be able to rely on tenant admin approval.</span></span>

<span data-ttu-id="df8d8-230">Une méthode simple d’envoi pour le compte d’une organisation (en tant qu’administrateur client) consiste à visiter :</span><span class="sxs-lookup"><span data-stu-id="df8d8-230">A simple way of consenting on behalf of an organization (as a tenant admin) is to visit:</span></span>

* `https://login.microsoftonline.com/common/adminconsent?client_id=<AAD_App_ID>`

#### <a name="asking-for-additional-consent-using-the-auth-api"></a><span data-ttu-id="df8d8-231">Demande de consentement supplémentaire à l’aide de l’API auth</span><span class="sxs-lookup"><span data-stu-id="df8d8-231">Asking for additional consent using the Auth API</span></span>

<span data-ttu-id="df8d8-232">Une autre approche pour obtenir des étendues Microsoft Graph supplémentaires consiste à présenter une boîte de dialogue de consentement à l’aide de notre [approche d’authentification Web Azure ad existante,](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) qui implique de faire apparaître une boîte de dialogue d’autorisation Azure ad.</span><span class="sxs-lookup"><span data-stu-id="df8d8-232">Another approach for getting additional Microsoft Graph scopes is to present a consent dialog using our existing [web-based Azure AD authentication approach](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) which involves popping up an Azure AD consent dialog.</span></span> <span data-ttu-id="df8d8-233">Il existe des ajouts notables :</span><span class="sxs-lookup"><span data-stu-id="df8d8-233">There are some notable additions:</span></span>

1. <span data-ttu-id="df8d8-234">Le jeton récupéré à l’aide de `getAuthToken()` doit être échangé côté serveur à l’aide du flux Azure ad [de la part de](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) pour accéder à ces API Microsoft Graph supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="df8d8-234">The token retrieved using `getAuthToken()` needs to be exchanged server-side using Azure AD [on-behalf-of flow](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) to get access to those additional Microsoft Graph APIs.</span></span>
    * <span data-ttu-id="df8d8-235">Veillez à utiliser le point de terminaison Microsoft Graph v2 pour ce Exchange.</span><span class="sxs-lookup"><span data-stu-id="df8d8-235">Be sure to use the v2 Microsoft Graph endpoint for this exchange</span></span>
2. <span data-ttu-id="df8d8-236">Si l’échange échoue, Azure AD renvoie une exception Grant non valide.</span><span class="sxs-lookup"><span data-stu-id="df8d8-236">If the exchange fails, Azure AD will return an invalid grant exception.</span></span> <span data-ttu-id="df8d8-237">Il y a généralement l’un des deux messages d’erreur suivants : `invalid_grant` ou `interaction_required`</span><span class="sxs-lookup"><span data-stu-id="df8d8-237">There are usually one of two error messages: `invalid_grant` or `interaction_required`</span></span>
3. <span data-ttu-id="df8d8-238">Lorsque l’échange échoue, vous devez demander un consentement supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="df8d8-238">When the exchange fails, then you need to ask for additional consent.</span></span> <span data-ttu-id="df8d8-239">Nous vous recommandons d’afficher une interface utilisateur demandant à l’utilisateur d’accorder un consentement supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="df8d8-239">We recommend showing some UI asking the user to grant additional consent.</span></span> <span data-ttu-id="df8d8-240">Cette interface utilisateur doit inclure un bouton qui déclenche une boîte de dialogue d’autorisation Azure AD à l’aide de notre [API d’authentification Azure ad](~/concepts/authentication/auth-silent-aad.md).</span><span class="sxs-lookup"><span data-stu-id="df8d8-240">This UI should include a button that triggers an Azure AD consent dialog using our [Azure AD authentication API](~/concepts/authentication/auth-silent-aad.md).</span></span>
4. <span data-ttu-id="df8d8-241">Lorsque vous demandez un consentement supplémentaire d’Azure AD, vous devez inclure `prompt=consent` dans votre [paramètre de chaîne de requête](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) dans Azure ad, sinon Azure ad ne demandera pas les étendues supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="df8d8-241">When asking for additional consent from Azure AD, you need to include `prompt=consent` in your [query-string-parameter](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) to Azure AD otherwise Azure AD will not ask for the additional scopes.</span></span>
    * <span data-ttu-id="df8d8-242">Au lieu de: `?scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="df8d8-242">Instead of: `?scope={scopes}`</span></span>
    * <span data-ttu-id="df8d8-243">Utilisez ce qui suit : `?prompt=consent&scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="df8d8-243">Use this: `?prompt=consent&scope={scopes}`</span></span>
    * <span data-ttu-id="df8d8-244">Assurez- `{scopes}` vous que inclut toutes les étendues que vous invitez l’utilisateur (par exemple : mail. Read ou User. Read).</span><span class="sxs-lookup"><span data-stu-id="df8d8-244">Be sure that `{scopes}` includes all the scopes you are prompting the user for (ex: Mail.Read or User.Read).</span></span>
5. <span data-ttu-id="df8d8-245">Une fois que l’utilisateur a accordé une autorisation supplémentaire, essayez de nouveau pour accéder à ces API supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="df8d8-245">Once the user has granted additional permission, retry the on-behalf-of-flow to get access to these additional APIs.</span></span>

### <a name="non-azure-ad-authentication"></a><span data-ttu-id="df8d8-246">Authentification AD non Azure</span><span class="sxs-lookup"><span data-stu-id="df8d8-246">Non-Azure AD Authentication</span></span>

<span data-ttu-id="df8d8-247">La solution d’authentification décrite ci-dessus fonctionne uniquement pour les applications et les services qui prennent en charge Azure Active Directory en tant que fournisseur d’identité.</span><span class="sxs-lookup"><span data-stu-id="df8d8-247">The above-described authentication solution only works for apps and services that support Azure AD as an identity provider.</span></span> <span data-ttu-id="df8d8-248">Les applications qui souhaitent s’authentifier à l’aide de services non Azure AD doivent continuer à utiliser le flux de l' [authentification Web](~/concepts/authentication.md)contextuelle.</span><span class="sxs-lookup"><span data-stu-id="df8d8-248">Apps that want to authenticate using non-Azure AD based services need to continue using the pop-up-based [web authentication flow](~/concepts/authentication.md).</span></span>
