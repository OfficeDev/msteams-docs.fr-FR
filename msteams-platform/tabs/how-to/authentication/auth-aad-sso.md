---
title: Authentification unique
description: Décrit l’authentification unique (SSO)
keywords: AAD SSO d’authentification des équipes
ms.openlocfilehash: 1857651aecd902f04bd57f5b4e2fb0fda88eb348
ms.sourcegitcommit: 4329a94918263c85d6c65ff401f571556b80307b
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/01/2020
ms.locfileid: "41673549"
---
# <a name="single-sign-on"></a><span data-ttu-id="3d386-104">Authentification unique</span><span class="sxs-lookup"><span data-stu-id="3d386-104">Single Sign-On</span></span>

> [!NOTE]
> <span data-ttu-id="3d386-105">L’API d’authentification unique est actuellement prise en charge en _mode aperçu_ pour les développeurs uniquement.</span><span class="sxs-lookup"><span data-stu-id="3d386-105">The "single sign-on" API is currently supported in _Developer Preview_ only.</span></span>

<span data-ttu-id="3d386-106">Les utilisateurs se connectent à Microsoft teams à l’aide de leur compte professionnel ou scolaire (Office 365) et vous pouvez en tirer parti à l’aide de l’authentification unique (SSO) pour autoriser l’utilisateur à accéder à votre onglet Microsoft Teams. Cela signifie que si un utilisateur consent à utiliser votre application sur le bureau, il n’aura pas à se le consentir sur mobile et sera automatiquement connecté.</span><span class="sxs-lookup"><span data-stu-id="3d386-106">Users sign-in to Microsoft Teams using their work or school (Office 365) account and you can take advantage of this by using single sign-on (SSO) to authorize the user to your Microsoft Teams tab. That means if a user consents to use your app on desktop, they won’t have to consent again on mobile and will be automatically logged in.</span></span> 

## <a name="how-sso-works-at-runtime"></a><span data-ttu-id="3d386-107">Mode de fonctionnement de l’authentification unique SSO en cours d’exécution</span><span class="sxs-lookup"><span data-stu-id="3d386-107">How SSO works at runtime</span></span>

<span data-ttu-id="3d386-108">Le diagramme suivant illustre le fonctionnement du processus d’authentification unique :</span><span class="sxs-lookup"><span data-stu-id="3d386-108">The following diagram shows how the SSO process works:</span></span>

<img src="~/assets/images/tabs/tabs-sso-diagram.png" alt="Tab single sign-on SSO diagram" width="75%"/>

1. <span data-ttu-id="3d386-109">Dans l’onglet, JavaScript appelle getAuthToken ().</span><span class="sxs-lookup"><span data-stu-id="3d386-109">In the tab, JavaScript calls getAuthToken().</span></span> <span data-ttu-id="3d386-110">Cette option indique à l’application teams d’obtenir un jeton d’authentification pour l’application d’onglets.</span><span class="sxs-lookup"><span data-stu-id="3d386-110">This tells the Teams application to obtain an authentication token to the tab application.</span></span>
2. <span data-ttu-id="3d386-111">S’il s’agit de la première fois que l’utilisateur actuel a utilisé votre application d’onglets, ils seront invités à consentir (si un consentement est requis) ou doivent gérer l’authentification par étape (par exemple, authentification à deux facteurs).</span><span class="sxs-lookup"><span data-stu-id="3d386-111">If this is the first time the current user has used your tab application, they will be prompted to consent (if consent is required) or asked to handle step-up authentication (such as two-factor authentication).</span></span>
3. <span data-ttu-id="3d386-112">L’application Microsoft teams demande le jeton d’application d’onglets du point de terminaison Azure AD v 1.0 pour l’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="3d386-112">The Microsoft Teams application requests the tab application token from the Azure AD v1.0 endpoint for the current user.</span></span>
4. <span data-ttu-id="3d386-113">Azure AD envoie le jeton d’application d’onglet à l’application Teams.</span><span class="sxs-lookup"><span data-stu-id="3d386-113">Azure AD sends the tab application token to the Teams application.</span></span>
5. <span data-ttu-id="3d386-114">L’application Microsoft teams envoie le jeton de l’application d’onglet à l’onglet dans le cadre de l’objet result renvoyé par l’appel getAuthToken ().</span><span class="sxs-lookup"><span data-stu-id="3d386-114">The Microsoft Teams application sends the tab application token to the tab as part of the result object returned by the getAuthToken() call.</span></span>
6. <span data-ttu-id="3d386-115">JavaScript dans l’application d’onglets peut analyser le jeton et extraire les informations dont il a besoin, telles que l’adresse de messagerie de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="3d386-115">JavaScript in the tab application can parse the token and extract the information it needs, such as the user's email address.</span></span>
    * <span data-ttu-id="3d386-116">Remarque : ce jeton n’est valide que pour l’envoi à un ensemble limité d’API de niveau utilisateur (par exemple : e-mail, Profile, etc.) et non pour d’autres étendues de graphique (comme mail. Read).</span><span class="sxs-lookup"><span data-stu-id="3d386-116">Note: this token is only valid for consenting to a limited set of user-level APIs (ex: email, profile, etc)  and not for further Graph scopes (such as Mail.Read).</span></span> <span data-ttu-id="3d386-117">Consultez notre section à la fin de ce document pour obtenir des solutions de contournement si vous avez besoin d’autres étendues Graph.</span><span class="sxs-lookup"><span data-stu-id="3d386-117">See our section at the end of this document for suggested workarounds if you require additional Graph scopes.</span></span>

## <a name="develop-an-sso-microsoft-teams-tab"></a><span data-ttu-id="3d386-118">Développer un onglet Microsoft teams SSO</span><span class="sxs-lookup"><span data-stu-id="3d386-118">Develop an SSO Microsoft Teams tab</span></span>

<span data-ttu-id="3d386-119">Cette section décrit les tâches impliquées dans la création d’un onglet Microsoft teams qui utilisent l’authentification unique.</span><span class="sxs-lookup"><span data-stu-id="3d386-119">This section describes the tasks involved in creating an Microsoft Teams tab that use SSO.</span></span> <span data-ttu-id="3d386-120">Ces tâches sont décrites ici indépendamment du langage et de l’infrastructure.</span><span class="sxs-lookup"><span data-stu-id="3d386-120">These tasks are described here in a language- and framework-agnostic way.</span></span>

### <a name="1-create-your-aad-application-in-azure"></a><span data-ttu-id="3d386-121">1. créer votre application AAD dans Azure</span><span class="sxs-lookup"><span data-stu-id="3d386-121">1. Create your AAD application in Azure</span></span>

<span data-ttu-id="3d386-122">Inscrivez votre application sur le portail d’inscription pour le point de terminaison Azure AD v 1.0.</span><span class="sxs-lookup"><span data-stu-id="3d386-122">Register you application at the registration portal for the Azure AD v1.0 endpoint.</span></span> <span data-ttu-id="3d386-123">Il s’agit d’un processus de 5 à 10 minutes qui inclut les tâches suivantes:</span><span class="sxs-lookup"><span data-stu-id="3d386-123">This is a 5–10 minute process that includes the following tasks:</span></span>

* <span data-ttu-id="3d386-124">Obtention de votre ID d’application AAD</span><span class="sxs-lookup"><span data-stu-id="3d386-124">Getting your AAD application ID</span></span>
* <span data-ttu-id="3d386-125">Spécifiez les autorisations dont votre application a besoin pour le point de terminaison AAD (et éventuellement pour Microsoft Graph).</span><span class="sxs-lookup"><span data-stu-id="3d386-125">Specify the permissions that your application needs for the AAD endpoint (and optionally to Microsoft Graph).</span></span> 
* <span data-ttu-id="3d386-126">Accorder à l’application Microsoft teams de bureau, Web et mobile une approbation pour votre application</span><span class="sxs-lookup"><span data-stu-id="3d386-126">Grant the Microsoft Teams desktop, web and mobile application to trust to your application</span></span>
* <span data-ttu-id="3d386-127">Pré-autorisez l’application Microsoft teams dans votre application avec le nom d' `access_as_user`étendue par défaut.</span><span class="sxs-lookup"><span data-stu-id="3d386-127">Preauthorize the Microsoft Teams application to your app with the default scope name of `access_as_user`.</span></span>

> [!NOTE]
> <span data-ttu-id="3d386-128">Vous devez tenir compte de certaines restrictions importantes :</span><span class="sxs-lookup"><span data-stu-id="3d386-128">There are some important restrictions you should be aware of:</span></span>
>
> * <span data-ttu-id="3d386-129">Nous ne prenons en charge que les autorisations d’API Graph de niveau utilisateur (par ex., e-mail, Profile, offline_access, OpenID.</span><span class="sxs-lookup"><span data-stu-id="3d386-129">We only support user-level Graph API permissions (ie: email, profile, offline_access, openid.</span></span> <span data-ttu-id="3d386-130">Si vous avez besoin d’accéder à d’autres étendues Graph, lisez notre solution de contournement recommandée à la fin de cette documentation.</span><span class="sxs-lookup"><span data-stu-id="3d386-130">If you need access to other Graph scopes, read our recommended workaround at the end of this documentation.</span></span>
> * <span data-ttu-id="3d386-131">Il est important que le nom de domaine de votre application soit enregistré avec votre application Azure AD.</span><span class="sxs-lookup"><span data-stu-id="3d386-131">It's important that your application's domain name be registered with your Azure AD application.</span></span> <span data-ttu-id="3d386-132">Il doit s’agir du même nom de domaine que celui sur lequel votre application s’exécute lors de la demande d’un jeton d’authentification dans Teams, ainsi que de la spécification de la propriété de ressource dans votre manifeste Teams (plus d’informations dans la section suivante).</span><span class="sxs-lookup"><span data-stu-id="3d386-132">This must be the same domain name that your application runs on when requesting an authentication token in Teams and also when specifying the resource property in your Teams manifest (more details in the next section).</span></span>
> * <span data-ttu-id="3d386-133">Nous ne prenons actuellement pas en charge plusieurs domaines par application</span><span class="sxs-lookup"><span data-stu-id="3d386-133">We do not currently support multiple domains per app</span></span>
> * <span data-ttu-id="3d386-134">Nous ne prenons pas en charge les applications qui `azurewebsites.net` utilisent le domaine car ce domaine est trop courant et peuvent présenter un risque de sécurité.</span><span class="sxs-lookup"><span data-stu-id="3d386-134">We also do not support applications that use the `azurewebsites.net` domain since this domain is too common and may be a security risk</span></span>

#### <a name="steps"></a><span data-ttu-id="3d386-135">Étapes</span><span class="sxs-lookup"><span data-stu-id="3d386-135">Steps</span></span>

1. <span data-ttu-id="3d386-136">Enregistrer une nouvelle application dans [Azure Active Directory – portail d’inscription des applications](https://go.microsoft.com/fwlink/?linkid=2083908)</span><span class="sxs-lookup"><span data-stu-id="3d386-136">Register a new application in the [Azure Active Directory – App Registration](https://go.microsoft.com/fwlink/?linkid=2083908) portal</span></span>
2. <span data-ttu-id="3d386-137">Sélectionnez nouvelle inscription.</span><span class="sxs-lookup"><span data-stu-id="3d386-137">Select “New Registration”.</span></span> <span data-ttu-id="3d386-138">Sur la page inscrire une application, définissez les valeurs comme suit :</span><span class="sxs-lookup"><span data-stu-id="3d386-138">On the register an application page, set the values as follows:</span></span>
    * <span data-ttu-id="3d386-139">Définir le **nom** de votre application</span><span class="sxs-lookup"><span data-stu-id="3d386-139">Set **name** to your app name</span></span>
    * <span data-ttu-id="3d386-140">Définir les types de comptes **pris en charge** sur **les comptes de tous les comptes d’annuaire et de Microsoft personnels**</span><span class="sxs-lookup"><span data-stu-id="3d386-140">Set **supported account types** to **Accounts in any organizational directory and personal Microsoft accounts**</span></span>
    * <span data-ttu-id="3d386-141">Laisser l' **URI de redirection** vide</span><span class="sxs-lookup"><span data-stu-id="3d386-141">Leave **Redirect URI** empty</span></span>
    * <span data-ttu-id="3d386-142">Sélectionnez **Enregistrer**</span><span class="sxs-lookup"><span data-stu-id="3d386-142">Choose **Register**</span></span>
3. <span data-ttu-id="3d386-143">Sur la page vue d’ensemble, copiez et enregistrez l’ID de l' **application (client)**.</span><span class="sxs-lookup"><span data-stu-id="3d386-143">On the overview page, copy and save the **Application (client) ID**.</span></span> <span data-ttu-id="3d386-144">Vous en aurez besoin plus tard lors de la mise à jour de votre manifeste d’application Teams.</span><span class="sxs-lookup"><span data-stu-id="3d386-144">You’ll need it later when updating your Teams application manifest.</span></span>
4. <span data-ttu-id="3d386-145">Sélectionnez **Exposer une API** sous **Gérer**.</span><span class="sxs-lookup"><span data-stu-id="3d386-145">Select **Expose an API** under **Manage**.</span></span> <span data-ttu-id="3d386-146">Sélectionnez le lien **définir** pour générer l’URI de l’ID de l’application `api://{AppID}`sous la forme.</span><span class="sxs-lookup"><span data-stu-id="3d386-146">Select the **Set** link to generate the Application ID URI in the form of `api://{AppID}`.</span></span> <span data-ttu-id="3d386-147">Insérez votre nom de domaine complet (avec une barre oblique « / » ajoutée à la fin) entre les deux barres obliques et le GUID.</span><span class="sxs-lookup"><span data-stu-id="3d386-147">Insert your fully qualified domain name (with a forward slash "/" appended to the end) between the double forward slashes and the GUID.</span></span> <span data-ttu-id="3d386-148">L’ID entier doit avoir la forme suivante :`api://fully-qualified-domain-name.com/{AppID}`</span><span class="sxs-lookup"><span data-stu-id="3d386-148">The entire ID should have the form of: `api://fully-qualified-domain-name.com/{AppID}`</span></span>
    * <span data-ttu-id="3d386-149">ex : `api://subdomain.example.com:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`.</span><span class="sxs-lookup"><span data-stu-id="3d386-149">ex: `api://subdomain.example.com:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`.</span></span>

> [!NOTE]
> <span data-ttu-id="3d386-150">Si un message d’erreur s’affiche indiquant que le domaine appartient déjà à quelqu’un et que c’est vous qui en êtes le propriétaire, suivez la procédure décrite dans Quickstart [ : Ajouter votre nom de domaine personnalisé à l’aide du Portail Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) pour l’inscrire, puis répétez cette étape.</span><span class="sxs-lookup"><span data-stu-id="3d386-150">If you get an error saying that the domain is already owned but you own it, follow the procedure at [Quickstart: Add a custom domain name to Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) to register it, and then repeat this step.</span></span> <span data-ttu-id="3d386-151">(Cette erreur peut également se produire si vous n’êtes pas connecté avec des informations d’identification d’un administrateur dans le client Office 365 location).</span><span class="sxs-lookup"><span data-stu-id="3d386-151">(This error can also occur if you are not signed in with credentials of an admin in the Office 365 tenancy).</span></span>

5. <span data-ttu-id="3d386-152">Sélectionnez le bouton **Ajouter une étendue**.</span><span class="sxs-lookup"><span data-stu-id="3d386-152">Select the **Add a scope** button.</span></span> <span data-ttu-id="3d386-153">Dans le volet qui s’ouvre, entrez `access_as_user` en tant que **nom de l’étendue**.</span><span class="sxs-lookup"><span data-stu-id="3d386-153">In the panel that opens, enter `access_as_user` as the **Scope name**.</span></span>
6. <span data-ttu-id="3d386-154">Définir qui peut consentir ? pour les administrateurs et les utilisateurs</span><span class="sxs-lookup"><span data-stu-id="3d386-154">Set Who can consent? to Admins and users</span></span>
7. <span data-ttu-id="3d386-155">Renseignez les champs de configuration des invites de l’administrateur et du consentement de l’utilisateur avec des `access_as_user` valeurs appropriées pour l’étendue.</span><span class="sxs-lookup"><span data-stu-id="3d386-155">Fill in the fields for configuring the admin and user consent prompts with values that are appropriate for the `access_as_user` scope.</span></span> <span data-ttu-id="3d386-156">Suggestions :</span><span class="sxs-lookup"><span data-stu-id="3d386-156">Suggestions:</span></span>
    * <span data-ttu-id="3d386-157">**Titre du consentement administratif :** Les équipes peuvent accéder au profil de l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="3d386-157">**Admin consent title:** Teams can access the user’s profile</span></span>
    * <span data-ttu-id="3d386-158">**Description du consentement administratif**: permet à teams d’appeler les API Web de l’application en tant qu’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="3d386-158">**Admin consent description**: Allows Teams to call the app’s web APIs as the current user.</span></span>
    * <span data-ttu-id="3d386-159">**Titre du consentement**de l’utilisateur : teams peut accéder à votre profil utilisateur et faire des demandes à votre place.</span><span class="sxs-lookup"><span data-stu-id="3d386-159">**User consent title**: Teams can access your user profile and make requests on your behalf</span></span>
    * <span data-ttu-id="3d386-160">**Description du consentement de l’utilisateur :** Permettre aux équipes d’appeler les API de cette application avec les mêmes droits que ceux que vous avez</span><span class="sxs-lookup"><span data-stu-id="3d386-160">**User consent description:** Enable Teams to call this app’s APIs with the same rights that you have</span></span>
8. <span data-ttu-id="3d386-161">Vérifiez que l' **État** est défini sur **activé** .</span><span class="sxs-lookup"><span data-stu-id="3d386-161">Ensure that **State** is set to **Enabled**</span></span>
9. <span data-ttu-id="3d386-162">Sélectionnez **Ajouter une étendue**</span><span class="sxs-lookup"><span data-stu-id="3d386-162">Select **Add scope**</span></span>
    * <span data-ttu-id="3d386-163">Remarque : la partie domaine du **nom d’étendue** affiché juste en dessous du champ de texte doit correspondre automatiquement à l’URI d' **ID d’application** défini à `/access_as_user` l’étape précédente, avec ajouté à la fin ; par exemple :</span><span class="sxs-lookup"><span data-stu-id="3d386-163">Note: The domain part of the **Scope name** displayed just below the text field should automatically match the **Application ID** URI set in the previous step, with `/access_as_user` appended to the end; for example:</span></span> 
        * `api://subdomain.example.com:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user`
10. <span data-ttu-id="3d386-164">Dans la section **applications clientes autorisées** , vous identifiez les applications que vous souhaitez autoriser dans l’application Web de votre application.</span><span class="sxs-lookup"><span data-stu-id="3d386-164">In the **Authorized client applications** section, you identify the applications that you want to authorize to your app’s web application.</span></span> <span data-ttu-id="3d386-165">Chacun des ID suivants doit être entré :</span><span class="sxs-lookup"><span data-stu-id="3d386-165">Each of the following IDs needs to be entered:</span></span>
    * <span data-ttu-id="3d386-166">`1fec8e78-bce4-4aaf-ab1b-5451cc387264`(Team mobile/application de bureau)</span><span class="sxs-lookup"><span data-stu-id="3d386-166">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` (Teams mobile/desktop application)</span></span>
    * <span data-ttu-id="3d386-167">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346`(Application Web Teams)</span><span class="sxs-lookup"><span data-stu-id="3d386-167">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` (Teams web application)</span></span>
11. <span data-ttu-id="3d386-168">Accédez à **autorisations d’API**et assurez-vous d’ajouter les autorisations suivantes :</span><span class="sxs-lookup"><span data-stu-id="3d386-168">Navigate to **API Permissions**, and make sure to add the follow permissions:</span></span>
    * <span data-ttu-id="3d386-169">User. Read (activé par défaut)</span><span class="sxs-lookup"><span data-stu-id="3d386-169">User.Read (enabled by default)</span></span>
    * <span data-ttu-id="3d386-170">email</span><span class="sxs-lookup"><span data-stu-id="3d386-170">email</span></span>
    * <span data-ttu-id="3d386-171">offline_access</span><span class="sxs-lookup"><span data-stu-id="3d386-171">offline_access</span></span>
    * <span data-ttu-id="3d386-172">openid</span><span class="sxs-lookup"><span data-stu-id="3d386-172">openid</span></span>
    * <span data-ttu-id="3d386-173">profil</span><span class="sxs-lookup"><span data-stu-id="3d386-173">profile</span></span>

### <a name="2-update-your-microsoft-teams-application-manifest"></a><span data-ttu-id="3d386-174">2. mettre à jour le manifeste de votre application Microsoft teams</span><span class="sxs-lookup"><span data-stu-id="3d386-174">2. Update your Microsoft Teams application manifest</span></span>

<span data-ttu-id="3d386-175">Ajoutez de nouvelles propriétés à votre manifeste Microsoft teams :</span><span class="sxs-lookup"><span data-stu-id="3d386-175">Add new properties to your Microsoft Teams manifest:</span></span>

* <span data-ttu-id="3d386-176">**WebApplicationInfo**: le parent des éléments suivants.</span><span class="sxs-lookup"><span data-stu-id="3d386-176">**WebApplicationInfo** - The parent of the following elements.</span></span>
* <span data-ttu-id="3d386-177">**ID** : ID client de l’application.</span><span class="sxs-lookup"><span data-stu-id="3d386-177">**Id** - The client ID of the application.</span></span> <span data-ttu-id="3d386-178">Il s’agit d’un ID d’application que vous obtenez dans le cadre de l’inscription de l’application avec le point de terminaison Azure AD 1,0.</span><span class="sxs-lookup"><span data-stu-id="3d386-178">This is an application ID that you obtain as part of registering the application with Azure AD 1.0 endpoint.</span></span>
* <span data-ttu-id="3d386-179">**Ressource** -le domaine et le sous-domaine de votre application.</span><span class="sxs-lookup"><span data-stu-id="3d386-179">**Resource** - The domain and subdomain of your application.</span></span> <span data-ttu-id="3d386-180">Il s’agit du même URI (y `api://` compris le protocole) que vous avez utilisé lors de l’inscription de l’application dans AAD.</span><span class="sxs-lookup"><span data-stu-id="3d386-180">This is the same URI (including the `api://` protocol) that you used when registering the app in AAD.</span></span> <span data-ttu-id="3d386-181">La partie domaine de cet URI doit correspondre au domaine, y compris à tous les sous-domaines, utilisés dans les URL de la section du manifeste de votre application Teams.</span><span class="sxs-lookup"><span data-stu-id="3d386-181">The domain part of this URI should match the domain, including any subdomains, used in the URLs in the section of your Teams application manifest.</span></span>

```json
"webApplicationInfo": {
  "id": "<application_GUID here>",
  "resource": "<web_API resource here>"
}
```

<span data-ttu-id="3d386-182">Remarques :</span><span class="sxs-lookup"><span data-stu-id="3d386-182">Notes:</span></span>

* <span data-ttu-id="3d386-183">La ressource pour une application AAD sera généralement la racine de son URL de site et de l’appID (par exemple `api://subdomain.example.com/6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`).</span><span class="sxs-lookup"><span data-stu-id="3d386-183">The resource for an AAD app will usually just be the root of its site URL and the appID (e.g. `api://subdomain.example.com/6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`).</span></span> <span data-ttu-id="3d386-184">Nous utilisons également cette valeur pour vous assurer que votre demande provient du même domaine.</span><span class="sxs-lookup"><span data-stu-id="3d386-184">We also use this value to ensure your request is coming from the same domain.</span></span> <span data-ttu-id="3d386-185">Pour ce faire, vérifiez `contentURL` que votre onglet utilise les mêmes domaines que votre propriété de ressource.</span><span class="sxs-lookup"><span data-stu-id="3d386-185">Therefor make sure that your `contentURL` for your tab uses the same domains as your resource property.</span></span>
* <span data-ttu-id="3d386-186">Vous devez utiliser le manifeste version 1,5 ou une version ultérieure pour que ces champs soient utilisés.</span><span class="sxs-lookup"><span data-stu-id="3d386-186">You need to be using manifest version 1.5 or higher for these fields to be used.</span></span>
* <span data-ttu-id="3d386-187">Les étendues ne sont pas prises en charge dans le manifeste et doivent plutôt être spécifiées dans la section des autorisations d’API dans le portail Azure.</span><span class="sxs-lookup"><span data-stu-id="3d386-187">Scopes aren’t supported in the manifest and instead should be specified in the API Permissions section in the Azure portal</span></span>

### <a name="3-get-an-authentication-token-from-your-client-side-code"></a><span data-ttu-id="3d386-188">3. obtenir un jeton d’authentification à partir de votre code côté client</span><span class="sxs-lookup"><span data-stu-id="3d386-188">3. Get an authentication token from your client-side code</span></span>

<span data-ttu-id="3d386-189">Voici à quoi ressemble l’API d’authentification :</span><span class="sxs-lookup"><span data-stu-id="3d386-189">Here's what the authentication API looks like:</span></span>

```javascript
var authTokenRequest = {
  successCallback: function(result) { console.log("Success: " + result); },
  failureCallback: function(error) { console.log("Failure: " + error); },
};
microsoftTeams.authentication.getAuthToken(authTokenRequest);
```

<span data-ttu-id="3d386-190">Lorsque vous appelez `getAuthToken` , un consentement d’utilisateur supplémentaire est requis (pour les autorisations au niveau de l’utilisateur)-une boîte de dialogue s’affichera pour que l’utilisateur les encourage à accorder un consentement supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="3d386-190">When you call `getAuthToken` - and additional user consent is required (for user-level permissions) - we will show a dialog to the user encouraging them to grant additional consent.</span></span> 

<img src="~/assets/images/tabs/tabs-sso-prompt.png" alt="Tab single sign-on SSO dialog prompt" width="75%"/>

## <a name="demo-code"></a><span data-ttu-id="3d386-191">Code de démonstration</span><span class="sxs-lookup"><span data-stu-id="3d386-191">Demo code</span></span>

<span data-ttu-id="3d386-192">Pour l’instant, vous pouvez accéder à notre tâche d’application de test [Meow](https://github.com/ydogandjiev/taskmeow) et utiliser le `teams.auth.service.js` manifeste `sso.auth.service.js` SSO et extraire le fichier et pour voir comment nous manipulons le flux de travail d’authentification.</span><span class="sxs-lookup"><span data-stu-id="3d386-192">For now you can visit our test application [Task Meow](https://github.com/ydogandjiev/taskmeow) and use the SSO manifest and checkout the `teams.auth.service.js` and `sso.auth.service.js` file to see how we handle the authentication workflow.</span></span>

## <a name="known-limitations"></a><span data-ttu-id="3d386-193">Limitations connues</span><span class="sxs-lookup"><span data-stu-id="3d386-193">Known Limitations</span></span>

### <a name="apps-that-require-additional-graph-scopes"></a><span data-ttu-id="3d386-194">Applications qui requièrent des étendues Graph supplémentaires</span><span class="sxs-lookup"><span data-stu-id="3d386-194">Apps that require additional Graph Scopes</span></span>

<span data-ttu-id="3d386-195">Notre implémentation actuelle de l’authentification unique accorde uniquement le consentement pour les autorisations au niveau de l’utilisateur (courrier électronique, profil, offline_access, OpenID), mais pas pour les autres API (telles que mail. Read).</span><span class="sxs-lookup"><span data-stu-id="3d386-195">Our current implementation for SSO only grants consent for user-level permissions (email, profile, offline_access, openid) but not for other APIs (such as Mail.Read).</span></span> <span data-ttu-id="3d386-196">Si votre application a besoin d’autres étendues de graphique, il existe des solutions de contournement pour l’activer.</span><span class="sxs-lookup"><span data-stu-id="3d386-196">If your app needs further Graph scopes, there are some workarounds to enable this.</span></span>

#### <a name="tenant-admin-consent"></a><span data-ttu-id="3d386-197">Consentement de l’administrateur client</span><span class="sxs-lookup"><span data-stu-id="3d386-197">Tenant Admin Consent</span></span>

<span data-ttu-id="3d386-198">L’approche la plus simple consisterait à obtenir de l’administrateur client le consentement préalable au nom de l’organisation.</span><span class="sxs-lookup"><span data-stu-id="3d386-198">The simplest approach would be to get a tenant admin to pre-consent on behalf of the organization.</span></span> <span data-ttu-id="3d386-199">Cela signifie que les utilisateurs n’ont pas à consentir à ces étendues et vous pouvez alors être libre d’échanger le côté serveur de jetons à l’aide du flux de la [part de](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow)AAD.</span><span class="sxs-lookup"><span data-stu-id="3d386-199">This means users won’t have to consent to these scopes and you can then be free to exchange the token server side using AAD’s [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow).</span></span> <span data-ttu-id="3d386-200">Cette solution de contournement est acceptable pour les applications métiers internes, mais peut ne pas suffire pour les éditeurs de logiciels indépendants qui ne peuvent pas compter sur l’approbation de l’administrateur client.</span><span class="sxs-lookup"><span data-stu-id="3d386-200">This workaround is acceptable for internal line-of-business applications but may not be enough for ISVs who may not be able to rely on tenant admin approval.</span></span>

<span data-ttu-id="3d386-201">Une méthode simple d’envoi pour le compte d’une organisation (en tant qu’administrateur client) consiste à visiter :</span><span class="sxs-lookup"><span data-stu-id="3d386-201">A simple way of consenting on behalf of an organization (as a tenant admin) is to visit:</span></span>

* `https://login.microsoftonline.com/common/adminconsent?client_id=<AAD_App_ID>`

#### <a name="asking-for-additional-consent-using-the-auth-api"></a><span data-ttu-id="3d386-202">Demande de consentement supplémentaire à l’aide de l’API auth</span><span class="sxs-lookup"><span data-stu-id="3d386-202">Asking for additional consent using the Auth API</span></span>

<span data-ttu-id="3d386-203">Une autre approche pour obtenir des étendues Graph supplémentaires serait de présenter une boîte de dialogue de consentement à l’aide de notre [approche d’authentification AAD basée sur le Web existante,](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) qui implique de faire apparaître une boîte de dialogue de consentement AAD.</span><span class="sxs-lookup"><span data-stu-id="3d386-203">Another approach for getting additional Graph scopes would be to present a consent dialog using our existing [web-based AAD authentication approach](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) which involves popping up an AAD consent dialog.</span></span> <span data-ttu-id="3d386-204">Il existe des ajouts notables :</span><span class="sxs-lookup"><span data-stu-id="3d386-204">There are some notable additions:</span></span>

1. <span data-ttu-id="3d386-205">Le jeton récupéré à l’aide de getAuthToken doit être échangé côté serveur à l’aide [du flux de la part de](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow) AADS pour accéder à ces API Graph supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="3d386-205">The token retrieved using getAuthToken would need to be exchanged server side using AADs [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow) to get access to those additional Graph APIs.</span></span>
    * <span data-ttu-id="3d386-206">Veillez à utiliser le point de terminaison Graph v2 pour ce Exchange</span><span class="sxs-lookup"><span data-stu-id="3d386-206">Be sure to use the v2 Graph endpoint for this exchange</span></span>
2. <span data-ttu-id="3d386-207">Si l’échange échoue, AAD renvoie une exception Grant non valide.</span><span class="sxs-lookup"><span data-stu-id="3d386-207">If the exchange fails, AAD will return an invalid grant exception.</span></span> <span data-ttu-id="3d386-208">Il y a généralement l’un des deux messages `ConsentRequired` d’erreur suivants : ou`InteractionRequired`</span><span class="sxs-lookup"><span data-stu-id="3d386-208">There are usually one of two error messages: `ConsentRequired` or `InteractionRequired`</span></span>
3. <span data-ttu-id="3d386-209">Lorsque l’échange échoue, vous devez demander un consentement supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="3d386-209">When the exchange fails, then you need to ask for additional consent.</span></span> <span data-ttu-id="3d386-210">Nous vous recommandons d’afficher une interface utilisateur demandant à l’utilisateur d’accorder un consentement supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="3d386-210">We recommend showing some UI asking the user to grant additional consent.</span></span> <span data-ttu-id="3d386-211">Cette interface utilisateur doit inclure un bouton qui déclenche une boîte de dialogue de consentement AAD à l’aide de notre [API d’authentification AAD](~/concepts/authentication/auth-silent-aad.md).</span><span class="sxs-lookup"><span data-stu-id="3d386-211">This UI should include a button that triggers an AAD consent dialog using our [AAD authentication API](~/concepts/authentication/auth-silent-aad.md).</span></span>
4. <span data-ttu-id="3d386-212">Lorsque vous demandez un consentement supplémentaire de AAD, vous devez inclure `prompt=consent` dans votre [paramètre de chaîne de requête](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) dans AAD sinon AAD ne demande pas les étendues supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="3d386-212">When asking for additional consent from AAD, you need to include `prompt=consent` in your [query-string-parameter](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) to AAD otherwise AAD will not ask for the additional scopes.</span></span>
    * <span data-ttu-id="3d386-213">Au lieu de:`?scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="3d386-213">Instead of: `?scope={scopes}`</span></span>
    * <span data-ttu-id="3d386-214">Utilisez ce qui suit :`?prompt=consent&scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="3d386-214">Use this: `?prompt=consent&scope={scopes}`</span></span>
    * <span data-ttu-id="3d386-215">Assurez- `{scopes}` vous que inclut toutes les étendues que vous invitez l’utilisateur (par exemple : mail. Read ou User. Read).</span><span class="sxs-lookup"><span data-stu-id="3d386-215">Be sure that `{scopes}` includes all the scopes you are prompting the user for (ex: Mail.Read or User.Read).</span></span>
5. <span data-ttu-id="3d386-216">Une fois que l’utilisateur a accordé une autorisation supplémentaire, essayez de nouveau pour accéder à ces API supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="3d386-216">Once the user has granted additional permission, retry the on-behalf-of-flow to get access to these additional APIs.</span></span>

### <a name="non-aad-authentication"></a><span data-ttu-id="3d386-217">Authentification non AAD</span><span class="sxs-lookup"><span data-stu-id="3d386-217">Non-AAD Authentication</span></span>

<span data-ttu-id="3d386-218">La solution d’authentification décrite ci-dessus fonctionne uniquement pour les applications et les services qui prennent en charge Azure Active Directory en tant que fournisseur d’identité.</span><span class="sxs-lookup"><span data-stu-id="3d386-218">The above-described authentication solution only works for apps and services that support Azure AD as an identity provider.</span></span> <span data-ttu-id="3d386-219">Les applications qui souhaitent s’authentifier à l’aide de services non AAD doivent continuer à utiliser le [flux d’authentification Web](~/concepts/authentication.md)en fenêtre contextuelle.</span><span class="sxs-lookup"><span data-stu-id="3d386-219">Apps that want to authenticate using non-AAD based services need to continue using the popup-based [web authentication flow](~/concepts/authentication.md).</span></span>
