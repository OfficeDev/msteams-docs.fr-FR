---
title: Prise en charge de l' sign-on unique pour les onglets
description: Décrit l' sign-on unique (SSO)
ms.topic: how-to
keywords: Api d’authentification unique SSO AAD d’authentification teams
ms.openlocfilehash: 9392c3c01a7fa6dffc673cd01f57d0eab1720efe
ms.sourcegitcommit: 976e870cc925f61b76c3830ec04ba6e4bdfde32f
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/27/2021
ms.locfileid: "50014123"
---
# <a name="single-sign-on-sso-support-for-tabs"></a><span data-ttu-id="0f549-104">Prise en charge de l' sign-on unique (SSO) pour les onglets</span><span class="sxs-lookup"><span data-stu-id="0f549-104">Single sign-on (SSO) support for tabs</span></span>

<span data-ttu-id="0f549-105">Les utilisateurs se connectent à Microsoft Teams via leurs comptes professionnels, scolaires ou Microsoft (Office 365, Outlook, etc.).</span><span class="sxs-lookup"><span data-stu-id="0f549-105">Users sign in to Microsoft Teams via their work, school, or Microsoft accounts (Office 365, Outlook, etc).</span></span> <span data-ttu-id="0f549-106">Vous pouvez en tirer parti en permettant à une sign-on unique d’autoriser votre onglet Microsoft Teams (ou module de tâche) sur les clients de bureau ou mobiles.</span><span class="sxs-lookup"><span data-stu-id="0f549-106">You can take advantage of this by allowing a single sign-on to authorize your Microsoft Teams tab (or task module) on desktop or mobile clients.</span></span> <span data-ttu-id="0f549-107">Par conséquent, si un utilisateur consent à utiliser votre application, il n’aura pas à consentir à nouveau sur un autre appareil ; il sera connecté automatiquement.</span><span class="sxs-lookup"><span data-stu-id="0f549-107">Thus, if a user consents to use your app, they won’t have to consent again on another device — they will be signed in automatically.</span></span> <span data-ttu-id="0f549-108">En outre, nous préréférons votre jeton d’accès pour améliorer les performances et les temps de chargement.</span><span class="sxs-lookup"><span data-stu-id="0f549-108">In addition, we prefetch your access token to improve performance and load times.</span></span>

>[!NOTE]
> <span data-ttu-id="0f549-109">**Versions des clients mobiles Teams qui la prise en charge de l' sso**</span><span class="sxs-lookup"><span data-stu-id="0f549-109">**Teams mobile client versions supporting SSO**</span></span>  
>
> <span data-ttu-id="0f549-110">✔Teams pour Android (1416/1.0.0.2020073101 et ultérieures)</span><span class="sxs-lookup"><span data-stu-id="0f549-110">✔Teams for Android (1416/1.0.0.2020073101 and later)</span></span>
>
> <span data-ttu-id="0f549-111">✔Teams pour iOS (_Version_: 2.0.18 et versions ultérieures)</span><span class="sxs-lookup"><span data-stu-id="0f549-111">✔Teams for iOS (_Version_: 2.0.18 and later)</span></span>  
>
> <span data-ttu-id="0f549-112">Pour une expérience améliorée avec Teams, utilisez la dernière version d’iOS et Android.</span><span class="sxs-lookup"><span data-stu-id="0f549-112">For the best experience with Teams, please use the latest version of iOS and Android.</span></span>

>[!NOTE]
> <span data-ttu-id="0f549-113">**Démarrage rapide**</span><span class="sxs-lookup"><span data-stu-id="0f549-113">**Quickstart**</span></span>  
>
> <span data-ttu-id="0f549-114">Le chemin d’accès le plus simple à la mise en route de l' sso tabulation est avec l’outil Microsoft Teams Shared Computer Toolkit pour Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="0f549-114">The simplest path to getting started with tab SSO is with the Microsoft Teams Toolkit for Visual Studio Code.</span></span> [<span data-ttu-id="0f549-115">En savoir plus</span><span class="sxs-lookup"><span data-stu-id="0f549-115">Learn more</span></span>](../../../toolkit/visual-studio-code-tab-sso.md)


## <a name="how-sso-works-at-runtime"></a><span data-ttu-id="0f549-116">Mode de fonctionnement de l’authentification unique SSO en cours d’exécution</span><span class="sxs-lookup"><span data-stu-id="0f549-116">How SSO works at runtime</span></span>

<span data-ttu-id="0f549-117">Le diagramme suivant illustre le fonctionnement du processus d' clés sso :</span><span class="sxs-lookup"><span data-stu-id="0f549-117">The following diagram shows how the SSO process works:</span></span>

<!-- markdownlint-disable MD033 -->
<img src="~/assets/images/tabs/tabs-sso-diagram.png" alt="Tab single sign-on SSO diagram" width="75%"/>

1. <span data-ttu-id="0f549-118">Dans l’onglet, un appel JavaScript est effectué vers `getAuthToken()` .</span><span class="sxs-lookup"><span data-stu-id="0f549-118">In the tab, a JavaScript call is made to `getAuthToken()`.</span></span> <span data-ttu-id="0f549-119">Cela indique à Teams d’obtenir un jeton d’authentification pour l’application onglet.</span><span class="sxs-lookup"><span data-stu-id="0f549-119">This tells Teams to obtain an authentication token for the tab application.</span></span>
2. <span data-ttu-id="0f549-120">S’il s’agit de la première fois que l’utilisateur actuel utilise votre application d’onglet, une invite de demande de consentement (le cas échéant) ou de gérer l’authentification par étapes (par exemple, l’authentification à deux facteurs).</span><span class="sxs-lookup"><span data-stu-id="0f549-120">If this is the first time the current user has used your tab application, there will be a request prompt to consent (if consent is required) or to handle step-up authentication (such as two-factor authentication).</span></span>
3. <span data-ttu-id="0f549-121">Teams demande le jeton d’application d’onglet au point de terminaison Azure AD pour l’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="0f549-121">Teams requests the tab application token from the Azure AD endpoint for the current user.</span></span>
4. <span data-ttu-id="0f549-122">Azure AD envoie le jeton d’application d’onglet à l’application Teams.</span><span class="sxs-lookup"><span data-stu-id="0f549-122">Azure AD sends the tab application token to the Teams application.</span></span>
5. <span data-ttu-id="0f549-123">Teams envoie le jeton d’application d’onglet à l’onglet dans le cadre de l’objet de résultat renvoyé par `getAuthToken()` l’appel.</span><span class="sxs-lookup"><span data-stu-id="0f549-123">Teams sends the tab application token to the tab as part of the result object returned by the `getAuthToken()` call.</span></span>
6. <span data-ttu-id="0f549-124">Le jeton est alors paré dans l’application d’onglet, via JavaScript, pour extraire les informations nécessaires, telles que l’adresse e-mail de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="0f549-124">The token will be parsed in the tab application, via JavaScript, to extract the needed information, such as the user's email address.</span></span>

> [!NOTE]
> <span data-ttu-id="0f549-125">L’autorisation est uniquement valide pour consentir à un ensemble limité d’API de niveau utilisateur (messagerie, profil, offline_access et OpenId) et non pour d’autres `getAuthToken()` étendues Microsoft Graph telles que ou `User.Read` `Mail.Read` .</span><span class="sxs-lookup"><span data-stu-id="0f549-125">The `getAuthToken()` is only valid for consenting to a limited set of user-level APIs — email, profile, offline_access and OpenId — and not for further Microsoft Graph scopes such as `User.Read` or `Mail.Read`.</span></span> <span data-ttu-id="0f549-126">Consultez notre section à la fin de ce document pour obtenir des solutions de contournement suggérées si vous avez besoin d’étendues [Graph supplémentaires.](#apps-that-require-additional-microsoft-graph-scopes)</span><span class="sxs-lookup"><span data-stu-id="0f549-126">See our section at the end of this document for suggested workarounds if you require [additional Graph scopes](#apps-that-require-additional-microsoft-graph-scopes).</span></span>

<span data-ttu-id="0f549-127">L’API DSO fonctionne également dans les [modules de tâche](../../../task-modules-and-cards/what-are-task-modules.md) qui incorporent du contenu web.</span><span class="sxs-lookup"><span data-stu-id="0f549-127">The SSO API will also work in [Task Modules](../../../task-modules-and-cards/what-are-task-modules.md) that embed web content.</span></span>

## <a name="develop-an-sso-microsoft-teams-tab"></a><span data-ttu-id="0f549-128">Développer un onglet SSO Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="0f549-128">Develop an SSO Microsoft Teams tab</span></span>

<span data-ttu-id="0f549-129">Cette section décrit les tâches impliquées dans la création d’un onglet Teams qui utilise l' sso.</span><span class="sxs-lookup"><span data-stu-id="0f549-129">This section describes the tasks involved in creating a Teams tab that uses SSO.</span></span> <span data-ttu-id="0f549-130">Ces tâches sont décrites ici sans langue et sans infrastructure.</span><span class="sxs-lookup"><span data-stu-id="0f549-130">These tasks are described here are language- and framework-agnostic.</span></span>

### <a name="1-create-your-azure-active-directory-azure-ad-application"></a><span data-ttu-id="0f549-131">1. Créer votre application Azure Active Directory (Azure AD)</span><span class="sxs-lookup"><span data-stu-id="0f549-131">1. Create your Azure Active Directory (Azure AD) application</span></span>

#### <a name="registering-your-application-in-theazure-ad-portal-overview"></a><span data-ttu-id="0f549-132">Inscription de votre application dans la vue[d’ensemble du portail Azure AD](https://azure.microsoft.com/features/azure-portal/) :</span><span class="sxs-lookup"><span data-stu-id="0f549-132">Registering your application in the[Azure AD portal](https://azure.microsoft.com/features/azure-portal/) overview:</span></span>

1. <span data-ttu-id="0f549-133">Obtenez votre [ID d’application Azure AD.](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in)</span><span class="sxs-lookup"><span data-stu-id="0f549-133">Get your [Azure AD Application ID](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in).</span></span>
2. <span data-ttu-id="0f549-134">Spécifiez les autorisations dont votre application a besoin pour le point de terminaison Azure AD et, éventuellement, Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="0f549-134">Specify the permissions that your application needs for the Azure AD endpoint and, optionally, Microsoft Graph.</span></span>
3. <span data-ttu-id="0f549-135">[Accorder des autorisations](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) pour les applications de bureau, web et mobiles Teams.</span><span class="sxs-lookup"><span data-stu-id="0f549-135">[Grant permissions](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) for Teams desktop, web, and mobile applications.</span></span>
4. <span data-ttu-id="0f549-136">Pré-autoriser Teams en sélectionnant le bouton Ajouter une étendue et dans le panneau qui s’ouvre, entrez le nom de  `access_as_user` **l’étendue.**</span><span class="sxs-lookup"><span data-stu-id="0f549-136">Pre-authorize Teams by selecting the **Add a scope** button and in the panel that opens, enter `access_as_user` as the **Scope name**.</span></span>

> [!NOTE]
> <span data-ttu-id="0f549-137">Vous devez connaître certaines restrictions importantes :</span><span class="sxs-lookup"><span data-stu-id="0f549-137">There are some important restrictions you should be aware of:</span></span>
>
> * <span data-ttu-id="0f549-138">Nous prise en charge uniquement les autorisations de l’API Microsoft Graph au niveau de l’utilisateur, c’est-à-dire, e-mail, profil, offline_access, OpenId.</span><span class="sxs-lookup"><span data-stu-id="0f549-138">We only support user-level Microsoft Graph API permissions, i.e., email, profile, offline_access, OpenId.</span></span> <span data-ttu-id="0f549-139">Si vous avez besoin d’accéder à d’autres étendues Microsoft Graph (par exemple, ou ), consultez notre solution de contournement recommandée à la `User.Read` `Mail.Read` fin de cette documentation. [](#apps-that-require-additional-microsoft-graph-scopes)</span><span class="sxs-lookup"><span data-stu-id="0f549-139">If you need access to other Microsoft Graph scopes (such as `User.Read` or `Mail.Read`), see our [recommended workaround](#apps-that-require-additional-microsoft-graph-scopes) at the end of this documentation.</span></span>
> * <span data-ttu-id="0f549-140">Il est important que le nom de domaine de votre application soit identique au nom de domaine que vous avez inscrit pour votre application Azure AD.</span><span class="sxs-lookup"><span data-stu-id="0f549-140">It's important that your application's domain name is the same as the domain name you've registering for your Azure AD application.</span></span>
> * <span data-ttu-id="0f549-141">Pour l’instant, nous ne prisent pas en charge plusieurs domaines par application.</span><span class="sxs-lookup"><span data-stu-id="0f549-141">We don't currently support multiple domains per app.</span></span>
> * <span data-ttu-id="0f549-142">Nous ne ons pas prendre en charge les applications qui utilisent le domaine, car il est trop courant et `azurewebsites.net` peut être un risque pour la sécurité.</span><span class="sxs-lookup"><span data-stu-id="0f549-142">We don't support applications that use the `azurewebsites.net` domain because it is too common and may be a security risk.</span></span> <span data-ttu-id="0f549-143">Toutefois, nous cherchons activement à supprimer cette restriction.</span><span class="sxs-lookup"><span data-stu-id="0f549-143">However, we're actively seeking to remove this restriction.</span></span>

#### <a name="registering-your-app-through-the-azure-active-directory-portal-in-depth"></a><span data-ttu-id="0f549-144">Inscription détaillée de votre application via le portail Azure Active Directory :</span><span class="sxs-lookup"><span data-stu-id="0f549-144">Registering your app through the Azure Active Directory portal in-depth:</span></span>

1. <span data-ttu-id="0f549-145">Inscrivez une nouvelle application dans [le portail Azure Active Directory – App Registrations.](https://go.microsoft.com/fwlink/?linkid=2083908)</span><span class="sxs-lookup"><span data-stu-id="0f549-145">Register a new application in the [Azure Active Directory – App Registrations](https://go.microsoft.com/fwlink/?linkid=2083908) portal.</span></span>
2. <span data-ttu-id="0f549-146">Sélectionnez **Nouvelle inscription** et dans la page Inscrire *une application,* définissez les valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="0f549-146">Select **New Registration** and on the *register an application page*, set following values:</span></span>
    * <span data-ttu-id="0f549-147">Définissez **le** nom sur le nom de votre application.</span><span class="sxs-lookup"><span data-stu-id="0f549-147">Set **name** to your app name.</span></span>
    * <span data-ttu-id="0f549-148">Choisir les **types de comptes pris en** charge (n’importe quel type de compte fonctionne) ¹</span><span class="sxs-lookup"><span data-stu-id="0f549-148">Choose the **supported account types** (any account type will work) ¹</span></span>
    * <span data-ttu-id="0f549-149">Laissez **Redirect URI** vide.</span><span class="sxs-lookup"><span data-stu-id="0f549-149">Leave **Redirect URI** empty.</span></span>
    * <span data-ttu-id="0f549-150">Choisissez **Inscrire**.</span><span class="sxs-lookup"><span data-stu-id="0f549-150">Choose **Register**.</span></span>
3. <span data-ttu-id="0f549-151">Dans la page vue d’ensemble, copiez et enregistrez **l’ID de l’application (client).**</span><span class="sxs-lookup"><span data-stu-id="0f549-151">On the overview page, copy and save the **Application (client) ID**.</span></span> <span data-ttu-id="0f549-152">Vous en aurez besoin ultérieurement lors de la mise à jour du manifeste de votre application Teams.</span><span class="sxs-lookup"><span data-stu-id="0f549-152">You’ll need it later when updating your Teams application manifest.</span></span>
4. <span data-ttu-id="0f549-153">Sélectionnez **Exposer une API** sous **Gérer**.</span><span class="sxs-lookup"><span data-stu-id="0f549-153">Under **Manage**, select **Expose an API**.</span></span> 
5. <span data-ttu-id="0f549-154">Sélectionnez **le lien** Définir pour générer l’URI d’ID d’application sous la forme `api://{AppID}` .</span><span class="sxs-lookup"><span data-stu-id="0f549-154">Select the **Set** link to generate the Application ID URI in the form of `api://{AppID}`.</span></span> <span data-ttu-id="0f549-155">Insérez votre nom de domaine complet (avec une barre oblique « / » à la fin) entre les barres obliques doubles et le GUID.</span><span class="sxs-lookup"><span data-stu-id="0f549-155">Insert your fully qualified domain name (with a forward slash "/" appended to the end) between the double forward slashes and the GUID.</span></span> <span data-ttu-id="0f549-156">L’ID entier doit avoir la forme : `api://fully-qualified-domain-name.com/{AppID}` ²</span><span class="sxs-lookup"><span data-stu-id="0f549-156">The entire ID should have the form of: `api://fully-qualified-domain-name.com/{AppID}` ²</span></span>
    * <span data-ttu-id="0f549-157">ex: `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` .</span><span class="sxs-lookup"><span data-stu-id="0f549-157">ex: `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`.</span></span>
    
    <span data-ttu-id="0f549-158">Le nom de domaine complet est le nom de domaine lisible par l’homme à partir duquel votre application est servie.</span><span class="sxs-lookup"><span data-stu-id="0f549-158">The fully qualified domain name is the human readable domain name from which your app is served.</span></span> <span data-ttu-id="0f549-159">Si vous utilisez un service de tunneling tel que ngrok, vous devez mettre à jour cette valeur chaque fois que votre sous-domaine ngrok change.</span><span class="sxs-lookup"><span data-stu-id="0f549-159">If you are using a tunneling service such as ngrok, you will need to update     this value whenever your ngrok subdomain changes.</span></span> 
6. <span data-ttu-id="0f549-160">Sélectionnez le bouton **Ajouter une étendue**.</span><span class="sxs-lookup"><span data-stu-id="0f549-160">Select the **Add a scope** button.</span></span> <span data-ttu-id="0f549-161">Dans le volet qui s’ouvre, entrez `access_as_user` en tant que **nom de l’étendue**.</span><span class="sxs-lookup"><span data-stu-id="0f549-161">In the panel that opens, enter `access_as_user` as the **Scope name**.</span></span>
7. <span data-ttu-id="0f549-162">Définir **qui peut donner son consentement ?**`Admins and users`</span><span class="sxs-lookup"><span data-stu-id="0f549-162">Set **Who can consent?** to `Admins and users`</span></span>
8. <span data-ttu-id="0f549-163">Remplissez les champs pour configurer les invites de consentement de l’administrateur et de l’utilisateur avec des valeurs appropriées pour `access_as_user` l’étendue :</span><span class="sxs-lookup"><span data-stu-id="0f549-163">Fill in the fields for configuring the admin and user consent prompts with values that are appropriate for the `access_as_user` scope:</span></span>
    * <span data-ttu-id="0f549-164">**Titre du consentement de l’administrateur :** Teams peut accéder au profil de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="0f549-164">**Admin consent title:** Teams can access the user’s profile.</span></span>
    * <span data-ttu-id="0f549-165">**Description du consentement de** l’administrateur : permet à Teams d’appeler les API web de l’application en tant qu’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="0f549-165">**Admin consent description**: Allows Teams to call the app’s web APIs as the current user.</span></span>
    * <span data-ttu-id="0f549-166">**Titre du consentement de l’utilisateur**: Teams peut accéder au profil utilisateur et effectuer des demandes au nom de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="0f549-166">**User consent title**: Teams can access the user profile and make requests on the user's behalf.</span></span>
    * <span data-ttu-id="0f549-167">**Description du consentement de l’utilisateur :** Autorisez Teams à appeler les API de cette application avec les mêmes droits que l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="0f549-167">**User consent description:** Enable Teams to call this app’s APIs with the same rights as the user.</span></span>
9. <span data-ttu-id="0f549-168">S’assurer **que l’état** **est** activé</span><span class="sxs-lookup"><span data-stu-id="0f549-168">Ensure that **State** is set to **Enabled**</span></span>
10. <span data-ttu-id="0f549-169">Sélectionnez le **bouton Ajouter une étendue** à enregistrer</span><span class="sxs-lookup"><span data-stu-id="0f549-169">Select the **Add scope** button to save</span></span> 
    * <span data-ttu-id="0f549-170">La partie domaine  du nom d’étendue affichée juste en dessous du champ de texte doit automatiquement correspondre à l’URI **d’ID** d’application définie à l’étape précédente, avec ajouté à `/access_as_user` la fin :</span><span class="sxs-lookup"><span data-stu-id="0f549-170">The domain part of the **Scope name** displayed just below the text field should automatically match the **Application ID** URI set in the previous step, with `/access_as_user` appended to the end:</span></span>
        * `api://subdomain.example.com/00000000-0000-0000-0000-000000000000/access_as_user`
11. <span data-ttu-id="0f549-171">Dans la section **Applications clientes autorisées,** identifiez les applications que vous souhaitez autoriser pour l’application web de votre application.</span><span class="sxs-lookup"><span data-stu-id="0f549-171">In the **Authorized client applications** section, identify the applications that you want to authorize for your app’s web application.</span></span> <span data-ttu-id="0f549-172">Sélectionnez *Ajouter une application cliente.*</span><span class="sxs-lookup"><span data-stu-id="0f549-172">Select *Add a client application*.</span></span> <span data-ttu-id="0f549-173">Entrez chacun des ID client suivants et sélectionnez l’étendue autorisée que vous avez créée à l’étape précédente :</span><span class="sxs-lookup"><span data-stu-id="0f549-173">Enter each of the following client IDs and select the authorized scope you created in the previous step:</span></span>
    * <span data-ttu-id="0f549-174">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` (Application mobile/de bureau Teams)</span><span class="sxs-lookup"><span data-stu-id="0f549-174">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` (Teams mobile/desktop application)</span></span>
    * <span data-ttu-id="0f549-175">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` (Application web Teams)</span><span class="sxs-lookup"><span data-stu-id="0f549-175">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` (Teams web application)</span></span>
12. <span data-ttu-id="0f549-176">Accédez aux **autorisations d’API.**</span><span class="sxs-lookup"><span data-stu-id="0f549-176">Navigate to **API Permissions**.</span></span> <span data-ttu-id="0f549-177">Sélectionnez *Ajouter une autorisation Autorisation*  >  déléguée Microsoft *Graph,* puis ajoutez les autorisations suivantes à partir de  >  l’API Microsoft Graph :</span><span class="sxs-lookup"><span data-stu-id="0f549-177">Select *Add a permission* > *Microsoft Graph* > *Delegated permissions*, then add the following permissions from Microsoft Graph API:</span></span>
    * <span data-ttu-id="0f549-178">User.Read (activé par défaut)</span><span class="sxs-lookup"><span data-stu-id="0f549-178">User.Read (enabled by default)</span></span>
    * <span data-ttu-id="0f549-179">email</span><span class="sxs-lookup"><span data-stu-id="0f549-179">email</span></span>
    * <span data-ttu-id="0f549-180">offline_access</span><span class="sxs-lookup"><span data-stu-id="0f549-180">offline_access</span></span>
    * <span data-ttu-id="0f549-181">OpenId</span><span class="sxs-lookup"><span data-stu-id="0f549-181">OpenId</span></span>
    * <span data-ttu-id="0f549-182">profil</span><span class="sxs-lookup"><span data-stu-id="0f549-182">profile</span></span>

13. <span data-ttu-id="0f549-183">Accéder à **l’authentification**</span><span class="sxs-lookup"><span data-stu-id="0f549-183">Navigate to **Authentication**</span></span>

    <span data-ttu-id="0f549-184">Si une application n’a pas reçu le consentement de l’administrateur informatique, les utilisateurs doivent donner leur consentement la première fois qu’ils utilisent une application.</span><span class="sxs-lookup"><span data-stu-id="0f549-184">If an app hasn't been granted IT admin consent, users will have to provide consent the first time they use an app.</span></span>

    <span data-ttu-id="0f549-185">Définissez un URI de redirection :</span><span class="sxs-lookup"><span data-stu-id="0f549-185">Set a redirect URI:</span></span>
    * <span data-ttu-id="0f549-186">Sélectionnez **Ajouter une plateforme.**</span><span class="sxs-lookup"><span data-stu-id="0f549-186">Select **Add a platform**.</span></span>
    * <span data-ttu-id="0f549-187">Sélectionnez **web**.</span><span class="sxs-lookup"><span data-stu-id="0f549-187">Select **web**.</span></span>
    * <span data-ttu-id="0f549-188">Entrez **l’URI de redirection** de votre application.</span><span class="sxs-lookup"><span data-stu-id="0f549-188">Enter the **redirect URI** for your app.</span></span> <span data-ttu-id="0f549-189">Il s’agit de la page dans laquelle un flux d’octroi implicite réussi redirige l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="0f549-189">This will be the page where a successful implicit grant flow will redirect the user.</span></span> <span data-ttu-id="0f549-190">Il s’agit du même nom de domaine complet que celui que vous avez entré à l’étape 5, suivi de l’itinéraire d’API où une réponse d’authentification doit être envoyée.</span><span class="sxs-lookup"><span data-stu-id="0f549-190">This will be same fully qualified domain name that you entered in step 5 followed by the API route where a authentication response should be sent.</span></span> <span data-ttu-id="0f549-191">Si vous êtes en cours de suivi de l’un des exemples Teams, ce sera : `https://subdomain.example.com/auth-end`</span><span class="sxs-lookup"><span data-stu-id="0f549-191">If you are following any of the Teams samples, this will be: `https://subdomain.example.com/auth-end`</span></span>

    <span data-ttu-id="0f549-192">Ensuite, activez l’octroi implicite en cochant les cases suivantes :</span><span class="sxs-lookup"><span data-stu-id="0f549-192">Next, enable implicit grant by checking the following boxes:</span></span>  
    <span data-ttu-id="0f549-193">jeton ✔ ID de l'✔</span><span class="sxs-lookup"><span data-stu-id="0f549-193">✔ ID Token</span></span>  
    <span data-ttu-id="0f549-194">jeton ✔ d’accès</span><span class="sxs-lookup"><span data-stu-id="0f549-194">✔ Access Token</span></span>  
    
<span data-ttu-id="0f549-195">Félicitations !</span><span class="sxs-lookup"><span data-stu-id="0f549-195">Congratulations!</span></span> <span data-ttu-id="0f549-196">Vous avez rempli les conditions préalables à l’inscription de l’application pour poursuivre l’application d' ces onglets.</span><span class="sxs-lookup"><span data-stu-id="0f549-196">You have completed the app registration prerequisites to proceed with your tab SSO app.</span></span>     

> [!NOTE]
>
> * <span data-ttu-id="0f549-197">¹ Si votre application Azure AD  est inscrite dans le même client que celui où vous faites une demande d’authentification dans Teams, l’utilisateur n’est pas invité à donner son consentement et un jeton d’accès lui est accordé immédiatement.</span><span class="sxs-lookup"><span data-stu-id="0f549-197">¹ If your Azure AD app is registered in the _same_ tenant where you're making an authentication request in Teams, the user won't be asked to consent and will be granted an access token right away.</span></span> <span data-ttu-id="0f549-198">Les utilisateurs doivent uniquement consentir à ces autorisations si l’application Azure AD est inscrite dans un autre client.</span><span class="sxs-lookup"><span data-stu-id="0f549-198">Users only need to consent to these permissions if the Azure AD app is registered in a different tenant.</span></span>
> * <span data-ttu-id="0f549-199">² If you get an error stating that the domain is already owned and you are the owner, follow the procedure at [Quickstart: Add a custom domain name to Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) to register the domain, and then repeat step 5, above.</span><span class="sxs-lookup"><span data-stu-id="0f549-199">² If you get an error stating that the domain is already owned and you are the owner, follow the procedure at [Quickstart: Add a custom domain name to Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) to register the domain, and then repeat step 5, above.</span></span> <span data-ttu-id="0f549-200">(Cette erreur peut également se produire si vous n’êtes pas signé avec des informations d’identification d’administrateur dans la location Office 365).</span><span class="sxs-lookup"><span data-stu-id="0f549-200">(This error can also occur if you aren't signed in with Admin credentials in the Office 365 tenancy).</span></span>
> * <span data-ttu-id="0f549-201">Si vous ne recevez pas l’UPN (Nom d’utilisateur principal) dans le jeton d’accès renvoyé, vous pouvez l’ajouter en tant que revendication facultative [dans](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) Azure AD.</span><span class="sxs-lookup"><span data-stu-id="0f549-201">If you are not receiving the UPN (User Principal Name) in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in Azure AD.</span></span>

### <a name="2-update-your-microsoft-teams-application-manifest"></a><span data-ttu-id="0f549-202">2. Mettre à jour votre manifeste d’application Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="0f549-202">2. Update your Microsoft Teams application manifest</span></span>

<span data-ttu-id="0f549-203">Ajoutez de nouvelles propriétés à votre manifeste Microsoft Teams :</span><span class="sxs-lookup"><span data-stu-id="0f549-203">Add new properties to your Microsoft Teams manifest:</span></span>

* <span data-ttu-id="0f549-204">**WebApplicationInfo** : parent des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="0f549-204">**WebApplicationInfo** - The parent of the following elements:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="0f549-205">**id** : ID client de l’application.</span><span class="sxs-lookup"><span data-stu-id="0f549-205">**id** - The client ID of the application.</span></span> <span data-ttu-id="0f549-206">Il s’agit de l’ID d’application que vous avez obtenu dans le cadre de l’inscription de l’application auprès d’Azure AD.</span><span class="sxs-lookup"><span data-stu-id="0f549-206">This is the application ID that you obtained as part of registering the application with Azure AD.</span></span>
>* <span data-ttu-id="0f549-207">**ressource** : domaine et sous-domaine de votre application.</span><span class="sxs-lookup"><span data-stu-id="0f549-207">**resource** - The domain and subdomain of your application.</span></span> <span data-ttu-id="0f549-208">Il s’agit du même URI (y compris le protocole) que vous avez enregistré lors de la création de votre à `api://` `scope` l’étape 6 ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="0f549-208">This is the same URI (including the `api://` protocol) that you registered when creating your `scope` in step 6 above.</span></span> <span data-ttu-id="0f549-209">Vous ne devez pas inclure le `access_as_user` chemin d’accès dans votre ressource.</span><span class="sxs-lookup"><span data-stu-id="0f549-209">You shouldn't include the `access_as_user` path in your resource.</span></span> <span data-ttu-id="0f549-210">La partie domaine de cet URI doit correspondre au domaine, y compris les sous-domaines, utilisés dans les URL de votre manifeste d’application Teams.</span><span class="sxs-lookup"><span data-stu-id="0f549-210">The domain part of this URI should match the domain, including any subdomains, used in the URLs of your Teams application manifest.</span></span>

```json
"webApplicationInfo": {
  "id": "00000000-0000-0000-0000-000000000000",
  "resource": "api://subdomain.example.com/00000000-0000-0000-0000-000000000000"
}
```

> [!NOTE]
>
>* <span data-ttu-id="0f549-211">La ressource d’une application AAD est généralement la racine de son URL de site et de l’appID (par exemple, `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` ).</span><span class="sxs-lookup"><span data-stu-id="0f549-211">The resource for an AAD app will usually be the root of its site URL and the appID (e.g. `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`).</span></span> <span data-ttu-id="0f549-212">Nous utilisons également cette valeur pour nous assurer que votre demande est provenant du même domaine.</span><span class="sxs-lookup"><span data-stu-id="0f549-212">We also use this value to ensure your request is coming from the same domain.</span></span> <span data-ttu-id="0f549-213">Par conséquent, assurez-vous que l’onglet utilise `contentURL` les mêmes domaines que votre propriété de ressource.</span><span class="sxs-lookup"><span data-stu-id="0f549-213">Therefore, make sure that the `contentURL` for your tab uses the same domains as your resource property.</span></span>
>* <span data-ttu-id="0f549-214">Vous devez utiliser la version de manifeste 1.5 ou une version supérieure pour implémenter le `webApplicationInfo` champ.</span><span class="sxs-lookup"><span data-stu-id="0f549-214">You need to use manifest version 1.5 or higher to implement the `webApplicationInfo` field.</span></span>

### <a name="3-get-an-authentication-token-from-your-client-side-code"></a><span data-ttu-id="0f549-215">3. Obtenir un jeton d’authentification à partir de votre code côté client</span><span class="sxs-lookup"><span data-stu-id="0f549-215">3. Get an authentication token from your client-side code</span></span>

<span data-ttu-id="0f549-216">Voici à quoi ressemble l’API d’authentification :</span><span class="sxs-lookup"><span data-stu-id="0f549-216">Here's what the authentication API looks like:</span></span>

```javascript
var authTokenRequest = {
  successCallback: function(result) { console.log("Success: " + result); },
  failureCallback: function(error) { console.log("Failure: " + error); }
};
microsoftTeams.authentication.getAuthToken(authTokenRequest);
```

<span data-ttu-id="0f549-217">Lorsque vous appelez et que le consentement de l’utilisateur supplémentaire est requis (pour les autorisations au niveau de l’utilisateur), nous montrons une boîte de dialogue à l’utilisateur pour l’inciter à accorder un `getAuthToken` consentement supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="0f549-217">When you call `getAuthToken` - and additional user consent is required (for user-level permissions) - we will show a dialog to the user encouraging them to grant additional consent.</span></span> 

<span data-ttu-id="0f549-218">Une fois que vous avez reçu le jeton d’accès dans le rappel de réussite, vous pouvez décoder le jeton d’accès pour afficher les revendications associées à ce jeton.</span><span class="sxs-lookup"><span data-stu-id="0f549-218">Once you've received the access token in the success callback you can decode the access token to view the claims associated with that token.</span></span> <span data-ttu-id="0f549-219">(Si vous le souhaitez, vous pouvez copier/coller manuellement le jeton d’accès dans un outil tel que [JWT.io](https://jwt.io/) pour inspecter son contenu).</span><span class="sxs-lookup"><span data-stu-id="0f549-219">(Optionally, you can manually copy/paste the access token into a tool such as [JWT.io](https://jwt.io/) to inspect its contents).</span></span> <span data-ttu-id="0f549-220">Si vous ne recevez pas l’UPN (nom d’utilisateur principal) dans le jeton d’accès renvoyé, vous pouvez l’ajouter en tant que revendication facultative [dans](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) Azure AD.</span><span class="sxs-lookup"><span data-stu-id="0f549-220">If you are not receiving the UPN (User Principal Name) in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in Azure AD.</span></span>

<p>
    <img src="~/assets/images/tabs/tabs-sso-prompt.png" alt="Tab single sign-on SSO dialog prompt" width="75%"/>
</p>

## <a name="sample-code"></a><span data-ttu-id="0f549-221">Exemple de code</span><span class="sxs-lookup"><span data-stu-id="0f549-221">Sample code</span></span>

<span data-ttu-id="0f549-222">Visitez notre exemple d’application : exemple d’o [SSO PnP MSTeams](https://github.com/pnp/teams-dev-samples/tree/master/samples/tab-sso)</span><span class="sxs-lookup"><span data-stu-id="0f549-222">Visit our sample application: [MSTeams PnP SSO Sample](https://github.com/pnp/teams-dev-samples/tree/master/samples/tab-sso)</span></span>

<span data-ttu-id="0f549-223">L’environnement README explique comment configurer votre environnement de développement et comment configurer votre application dans Azure AD.</span><span class="sxs-lookup"><span data-stu-id="0f549-223">The README explains how to set up your development environment and how to configure your application in Azure AD.</span></span> <span data-ttu-id="0f549-224">Vous trouverez également des informations supplémentaires sur la structure de l’exemple dans la [section structure](https://github.com/OfficeDev/msteams-tabs-sso-sample-nodejs#app-structure) de l’application pour vous familiariser avec la base de code.</span><span class="sxs-lookup"><span data-stu-id="0f549-224">You can also find further information on how the sample is structured in the [app structure section](https://github.com/OfficeDev/msteams-tabs-sso-sample-nodejs#app-structure) to help familiarize yourself with the codebase.</span></span>

## <a name="known-limitations"></a><span data-ttu-id="0f549-225">Limitations connues</span><span class="sxs-lookup"><span data-stu-id="0f549-225">Known Limitations</span></span>

### <a name="apps-that-require-additional-microsoft-graph-scopes"></a><span data-ttu-id="0f549-226">Applications nécessitant des étendues Microsoft Graph supplémentaires</span><span class="sxs-lookup"><span data-stu-id="0f549-226">Apps that require additional Microsoft Graph Scopes</span></span>

<span data-ttu-id="0f549-227">Notre implémentation actuelle pour l' utilisateur unique accorde uniquement le consentement pour les autorisations au niveau de l’utilisateur (e-mail, profil, offline_access, OpenId) et non pour d’autres API (par exemple, User.Read ou Mail.Read).</span><span class="sxs-lookup"><span data-stu-id="0f549-227">Our current implementation for SSO only grants consent for user-level permissions — email, profile, offline_access, OpenId — not for other APIs (such as User.Read or Mail.Read).</span></span> <span data-ttu-id="0f549-228">Si votre application a besoin d’autres étendues Microsoft Graph, voici quelques solutions de contournement permettant d’y répondre :</span><span class="sxs-lookup"><span data-stu-id="0f549-228">If your app needs further Microsoft Graph scopes, here are some enabling workarounds:</span></span>

#### <a name="tenant-admin-consent"></a><span data-ttu-id="0f549-229">Consentement de l’administrateur client</span><span class="sxs-lookup"><span data-stu-id="0f549-229">Tenant Admin Consent</span></span>

<span data-ttu-id="0f549-230">L’approche la plus simple consiste à obtenir le consentement préalable d’un administrateur client au nom de l’organisation.</span><span class="sxs-lookup"><span data-stu-id="0f549-230">The simplest approach is to get a tenant admin to pre-consent on behalf of the organization.</span></span> <span data-ttu-id="0f549-231">Cela signifie que les utilisateurs n’auront pas à consentir à ces étendues et [](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow)que vous pouvez ensuite être libre d’échanger le côté serveur de jetons à l’aide du flux De la part d’Azure AD.</span><span class="sxs-lookup"><span data-stu-id="0f549-231">This means users won’t have to consent to these scopes and you can then be free to exchange the token server side using Azure AD’s [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow).</span></span> <span data-ttu-id="0f549-232">Cette solution de contournement est acceptable pour les applications métier internes, mais peut ne pas être suffisante pour les développeurs tiers qui ne peuvent pas s’appuyer sur l’approbation de l’administrateur client.</span><span class="sxs-lookup"><span data-stu-id="0f549-232">This workaround is acceptable for internal line-of-business applications but may not be enough for third-party developers who may not be able to rely on tenant admin approval.</span></span>

<span data-ttu-id="0f549-233">Une méthode simple de consentement pour le compte d’une organisation (en tant qu’administrateur client) consiste à visiter :</span><span class="sxs-lookup"><span data-stu-id="0f549-233">A simple way of consenting on behalf of an organization (as a tenant admin) is to visit:</span></span>

* `https://login.microsoftonline.com/common/adminconsent?client_id=<AAD_App_ID>`

#### <a name="asking-for-additional-consent-using-the-auth-api"></a><span data-ttu-id="0f549-234">Demande de consentement supplémentaire à l’aide de l’API Auth</span><span class="sxs-lookup"><span data-stu-id="0f549-234">Asking for additional consent using the Auth API</span></span>

<span data-ttu-id="0f549-235">Une autre approche pour obtenir des étendues Microsoft Graph supplémentaires consiste à présenter une boîte de dialogue de consentement à l’aide de notre approche d’authentification [Azure AD](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) basée sur le web existante qui implique l’obtention d’une boîte de dialogue de consentement Azure AD.</span><span class="sxs-lookup"><span data-stu-id="0f549-235">Another approach for getting additional Microsoft Graph scopes is to present a consent dialog using our existing [web-based Azure AD authentication approach](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) which involves popping up an Azure AD consent dialog.</span></span> <span data-ttu-id="0f549-236">Il existe quelques ajouts notables :</span><span class="sxs-lookup"><span data-stu-id="0f549-236">There are some notable additions:</span></span>

1. <span data-ttu-id="0f549-237">Le jeton récupéré à l’aide doit être échangé côté serveur à l’aide du flux Azure AD de la part de pour accéder à ces API `getAuthToken()` Microsoft Graph supplémentaires. [](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow)</span><span class="sxs-lookup"><span data-stu-id="0f549-237">The token retrieved using `getAuthToken()` needs to be exchanged server-side using Azure AD [on-behalf-of flow](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) to get access to those additional Microsoft Graph APIs.</span></span>
    * <span data-ttu-id="0f549-238">N’oubliez pas d’utiliser le point de terminaison Microsoft Graph v2 pour cet échange</span><span class="sxs-lookup"><span data-stu-id="0f549-238">Be sure to use the v2 Microsoft Graph endpoint for this exchange</span></span>
2. <span data-ttu-id="0f549-239">Si l’échange échoue, Azure AD retourne une exception d’octroi non valide.</span><span class="sxs-lookup"><span data-stu-id="0f549-239">If the exchange fails, Azure AD will return an invalid grant exception.</span></span> <span data-ttu-id="0f549-240">Il existe généralement l’un des deux messages `invalid_grant` d’erreur : ou `interaction_required`</span><span class="sxs-lookup"><span data-stu-id="0f549-240">There are usually one of two error messages: `invalid_grant` or `interaction_required`</span></span>
3. <span data-ttu-id="0f549-241">En cas d’échec de l’échange, vous devez demander un consentement supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="0f549-241">When the exchange fails, then you need to ask for additional consent.</span></span> <span data-ttu-id="0f549-242">Nous vous recommandons d’afficher une interface utilisateur demandant à l’utilisateur d’accorder un consentement supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="0f549-242">We recommend showing some UI asking the user to grant additional consent.</span></span> <span data-ttu-id="0f549-243">Cette interface utilisateur doit inclure un bouton qui déclenche une boîte de dialogue de consentement Azure AD à l’aide de notre [API d’authentification Azure AD.](~/concepts/authentication/auth-silent-aad.md)</span><span class="sxs-lookup"><span data-stu-id="0f549-243">This UI should include a button that triggers an Azure AD consent dialog using our [Azure AD authentication API](~/concepts/authentication/auth-silent-aad.md).</span></span>
4. <span data-ttu-id="0f549-244">Lorsque vous demandez un consentement supplémentaire d’Azure AD, vous devez inclure dans votre paramètre de chaîne de requête à Azure AD, sinon Azure AD ne demandera pas d’étendues `prompt=consent` supplémentaires. [](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context)</span><span class="sxs-lookup"><span data-stu-id="0f549-244">When asking for additional consent from Azure AD, you need to include `prompt=consent` in your [query-string-parameter](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) to Azure AD otherwise Azure AD will not ask for the additional scopes.</span></span>
    * <span data-ttu-id="0f549-245">Au lieu de: `?scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="0f549-245">Instead of: `?scope={scopes}`</span></span>
    * <span data-ttu-id="0f549-246">Utilisez cette :: `?prompt=consent&scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="0f549-246">Use this: `?prompt=consent&scope={scopes}`</span></span>
    * <span data-ttu-id="0f549-247">Assurez-vous qu’il inclut toutes les étendues que vous invitez à l’utilisateur (par exemple `{scopes}` : Mail.Read ou User.Read).</span><span class="sxs-lookup"><span data-stu-id="0f549-247">Be sure that `{scopes}` includes all the scopes you are prompting the user for (ex: Mail.Read or User.Read).</span></span>
5. <span data-ttu-id="0f549-248">Une fois que l’utilisateur a accordé des autorisations supplémentaires, réessayez le flux « de la part de » pour accéder à ces API supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="0f549-248">Once the user has granted additional permission, retry the on-behalf-of-flow to get access to these additional APIs.</span></span>

### <a name="non-azure-ad-authentication"></a><span data-ttu-id="0f549-249">Authentification non Azure AD</span><span class="sxs-lookup"><span data-stu-id="0f549-249">Non-Azure AD Authentication</span></span>

<span data-ttu-id="0f549-250">La solution d’authentification décrite ci-dessus fonctionne uniquement pour les applications et les services qui utilisent Azure AD en tant que fournisseur d’identité.</span><span class="sxs-lookup"><span data-stu-id="0f549-250">The above-described authentication solution only works for apps and services that support Azure AD as an identity provider.</span></span> <span data-ttu-id="0f549-251">Les applications qui souhaitent s’authentifier à l’aide de services non Azure AD doivent continuer à utiliser le flux d’authentification web basé sur les fenêtres [pop-up.](~/concepts/authentication.md)</span><span class="sxs-lookup"><span data-stu-id="0f549-251">Apps that want to authenticate using non-Azure AD based services need to continue using the pop-up-based [web authentication flow](~/concepts/authentication.md).</span></span>
